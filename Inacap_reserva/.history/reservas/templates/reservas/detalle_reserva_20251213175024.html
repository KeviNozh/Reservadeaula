# views.py
from django.utils import timezone
from datetime import datetime

def detalle_reserva(request, reserva_id):
    reserva = Reserva.objects.get(id=reserva_id)
    
    # Calcular duración en horas
    hora_inicio = reserva.hora_inicio
    hora_fin = reserva.hora_fin
    
    # Calcular diferencia en horas
    if hora_inicio and hora_fin:
        # Convertir a objetos datetime para el cálculo
        inicio = datetime.combine(reserva.fecha_reserva, hora_inicio)
        fin = datetime.combine(reserva.fecha_reserva, hora_fin)
        
        # Si la hora_fin es menor que hora_inicio, asumir que es al día siguiente
        if fin < inicio:
            fin = datetime.combine(reserva.fecha_reserva + timedelta(days=1), hora_fin)
        
        diferencia = fin - inicio
        duracion_horas = diferencia.total_seconds() / 3600
        duracion_horas = round(duracion_horas, 1)
    else:
        duracion_horas = 0
    
    context = {
        'reserva': reserva,
        'duracion_horas': duracion_horas,
    }
    return render(request, 'reservas/detalle_reserva.html', context)