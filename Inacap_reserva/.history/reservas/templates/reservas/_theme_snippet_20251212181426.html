<!-- Snippet de modo oscuro (inline): prevenci√≥n flash, variables CSS y toggle JS -->
<script>
(function(){
    try{
        console.log('[theme-snippet] init');
        const t = localStorage.getItem('theme');
        if(t === 'dark') document.documentElement.setAttribute('data-theme','dark');
    }catch(e){ console.error('[theme-snippet] init error', e); }
})();
</script>

<style>
    :root{
        --bg: #ffffff;
        --text: #111827;
        --card: #ffffff;
        --muted: #6b7280;
        --accent: #2563eb;
    }
    html[data-theme="dark"]{
        --bg: #071126;
        --text: #e6eef8;
        --card: #071126;
        --muted: #9ca3af;
        --accent: #60a5fa;
    }
    body, html{background:var(--bg);color:var(--text)}
    /* Reglas con mayor prioridad para evitar que estilos inline o CSS externos anulen el tema */
    html[data-theme="dark"] body{background:var(--bg) !important;color:var(--text) !important}
    html[data-theme="dark"] .card, html[data-theme="dark"] .card-custom{background:var(--card) !important;color:var(--text) !important;border-color:rgba(255,255,255,0.03) !important}
    html[data-theme="dark"] .header, html[data-theme="dark"] .logo-text{color:var(--text) !important}
    .theme-toggle{position:fixed;right:18px;bottom:18px;z-index:9999;background:var(--card);color:var(--text);border:1px solid rgba(0,0,0,0.08);padding:10px 12px;border-radius:999px;cursor:pointer;box-shadow:0 6px 18px rgba(2,6,23,0.12);font-size:16px}
</style>

<!-- Bot√≥n toggle (puedes moverlo dentro del body donde prefieras) -->
<button id="themeToggle" class="theme-toggle" aria-label="Alternar tema">üåì</button>

<script>
(function(){
    function updateIcon(btn, dark){
        if(!btn) return;
        try{
            btn.textContent = dark ? 'üåô' : '‚òÄÔ∏è';
            btn.setAttribute('aria-pressed', dark ? 'true' : 'false');
        }catch(e){console.warn('[theme-snippet] updateIcon error', e)}
    }

    function setTheme(dark){
        try{ localStorage.setItem('theme', dark? 'dark' : 'light'); }catch(e){}
        if(dark) document.documentElement.setAttribute('data-theme','dark'); else document.documentElement.removeAttribute('data-theme');
        updateIcon(document.getElementById('themeToggle'), dark);
        console.log('[theme-snippet] setTheme ->', dark ? 'dark' : 'light');
    }

    try{
        const t = localStorage.getItem('theme');
        const initialDark = t === 'dark';
        if(initialDark) document.documentElement.setAttribute('data-theme','dark');
    }catch(e){console.error('[theme-snippet] read theme error', e)}

    function init(){
        const btn = document.getElementById('themeToggle');
        const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        if(btn) updateIcon(btn, isDark);
        if(btn){
            btn.addEventListener('click', function(){
                const currentlyDark = document.documentElement.getAttribute('data-theme') === 'dark';
                setTheme(!currentlyDark);
            });
        } else {
            // log for debugging: button not found
            console.log('[theme-snippet] themeToggle button not found in DOM');
        }
    }

    if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init); else init();
})();
</script>

<!-- Inline fallback toggle: asegura que el bot√≥n #themeToggle funcione incluso si theme.js no se ha cargado -->
<script>
(function(){
    if(window.__inlineThemeToggleInstalled) return; // evitar doble registro
    window.__inlineThemeToggleInstalled = true;

    function applyDark(dark){
        try{ if(dark) document.documentElement.setAttribute('data-theme','dark'); else document.documentElement.removeAttribute('data-theme'); }catch(e){}
        try{ if(dark) document.body.classList.add('dark-theme'); else document.body.classList.remove('dark-theme'); }catch(e){}
        try{ localStorage.setItem('theme', dark ? 'dark' : 'light'); }catch(e){}
    }

    // Delegated click listener para el bot√≥n del login u otros botones con data-theme-toggle
    document.addEventListener('click', function(ev){
        var btn = ev.target.closest && ev.target.closest('#themeToggle, [data-theme-toggle], #themeToggleBtn');
        if(!btn) return;
        ev.preventDefault();
        var isDark = document.documentElement.getAttribute('data-theme') === 'dark';
        applyDark(!isDark);
        // actualizar texto/√≠cono si existe
        try{
            if(btn.tagName === 'BUTTON' || btn.nodeType === 1){
                btn.textContent = !isDark ? '‚òÄÔ∏è' : 'üåô';
            }
        }catch(e){}
    }, {capture:false});

    // Sincronizar icono inicial si existe el bot√≥n
    try{
        var initialBtn = document.querySelector('#themeToggle') || document.querySelector('#themeToggleBtn') || document.querySelector('[data-theme-toggle]');
        if(initialBtn){
            var darkNow = document.documentElement.getAttribute('data-theme') === 'dark';
            initialBtn.textContent = darkNow ? '‚òÄÔ∏è' : 'üåô';
        }
    }catch(e){}
})();
</script>
