

################################################################################
üìÅ Carpeta: C:\Users\kevin\OneDrive\Liceo\Escritorio\Info\4_semestre\proyecto_integrado\Backend\Inacap_reserva\reservas
################################################################################


===== admin.py =====
from django.contrib import admin
from .models import Area, PerfilUsuario, Equipamiento, Espacio, Reserva, HistorialAprobacion, Notificacion, Mantenimiento, HorariosDisponibilidad, Incidencia

@admin.register(Area)
class AreaAdmin(admin.ModelAdmin):
    list_display = ['nombre_area', 'descripcion']
    search_fields = ['nombre_area']

@admin.register(PerfilUsuario)
class PerfilUsuarioAdmin(admin.ModelAdmin):
    list_display = ['user', 'rol', 'departamento', 'estado', 'fecha_registro']
    list_filter = ['rol', 'estado']
    search_fields = ['user__username', 'user__email', 'departamento']

@admin.register(Equipamiento)
class EquipamientoAdmin(admin.ModelAdmin):
    list_display = ['nombre_equipo', 'tipo_equipo', 'id_espacio', 'marca_modelo']
    list_filter = ['tipo_equipo']
    search_fields = ['nombre_equipo', 'marca_modelo']

@admin.register(Espacio)
class EspacioAdmin(admin.ModelAdmin):
    list_display = ['nombre', 'tipo', 'edificio', 'piso', 'capacidad', 'estado']
    list_filter = ['tipo', 'estado', 'edificio']
    search_fields = ['nombre', 'edificio']

@admin.register(Reserva)
class ReservaAdmin(admin.ModelAdmin):
    list_display = ['espacio', 'solicitante', 'fecha_reserva', 'hora_inicio', 'hora_fin', 'estado']
    list_filter = ['estado', 'fecha_reserva']
    search_fields = ['espacio__nombre', 'solicitante__username']
    date_hierarchy = 'fecha_reserva'

@admin.register(HistorialAprobacion)
class HistorialAprobacionAdmin(admin.ModelAdmin):
    list_display = ['reserva', 'usuario_admin', 'tipo_accion', 'fecha_accion']
    list_filter = ['tipo_accion', 'fecha_accion']
    search_fields = ['reserva__espacio__nombre', 'usuario_admin__username']

@admin.register(Notificacion)
class NotificacionAdmin(admin.ModelAdmin):
    list_display = ['destinatario', 'tipo', 'titulo', 'leida', 'fecha_creacion']
    list_filter = ['tipo', 'leida']
    search_fields = ['titulo', 'destinatario__username']

@admin.register(Mantenimiento)
class MantenimientoAdmin(admin.ModelAdmin):
    list_display = ['id_espacio', 'tipo_mantenimiento', 'fecha_inicio', 'fecha_fin', 'estado']
    list_filter = ['tipo_mantenimiento', 'estado']
    search_fields = ['id_espacio__nombre']

@admin.register(HorariosDisponibilidad)
class HorariosDisponibilidadAdmin(admin.ModelAdmin):
    list_display = ['id_espacio', 'dia_semana', 'hora_apertura', 'hora_cierre']
    list_filter = ['dia_semana']
    search_fields = ['id_espacio__nombre']

@admin.register(Incidencia)
class IncidenciaAdmin(admin.ModelAdmin):
    list_display = ['id_usuario', 'prioridad', 'estado', 'fecha_reporte']
    list_filter = ['prioridad', 'estado']
    search_fields = ['descripcion', 'id_usuario__username']
============================================================


===== apps.py =====
from django.apps import AppConfig

class ReservasConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'reservas'
    verbose_name = 'Sistema de Reservas'
============================================================


===== backends.py =====
from django.contrib.auth.backends import ModelBackend
from django.contrib.auth import get_user_model
from django.db.models import Q

UserModel = get_user_model()

class EmailBackend(ModelBackend):
    def authenticate(self, request, username=None, password=None, **kwargs):
        try:
            print(f"üîê Intentando autenticar: {username}")
            
            # Buscar por email o username (case insensitive)
            user = UserModel.objects.get(
                Q(email__iexact=username) | 
                Q(username__iexact=username)
            )
            print(f"‚úÖ Usuario encontrado: {user.username}")
            
        except UserModel.DoesNotExist:
            print(f"‚ùå Usuario no encontrado: {username}")
            return None
        except UserModel.MultipleObjectsReturned:
            user = UserModel.objects.filter(
                Q(email__iexact=username) | 
                Q(username__iexact=username)
            ).first()
            print(f"‚ö†Ô∏è M√∫ltiples usuarios, usando: {user.username}")

        # Verificar contrase√±a
        if user and user.check_password(password):
            print(f"‚úÖ Contrase√±a correcta para: {user.username}")
            return user
        else:
            print(f"‚ùå Contrase√±a incorrecta para: {username}")
            return None

    def get_user(self, user_id):
        try:
            return UserModel.objects.get(pk=user_id)
        except UserModel.DoesNotExist:
            return None
============================================================


===== fix_views.py =====

============================================================


===== models.py =====
from django.db import models
from django.contrib.auth.models import User
from django.utils import timezone

class Area(models.Model):
    nombre_area = models.CharField(max_length=100)
    descripcion = models.TextField(blank=True, null=True)
    
    def __str__(self):
        return self.nombre_area

class PerfilUsuario(models.Model):
    ROL_CHOICES = (
        ('Usuario', 'Usuario'),
        ('Docente', 'Docente'),
        ('Investigacion', 'Investigaci√≥n'),  # Cambiado
        ('Administrativo', 'Administrativo'),  # Nuevo rol
        ('Aprobador', 'Aprobador')
    )
    
    ESTADO_CHOICES = (
        ('activo', 'Activo'),
        ('inactivo', 'Inactivo'),
        ('suspendido', 'Suspendido')
    )
    
    user = models.OneToOneField(User, on_delete=models.CASCADE)
    rol = models.CharField(max_length=50, choices=ROL_CHOICES, default='Usuario')
    area = models.ForeignKey(Area, on_delete=models.SET_NULL, null=True, blank=True)
    departamento = models.CharField(max_length=100, blank=True, null=True)
    estado = models.CharField(max_length=50, choices=ESTADO_CHOICES, default='activo')
    fecha_registro = models.DateTimeField(auto_now_add=True)
    ultimo_acceso = models.DateTimeField(null=True, blank=True)
    
    def __str__(self):
        return f"{self.user.username} ({self.rol})"

class Espacio(models.Model):
    ESTADO_CHOICES = (
        ('Disponible', 'Disponible'),
        ('Mantenimiento', 'Mantenimiento'),
        ('Fuera de Servicio', 'Fuera de Servicio'),
    )
    
    TIPO_CHOICES = (
        ('Sala de Reuniones', 'Sala de Reuniones'),
        ('Auditorio', 'Auditorio'),
        ('Laboratorio', 'Laboratorio'),
        ('Oficina', 'Oficina'),
        ('Aula', 'Aula'),
    )
    
    nombre = models.CharField(max_length=100)
    tipo = models.CharField(max_length=100, choices=TIPO_CHOICES)
    edificio = models.CharField(max_length=100, blank=True, null=True)
    piso = models.IntegerField(blank=True, null=True)
    capacidad = models.IntegerField()
    descripcion = models.TextField(blank=True, null=True)
    estado = models.CharField(max_length=50, choices=ESTADO_CHOICES, default='Disponible')
    
    def __str__(self):
        return self.nombre
    
class Equipamiento(models.Model):
    TIPO_EQUIPO_CHOICES = (
        ('Proyector', 'Proyector'),
        ('Computador', 'Computador'),
        ('Audio', 'Sistema de Audio'),
        ('Video', 'Sistema de Video'),
        ('Mobiliario', 'Mobiliario'),
    )
    
    id_espacio = models.ForeignKey(Espacio, on_delete=models.CASCADE, related_name='equipamientos')
    nombre_equipo = models.CharField(max_length=100)
    tipo_equipo = models.CharField(max_length=100, choices=TIPO_EQUIPO_CHOICES)
    marca_modelo = models.CharField(max_length=255, blank=True, null=True)
    numero_serie = models.CharField(max_length=100, blank=True, null=True)
    
    def __str__(self):
        return self.nombre_equipo

class Reserva(models.Model):
    ESTADO_CHOICES = (
        ('Pendiente', 'Pendiente'),
        ('Aprobada', 'Aprobada'),
        ('Rechazada', 'Rechazada'),
        ('Cancelada', 'Cancelada'),
    )
    
    espacio = models.ForeignKey(Espacio, on_delete=models.CASCADE)
    solicitante = models.ForeignKey(User, on_delete=models.CASCADE, related_name='reservas_solicitadas')
    fecha_reserva = models.DateField()
    hora_inicio = models.TimeField()
    hora_fin = models.TimeField()
    proposito = models.TextField()
    num_asistentes = models.IntegerField()
    estado = models.CharField(max_length=50, choices=ESTADO_CHOICES, default='Pendiente')
    fecha_solicitud = models.DateTimeField(auto_now_add=True)
    id_aprobador = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, related_name='reservas_aprobadas')
    comentario_admin = models.TextField(blank=True, null=True)
    
    def __str__(self):
        return f"Reserva de {self.espacio.nombre} por {self.solicitante.username}"

class HistorialAprobacion(models.Model):
    TIPO_ACCION_CHOICES = (
        ('Aprobada', 'Aprobada'),
        ('Rechazada', 'Rechazada'),
        ('Cancelada', 'Cancelada'),
    )
    
    reserva = models.ForeignKey(Reserva, on_delete=models.CASCADE)
    usuario_admin = models.ForeignKey(User, on_delete=models.CASCADE)
    tipo_accion = models.CharField(max_length=50, choices=TIPO_ACCION_CHOICES)
    fecha_accion = models.DateField(auto_now_add=True)
    hora_accion = models.TimeField(auto_now_add=True)
    motivo = models.TextField(blank=True, null=True)
    
    def __str__(self):
        return f"Aprobaci√≥n {self.tipo_accion} - Reserva {self.reserva.id}"

class Notificacion(models.Model):
    TIPO_CHOICES = (
        ('reserva_aprobada', 'Reserva Aprobada'),
        ('reserva_rechazada', 'Reserva Rechazada'),
        ('reserva_cancelada', 'Reserva Cancelada'),
        ('reserva_pendiente', 'Reserva Pendiente'),
        ('reserva_creada', 'Reserva Creada'),
        ('mantenimiento', 'Mantenimiento'),
        ('incidencia', 'Incidencia'),
        ('sistema', 'Sistema'),
    )
    
    destinatario = models.ForeignKey(User, on_delete=models.CASCADE, related_name='notificaciones')
    tipo = models.CharField(max_length=100, choices=TIPO_CHOICES)
    titulo = models.CharField(max_length=255)
    mensaje = models.TextField()
    leida = models.BooleanField(default=False)
    fecha_creacion = models.DateTimeField(auto_now_add=True)
    fecha_lectura = models.DateTimeField(null=True, blank=True)
    reserva = models.ForeignKey('Reserva', on_delete=models.CASCADE, null=True, blank=True, related_name='notificaciones')  # A√±adido related_name
    
    def __str__(self):
        return self.titulo
    
    def get_fecha_creacion_formateada(self):
        """Retorna la fecha formateada de manera legible"""
        return self.fecha_creacion.strftime('%d/%m/%Y %H:%M')
    
    def marcar_como_leida(self):
        """Marca la notificaci√≥n como le√≠da"""
        self.leida = True
        self.fecha_lectura = timezone.now()
        self.save()
    
    class Meta:
        ordering = ['-fecha_creacion']
        verbose_name = 'Notificaci√≥n'
        verbose_name_plural = 'Notificaciones'
    
    def get_fecha_creacion_formateada(self):
        """Retorna la fecha formateada de manera legible"""
        return self.fecha_creacion.strftime('%d/%m/%Y %H:%M')
    
    def marcar_como_leida(self):
        """Marca la notificaci√≥n como le√≠da"""
        self.leida = True
        self.fecha_lectura = timezone.now()
        self.save()
    
    class Meta:
        ordering = ['-fecha_creacion']
        verbose_name = 'Notificaci√≥n'
        verbose_name_plural = 'Notificaciones'

class NotificacionAdmin(models.Model):
    TIPO_CHOICES = (
        ('reserva_creada', 'Nueva Reserva Creada'),
        ('reserva_aprobada', 'Reserva Aprobada'),
        ('reserva_rechazada', 'Reserva Rechazada'),
        ('reserva_cancelada', 'Reserva Cancelada'),
        ('usuario_registrado', 'Nuevo Usuario Registrado'),
        ('espacio_creado', 'Espacio Creado'),
        ('espacio_editado', 'Espacio Editado'), 
        ('espacio_eliminado', 'Espacio Eliminado'),
        ('incidencia_reportada', 'Incidencia Reportada'),
        ('reporte_generado', 'Reporte Generado'),
        ('sesion_iniciada', 'Sesi√≥n de Admin Iniciada'),
        ('sesion_cerrada', 'Sesi√≥n de Admin Cerrada'),
        ('sistema', 'Evento del Sistema'),
    )
    
    PRIORIDAD_CHOICES = (
        ('baja', 'Baja'),
        ('media', 'Media'),
        ('alta', 'Alta'),
        ('urgente', 'Urgente'),
    )
    
    tipo = models.CharField(max_length=100, choices=TIPO_CHOICES)
    titulo = models.CharField(max_length=255)
    mensaje = models.TextField()
    prioridad = models.CharField(max_length=50, choices=PRIORIDAD_CHOICES, default='media')
    leida = models.BooleanField(default=False)
    fecha_creacion = models.DateTimeField(auto_now_add=True)
    fecha_lectura = models.DateTimeField(null=True, blank=True)
    
    # Campos espec√≠ficos para diferentes tipos de eventos
    usuario_relacionado = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, related_name='notificaciones_admin_usuario')
    reserva = models.ForeignKey('Reserva', on_delete=models.SET_NULL, null=True, blank=True, related_name='notificaciones_admin_reserva')
    espacio = models.ForeignKey('Espacio', on_delete=models.SET_NULL, null=True, blank=True, related_name='notificaciones_admin_espacio')
    
    # Metadata adicional
    ip_address = models.GenericIPAddressField(null=True, blank=True)
    user_agent = models.TextField(blank=True, null=True)
    
    def __str__(self):
        return f"Admin Notif: {self.titulo}"
    
    def get_fecha_creacion_formateada(self):
        """Retorna la fecha formateada de manera legible"""
        return self.fecha_creacion.strftime('%d/%m/%Y %H:%M:%S')
    
    def marcar_como_leida(self):
        """Marca la notificaci√≥n como le√≠da"""
        self.leida = True
        self.fecha_lectura = timezone.now()
        self.save()
    
    class Meta:
        ordering = ['-fecha_creacion']
        verbose_name = 'Notificaci√≥n de Administrador'
        verbose_name_plural = 'Notificaciones de Administrador'

class Mantenimiento(models.Model):
    ESTADO_CHOICES = (
        ('Programado', 'Programado'),
        ('En Proceso', 'En Proceso'),
        ('Completado', 'Completado'),
        ('Cancelado', 'Cancelado'),
    )
    
    TIPO_MANTENIMIENTO_CHOICES = (
        ('Preventivo', 'Preventivo'),
        ('Correctivo', 'Correctivo'),
        ('Urgente', 'Urgente'),
    )
    
    id_espacio = models.ForeignKey(Espacio, on_delete=models.CASCADE)
    tipo_mantenimiento = models.CharField(max_length=100, choices=TIPO_MANTENIMIENTO_CHOICES)
    fecha_inicio = models.DateField()
    fecha_fin = models.DateField()
    estado = models.CharField(max_length=50, choices=ESTADO_CHOICES)
    hora_inicio = models.TimeField()
    hora_fin = models.TimeField()
    
    def __str__(self):
        return f"Mantenimiento {self.tipo_mantenimiento} - {self.id_espacio.nombre}"

class HorariosDisponibilidad(models.Model):
    DIA_SEMANA_CHOICES = (
        ('Lunes', 'Lunes'),
        ('Martes', 'Martes'),
        ('Mi√©rcoles', 'Mi√©rcoles'),
        ('Jueves', 'Jueves'),
        ('Viernes', 'Viernes'),
        ('S√°bado', 'S√°bado'),
        ('Domingo', 'Domingo'),
    )
    
    id_espacio = models.ForeignKey(Espacio, on_delete=models.CASCADE)
    dia_semana = models.CharField(max_length=20, choices=DIA_SEMANA_CHOICES)
    hora_apertura = models.TimeField()
    hora_cierre = models.TimeField()
    fecha_inicio_vigencia = models.DateField()
    bloques_disponibles = models.IntegerField(default=1)
    fecha_registro = models.DateTimeField(auto_now_add=True)
    
    def __str__(self):
        return f"{self.id_espacio.nombre} - {self.dia_semana}"

class Incidencia(models.Model):
    PRIORIDAD_CHOICES = (
        ('Baja', 'Baja'),
        ('Media', 'Media'),
        ('Alta', 'Alta'),
        ('Cr√≠tica', 'Cr√≠tica'),
    )
    
    ESTADO_CHOICES = (
        ('Reportada', 'Reportada'),
        ('En Proceso', 'En Proceso'),
        ('Resuelta', 'Resuelta'),
        ('Cerrada', 'Cerrada'),
    )
    
    id_usuario = models.ForeignKey(User, on_delete=models.CASCADE, related_name='incidencias_reportadas')
    id_espacio = models.ForeignKey(Espacio, on_delete=models.SET_NULL, null=True, blank=True)
    id_equipo = models.ForeignKey(Equipamiento, on_delete=models.SET_NULL, null=True, blank=True)
    descripcion = models.TextField()
    prioridad = models.CharField(max_length=50, choices=PRIORIDAD_CHOICES, default='Media')
    estado = models.CharField(max_length=50, choices=ESTADO_CHOICES, default='Reportada')
    fecha_reporte = models.DateTimeField(auto_now_add=True)
    fecha_resolucion = models.DateTimeField(null=True, blank=True)
    acciones_tomadas = models.TextField(blank=True, null=True)
    responsable = models.ForeignKey(User, on_delete=models.SET_NULL, null=True, blank=True, related_name='incidencias_asignadas')
    observaciones = models.TextField(blank=True, null=True)
    
    def __str__(self):
        return f"Incidencia {self.id} - {self.descripcion[:50]}"
============================================================


===== serializers.py =====
from rest_framework import serializers
from django.contrib.auth.models import User
from .models import Espacio, Reserva, PerfilUsuario, Equipamiento, Area, Notificacion, HistorialAprobacion

class UserSerializer(serializers.ModelSerializer):
    class Meta:
        model = User
        fields = ['id', 'username', 'first_name', 'last_name', 'email']

class PerfilUsuarioSerializer(serializers.ModelSerializer):
    user = UserSerializer(read_only=True)
    area_nombre = serializers.CharField(source='area.nombre_area', read_only=True)
    class Meta:
        model = PerfilUsuario
        fields = ['id', 'user', 'rol', 'area', 'area_nombre']

class EquipamientoSerializer(serializers.ModelSerializer):
    class Meta:
        model = Equipamiento
        fields = '__all__'

class AreaSerializer(serializers.ModelSerializer):
    class Meta:
        model = Area
        fields = '__all__'

class EspacioSerializer(serializers.ModelSerializer):
    equipamiento = EquipamientoSerializer(many=True, read_only=True)
    class Meta:
        model = Espacio
        fields = ['id', 'nombre', 'tipo', 'capacidad', 'descripcion', 'estado', 'equipamiento']

class ReservaSerializer(serializers.ModelSerializer):
    espacio_nombre = serializers.CharField(source='espacio.nombre', read_only=True)
    solicitante_nombre = serializers.CharField(source='solicitante.username', read_only=True)
    class Meta:
        model = Reserva
        fields = [
            'id', 'espacio', 'espacio_nombre', 'solicitante', 'solicitante_nombre',
            'fecha_reserva', 'hora_inicio', 'hora_fin', 'proposito',
            'num_asistentes', 'estado', 'fecha_solicitud'
        ]

class NotificacionSerializer(serializers.ModelSerializer):
    espacio_nombre = serializers.CharField(source='reserva.espacio.nombre', read_only=True, allow_null=True)
    fecha_creacion_formateada = serializers.CharField(source='get_fecha_creacion_formateada', read_only=True)
    
    class Meta:
        model = Notificacion
        fields = [
            'id', 'tipo', 'titulo', 'mensaje', 'leida', 'fecha_creacion', 
            'fecha_creacion_formateada', 'reserva', 'espacio_nombre'
        ]
        read_only_fields = ['fecha_creacion']

class HistorialAprobacionSerializer(serializers.ModelSerializer):
    admin_nombre = serializers.CharField(source='usuario_admin.username', read_only=True)
    class Meta:
        model = HistorialAprobacion
        fields = '__all__'
============================================================


===== services.py =====
from django.utils import timezone
from .models import Notificacion, Reserva
from django.contrib.auth.models import User

class NotificacionService:
    
    @staticmethod
    def crear_notificacion(destinatario, tipo, titulo, mensaje, reserva=None):
        """
        Crea una notificaci√≥n gen√©rica
        """
        try:
            notificacion = Notificacion.objects.create(
                destinatario=destinatario,
                tipo=tipo,
                titulo=titulo,
                mensaje=mensaje,
                reserva=reserva
            )
            print(f"üìß Notificaci√≥n creada: {titulo} para {destinatario.username}")
            return notificacion
        except Exception as e:
            print(f"‚ùå Error creando notificaci√≥n: {e}")
            return None
    
    @staticmethod
    def crear_notificacion_reserva(reserva, tipo, titulo, mensaje):
        """
        Crea una notificaci√≥n relacionada con una reserva
        """
        try:
            return NotificacionService.crear_notificacion(
                destinatario=reserva.solicitante,
                tipo=tipo,
                titulo=titulo,
                mensaje=mensaje,
                reserva=reserva
            )
        except Exception as e:
            print(f"‚ùå Error en crear_notificacion_reserva: {e}")
            return None
    
    @staticmethod
    def notificar_creacion_reserva(reserva):
        """
        Notifica al usuario que su reserva fue creada exitosamente
        """
        try:
            mensaje = f"Tu solicitud de reserva para {reserva.espacio.nombre} el {reserva.fecha_reserva.strftime('%d/%m/%Y')} de {reserva.hora_inicio.strftime('%H:%M')} a {reserva.hora_fin.strftime('%H:%M')} ha sido recibida y est√° pendiente de aprobaci√≥n."
            
            notificacion = NotificacionService.crear_notificacion_reserva(
                reserva=reserva,
                tipo='reserva_creada',
                titulo='üìã Reserva Creada Exitosamente',
                mensaje=mensaje
            )
            
            if notificacion:
                print(f"‚úÖ Notificaci√≥n de creaci√≥n enviada para reserva {reserva.id}")
            else:
                print(f"‚ùå Fall√≥ notificaci√≥n de creaci√≥n para reserva {reserva.id}")
                
            return notificacion
        except Exception as e:
            print(f"‚ùå Error en notificar_creacion_reserva: {e}")
            return None
    
    @staticmethod
    def notificar_aprobacion_reserva(reserva, comentario_admin=None):
        """
        Notifica al usuario que su reserva fue aprobada - VERSI√ìN CORREGIDA
        """
        try:
            mensaje = f"‚úÖ Tu reserva para {reserva.espacio.nombre} el {reserva.fecha_reserva.strftime('%d/%m/%Y')} ha sido APROBADA."
            if comentario_admin:
                mensaje += f"\n\nComentario del administrador: {comentario_admin}"
            
            notificacion = NotificacionService.crear_notificacion_reserva(
                reserva=reserva,
                tipo='reserva_aprobada',
                titulo='‚úÖ Reserva Aprobada',
                mensaje=mensaje
            )
            
            if notificacion:
                print(f"‚úÖ Notificaci√≥n de aprobaci√≥n enviada para reserva {reserva.id}")
            else:
                print(f"‚ùå Fall√≥ notificaci√≥n de aprobaci√≥n para reserva {reserva.id}")
                
            return notificacion
        except Exception as e:
            print(f"‚ùå Error en notificar_aprobacion_reserva: {e}")
            return None
    
    @staticmethod
    def notificar_rechazo_reserva(reserva, motivo):
        """
        Notifica al usuario que su reserva fue rechazada - VERSI√ìN CORREGIDA
        """
        try:
            mensaje = f"‚ùå Tu reserva para {reserva.espacio.nombre} el {reserva.fecha_reserva.strftime('%d/%m/%Y')} ha sido RECHAZADA.\n\nMotivo: {motivo}"
            
            notificacion = NotificacionService.crear_notificacion_reserva(
                reserva=reserva,
                tipo='reserva_rechazada',
                titulo='‚ùå Reserva Rechazada',
                mensaje=mensaje
            )
            
            if notificacion:
                print(f"‚úÖ Notificaci√≥n de rechazo enviada para reserva {reserva.id}")
            else:
                print(f"‚ùå Fall√≥ notificaci√≥n de rechazo para reserva {reserva.id}")
                
            return notificacion
        except Exception as e:
            print(f"‚ùå Error en notificar_rechazo_reserva: {e}")
            return None
    
    # Los dem√°s m√©todos permanecen igual...
    @staticmethod
    def notificar_cancelacion_reserva(reserva, motivo=None):
        """Notifica al usuario que su reserva fue cancelada"""
        try:
            mensaje = f"üìù Tu reserva para {reserva.espacio.nombre} el {reserva.fecha_reserva.strftime('%d/%m/%Y')} ha sido CANCELADA."
            if motivo:
                mensaje += f"\n\nMotivo: {motivo}"
            
            return NotificacionService.crear_notificacion_reserva(
                reserva=reserva,
                tipo='reserva_cancelada',
                titulo='üìù Reserva Cancelada',
                mensaje=mensaje
            )
        except Exception as e:
            print(f"‚ùå Error en notificar_cancelacion_reserva: {e}")
            return None

    @staticmethod
    def obtener_notificaciones_usuario(usuario, no_leidas=False, limite=10):
        """Obtiene las notificaciones de un usuario"""
        try:
            notificaciones = Notificacion.objects.filter(destinatario=usuario)
            
            if no_leidas:
                notificaciones = notificaciones.filter(leida=False)
            
            return notificaciones.select_related('reserva', 'reserva__espacio').order_by('-fecha_creacion')[:limite]
        except Exception as e:
            print(f"‚ùå Error en obtener_notificaciones_usuario: {e}")
            return []
    
    @staticmethod
    def marcar_como_leida(notificacion_id):
        """
        Marca una notificaci√≥n espec√≠fica como le√≠da
        """
        try:
            notificacion = Notificacion.objects.get(id=notificacion_id)
            notificacion.marcar_como_leida()
            return True
        except Notificacion.DoesNotExist:
            return False
    
    @staticmethod
    def marcar_todas_como_leidas(usuario):
        """
        Marca todas las notificaciones de un usuario como le√≠das
        """
        notificaciones = Notificacion.objects.filter(
            destinatario=usuario, 
            leida=False
        )
        
        count = notificaciones.count()
        notificaciones.update(leida=True, fecha_lectura=timezone.now())
        
        print(f"üì≠ Marcadas {count} notificaciones como le√≠das para {usuario.username}")
        return count
    
    @staticmethod
    def contar_notificaciones_no_leidas(usuario):
        """
        Cuenta las notificaciones no le√≠das de un usuario
        """
        return Notificacion.objects.filter(
            destinatario=usuario,
            leida=False
        ).count()

class NotificacionAdminService:
    
    @staticmethod
    def crear_notificacion_admin(tipo, titulo, mensaje, prioridad='media', usuario_relacionado=None, 
                               reserva=None, espacio=None, request=None):
        """
        Crea una notificaci√≥n para administradores
        """
        try:
            notificacion = NotificacionAdmin.objects.create(
                tipo=tipo,
                titulo=titulo,
                mensaje=mensaje,
                prioridad=prioridad,
                usuario_relacionado=usuario_relacionado,
                reserva=reserva,
                espacio=espacio
            )
            
            # Agregar informaci√≥n de la solicitud si est√° disponible
            if request:
                notificacion.ip_address = get_client_ip(request)
                notificacion.user_agent = request.META.get('HTTP_USER_AGENT', '')
                notificacion.save()
            
            print(f"üì¢ Notificaci√≥n Admin creada: {titulo}")
            return notificacion
            
        except Exception as e:
            print(f"‚ùå Error creando notificaci√≥n admin: {e}")
            return None
    
    @staticmethod
    def notificar_nueva_reserva(reserva, request=None):
        """Notifica a los admin sobre nueva reserva"""
        mensaje = f"El usuario {reserva.solicitante.username} ha creado una nueva reserva para {reserva.espacio.nombre} el {reserva.fecha_reserva.strftime('%d/%m/%Y')} de {reserva.hora_inicio.strftime('%H:%M')} a {reserva.hora_fin.strftime('%H:%M')}."
        
        return NotificacionAdminService.crear_notificacion_admin(
            tipo='reserva_creada',
            titulo='üìã Nueva Reserva Creada',
            mensaje=mensaje,
            prioridad='alta',
            usuario_relacionado=reserva.solicitante,
            reserva=reserva,
            request=request
        )
    
    @staticmethod
    def notificar_usuario_registrado(usuario, request=None):
        """Notifica a los admin sobre nuevo usuario registrado"""
        mensaje = f"El usuario {usuario.username} ({usuario.first_name} {usuario.last_name}) se ha registrado en el sistema."
        
        return NotificacionAdminService.crear_notificacion_admin(
            tipo='usuario_registrado',
            titulo='üë§ Nuevo Usuario Registrado',
            mensaje=mensaje,
            prioridad='media',
            usuario_relacionado=usuario,
            request=request
        )
    
    @staticmethod
    def notificar_espacio_creado(espacio, usuario_admin, request=None):
        """Notifica a los admin sobre nuevo espacio creado"""
        mensaje = f"El administrador {usuario_admin.username} ha creado el espacio '{espacio.nombre}' ({espacio.tipo})."
        
        return NotificacionAdminService.crear_notificacion_admin(
            tipo='espacio_creado',
            titulo='üè¢ Nuevo Espacio Creado',
            mensaje=mensaje,
            prioridad='media',
            usuario_relacionado=usuario_admin,
            espacio=espacio,
            request=request
        )
    
    @staticmethod
    def notificar_sesion_admin(usuario_admin, accion, request=None):
        """Notifica sobre sesiones de administradores"""
        if accion == 'inicio':
            titulo = 'üîê Sesi√≥n de Admin Iniciada'
            mensaje = f"El administrador {usuario_admin.username} ha iniciado sesi√≥n."
            tipo = 'sesion_iniciada'
        else:  # cierre
            titulo = 'üö™ Sesi√≥n de Admin Cerrada'
            mensaje = f"El administrador {usuario_admin.username} ha cerrado sesi√≥n."
            tipo = 'sesion_cerrada'
        
        return NotificacionAdminService.crear_notificacion_admin(
            tipo=tipo,
            titulo=titulo,
            mensaje=mensaje,
            prioridad='baja',
            usuario_relacionado=usuario_admin,
            request=request
        )
    
    @staticmethod
    def notificar_accion_reserva(reserva, usuario_admin, accion, motivo=None, request=None):
        """Notifica acciones sobre reservas (aprobaci√≥n/rechazo)"""
        if accion == 'aprobada':
            titulo = '‚úÖ Reserva Aprobada'
            mensaje = f"El administrador {usuario_admin.username} ha APROBADO la reserva de {reserva.espacio.nombre} para {reserva.solicitante.username}."
            tipo = 'reserva_aprobada'
        else:  # rechazada
            titulo = '‚ùå Reserva Rechazada'
            mensaje = f"El administrador {usuario_admin.username} ha RECHAZADO la reserva de {reserva.espacio.nombre} para {reserva.solicitante.username}."
            if motivo:
                mensaje += f" Motivo: {motivo}"
            tipo = 'reserva_rechazada'
        
        return NotificacionAdminService.crear_notificacion_admin(
            tipo=tipo,
            titulo=titulo,
            mensaje=mensaje,
            prioridad='alta',
            usuario_relacionado=usuario_admin,
            reserva=reserva,
            request=request
        )

def get_client_ip(request):
    """Obtiene la IP real del cliente"""
    x_forwarded_for = request.META.get('HTTP_X_FORWARDED_FOR')
    if x_forwarded_for:
        ip = x_forwarded_for.split(',')[0]
    else:
        ip = request.META.get('REMOTE_ADDR')
    return ip
============================================================


===== urls.py =====
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from . import views

router = DefaultRouter()
router.register(r'users', views.UserViewSet)
router.register(r'perfiles', views.PerfilUsuarioViewSet)
#router.register(r'espacios', views.EspacioViewSet)
router.register(r'reservas', views.ReservaViewSet)
router.register(r'notificaciones', views.NotificacionViewSet)
router.register(r'historial', views.HistorialAprobacionViewSet)
router.register(r'equipamientos', views.EquipamientoViewSet)
router.register(r'areas', views.AreaViewSet)

urlpatterns = [
    # P√°ginas principales
    path('', views.login_view, name='login'),
    path('login/', views.login_view, name='login'),
    path('dashboard/', views.dashboard_view, name='dashboard'),
    path('logout/', views.logout_view, name='logout'),
    path('api/', include(router.urls)),
    
    # API endpoints
    path('api/reservas/', views.get_user_reservas, name='get_reservas'),
    path('api/espacios/', views.get_espacios_disponibles, name='get_espacios'),
    path('api/notificaciones/', views.get_notificaciones_usuario, name='get_notificaciones'),
    path('api/incidencias/reportar/', views.reportar_incidencia, name='reportar_incidencia'),
    path('api/dashboard/stats/', views.get_dashboard_stats, name='dashboard_stats'),
    path('api/registro/', views.registro_usuario, name='registro_usuario'),
    path('api/reservas/<int:reserva_id>/cancelar/', views.cancelar_reserva_api, name='cancelar_reserva_api'),
    path('api/crear-reserva/', views.crear_reserva_api, name='crear_reserva_api'),
    
    # API de notificaciones
    path('api/notificaciones/contar/', views.contar_notificaciones_no_leidas, name='contar_notificaciones'),
    path('api/notificaciones/marcar-todas-leidas/', views.marcar_todas_leidas, name='marcar_todas_leidas'),
    path('api/notificaciones/<int:notificacion_id>/marcar-leida/', views.marcar_notificacion_leida, name='marcar_notificacion_leida'),
    path('api/reservas/<int:reserva_id>/aprobar/', views.aprobar_reserva_api, name='aprobar_reserva_api'),
    path('api/reservas/<int:reserva_id>/rechazar/', views.rechazar_reserva_api, name='rechazar_reserva_api'),
    
    # Vistas de p√°ginas HTML
    path('espacios/', views.espacios_view, name='espacios'),
    path('reservas/', views.reservas_view, name='reservas'),
    path('notificaciones/', views.notificaciones_view, name='notificaciones'),
    path('calendario/', views.calendario_view, name='calendario'),
    path('crear-reserva/', views.crear_reserva_view, name='crear_reserva'),
    path('reserva-exitosa/', views.reserva_exitosa, name='reserva_exitosa'),
    path('detalle-reserva/', views.detalle_reserva_view, name='detalle_reserva'),
    path('cancelar-reserva/', views.cancelar_reserva_view, name='cancelar_reserva'),
    
    # Vistas de administraci√≥n
    path('admin-dashboard/', views.admin_dashboard_view, name='admin_dashboard'),
    path('solicitudes-pendientes/', views.solicitudes_pendientes_view, name='solicitudes_pendientes'),
    path('gestion-espacios/', views.gestion_espacios_view, name='gestion_espacios'),
    path('gestion-usuarios/', views.gestion_usuarios_view, name='gestion_usuarios'),
    path('reportes/', views.reportes_view, name='reportes'),
    path('revisar-solicitud/', views.revisar_solicitud_view, name='revisar_solicitud'),
    path('force-logout/', views.force_logout, name='force_logout'),
    
    # APIs para gesti√≥n de usuarios
    path('api/usuarios/<int:user_id>/', views.obtener_usuario_api, name='obtener_usuario_api'),
    path('api/usuarios/<int:user_id>/actualizar/', views.actualizar_usuario_api, name='actualizar_usuario_api'),
    path('api/usuarios/<int:user_id>/cambiar-estado/', views.cambiar_estado_usuario_api, name='cambiar_estado_usuario_api'),
    path('api/perfiles/', views.obtener_perfiles_usuario_api, name='obtener_perfiles_usuario_api'),
    
    # APIs para gesti√≥n de espacios (NUEVAS - IMPORTANTE)
    path('crear-espacio/', views.crear_espacio_view, name='crear_espacio'),
    path('editar-espacio/', views.editar_espacio_view, name='editar_espacio'),
    path('api/espacios/crear/', views.crear_espacio_api, name='crear_espacio_api'),
    path('api/espacios/<int:espacio_id>/', views.obtener_espacio_api, name='obtener_espacio_api'),
    path('api/espacios/<int:espacio_id>/actualizar/', views.actualizar_espacio_api, name='actualizar_espacio_api'),
    path('api/espacios/<int:espacio_id>/eliminar/', views.eliminar_espacio_api, name='eliminar_espacio_api'), 
    # Notificaciones de administrador
path('notificaciones-admin/', views.notificaciones_admin_view, name='notificaciones_admin'),
path('api/notificaciones-admin/', views.get_notificaciones_admin_api, name='get_notificaciones_admin_api'),
path('api/notificaciones-admin/contar/', views.contar_notificaciones_admin_no_leidas, name='contar_notificaciones_admin_no_leidas'),
path('api/notificaciones-admin/marcar-todas-leidas/', views.marcar_todas_notificaciones_admin_leidas, name='marcar_todas_notificaciones_admin_leidas'),
path('api/notificaciones-admin/<int:notificacion_id>/marcar-leida/', views.marcar_notificacion_admin_leida, name='marcar_notificacion_admin_leida'),
]
============================================================


===== utils.py =====
from django.db.models import Q
from django.utils import timezone
from .models import Reserva, Mantenimiento, HorariosDisponibilidad
from datetime import datetime, time, date

def validar_disponibilidad_espacio(espacio_id, fecha, hora_inicio, hora_fin, reserva_excluida_id=None):
    """
    Valida que no existan reservas solapadas para el mismo espacio
    
    Args:
        espacio_id: ID del espacio a validar
        fecha: fecha de la reserva
        hora_inicio: hora de inicio
        hora_fin: hora de fin
        reserva_excluida_id: ID de reserva a excluir (para ediciones)
    
    Returns:
        tuple: (disponible, mensaje_error)
    """
    try:
        # Convertir a objetos time si son strings
        if isinstance(hora_inicio, str):
            hora_inicio = datetime.strptime(hora_inicio, '%H:%M:%S').time()
        if isinstance(hora_fin, str):
            hora_fin = datetime.strptime(hora_fin, '%H:%M:%S').time()
        
        # Validar que la hora de fin sea despu√©s de la hora de inicio
        if hora_inicio >= hora_fin:
            return False, "La hora de fin debe ser posterior a la hora de inicio"
        
        # Validar reservas existentes
        reservas_query = Reserva.objects.filter(
            espacio_id=espacio_id,
            fecha_reserva=fecha,
            estado__in=['Aprobada', 'Pendiente']  # Solo considerar reservas activas
        )
        
        # Excluir la reserva actual si se est√° editando
        if reserva_excluida_id:
            reservas_query = reservas_query.exclude(id=reserva_excluida_id)
        
        # Buscar solapamientos
        reservas_solapadas = reservas_query.exclude(
            Q(hora_fin__lte=hora_inicio) | Q(hora_inicio__gte=hora_fin)
        )
        
        if reservas_solapadas.exists():
            return False, "El espacio no est√° disponible en el horario seleccionado"
        
        # Validar mantenimiento programado
        mantenimiento_activo = Mantenimiento.objects.filter(
            id_espacio_id=espacio_id,
            fecha_inicio__lte=fecha,
            fecha_fin__gte=fecha,
            estado__in=['Programado', 'En Proceso']
        ).exists()
        
        if mantenimiento_activo:
            return False, "El espacio est√° en mantenimiento en la fecha seleccionada"
        
        # Validar horarios de disponibilidad del espacio
        dia_semana = fecha.strftime('%A')
        dias_semana_es = {
            'Monday': 'Lunes',
            'Tuesday': 'Martes',
            'Wednesday': 'Mi√©rcoles',
            'Thursday': 'Jueves',
            'Friday': 'Viernes',
            'Saturday': 'S√°bado',
            'Sunday': 'Domingo'
        }
        
        dia_semana_es = dias_semana_es.get(dia_semana, dia_semana)
        
        horario_disponibilidad = HorariosDisponibilidad.objects.filter(
            id_espacio_id=espacio_id,
            dia_semana=dia_semana_es,
            fecha_inicio_vigencia__lte=fecha
        ).order_by('-fecha_inicio_vigencia').first()
        
        if horario_disponibilidad:
            if hora_inicio < horario_disponibilidad.hora_apertura or hora_fin > horario_disponibilidad.hora_cierre:
                return False, f"El espacio solo est√° disponible de {horario_disponibilidad.hora_apertura} a {horario_disponibilidad.hora_cierre}"
        
        return True, "El espacio est√° disponible"
        
    except Exception as e:
        return False, f"Error al validar disponibilidad: {str(e)}"

def calcular_duracion(hora_inicio, hora_fin):
    """
    Calcular la duraci√≥n en formato legible
    """
    try:
        if isinstance(hora_inicio, str):
            hora_inicio = datetime.strptime(hora_inicio, '%H:%M:%S').time()
        if isinstance(hora_fin, str):
            hora_fin = datetime.strptime(hora_fin, '%H:%M:%S').time()
        
        diferencia = datetime.combine(date.today(), hora_fin) - datetime.combine(date.today(), hora_inicio)
        horas = diferencia.seconds // 3600
        minutos = (diferencia.seconds % 3600) // 60
        
        if horas > 0:
            return f"{horas} hora{'s' if horas > 1 else ''} {minutos} minuto{'s' if minutos > 1 else ''}"
        else:
            return f"{minutos} minutos"
    except Exception as e:
        return "Duraci√≥n no disponible"

def obtener_estadisticas_uso_espacio(espacio_id, mes=None, a√±o=None):
    """
    Obtiene estad√≠sticas de uso de un espacio
    """
    if not mes:
        mes = timezone.now().month
    if not a√±o:
        a√±o = timezone.now().year
    
    reservas_mes = Reserva.objects.filter(
        espacio_id=espacio_id,
        fecha_reserva__month=mes,
        fecha_reserva__year=a√±o,
        estado='Aprobada'
    )
    
    return {
        'total_reservas': reservas_mes.count(),
        'dias_ocupados': reservas_mes.dates('fecha_reserva', 'day').count(),
        'horas_totales': sum(
            (reserva.hora_fin.hour - reserva.hora_inicio.hour) + 
            (reserva.hora_fin.minute - reserva.hora_inicio.minute) / 60 
            for reserva in reservas_mes
        )
    }
============================================================


===== views.py =====
# reservas/views.py
from rest_framework import viewsets, permissions
from django.contrib.auth.models import User
from .models import Espacio, Reserva, PerfilUsuario, Equipamiento, Area, Notificacion, HistorialAprobacion
from .serializers import (
    UserSerializer, PerfilUsuarioSerializer, EquipamientoSerializer, 
    AreaSerializer, EspacioSerializer, ReservaSerializer, 
    NotificacionSerializer, HistorialAprobacionSerializer
)
from django.shortcuts import render, redirect
from django.contrib.auth import authenticate, login, logout
from django.contrib.auth.decorators import login_required
from django.http import JsonResponse
from django.views.decorators.http import require_http_methods
from django.views.decorators.csrf import csrf_exempt
from django.utils import timezone
import json
from .models import PerfilUsuario, Reserva, Espacio, Notificacion, Incidencia, Area
from django.contrib.auth.models import User
from django.db import IntegrityError
from django.db.models import Q
import traceback
from .services import NotificacionService
from datetime import datetime, date, time
from django.contrib import messages
from django.contrib.auth.decorators import user_passes_test
from django.core.exceptions import PermissionDenied
from .models import NotificacionAdmin  # Agrega esto
from .services import NotificacionAdminService  # Agrega esto

def is_admin_user(user):
    """Verifica si el usuario tiene permisos de administrador"""
    try:
        perfil = PerfilUsuario.objects.get(user=user)
        return perfil.rol in ['Administrativo', 'Investigacion', 'Aprobador']
    except PerfilUsuario.DoesNotExist:
        return False

# Agrega este decorador a las vistas de gesti√≥n de espacios
@login_required
@user_passes_test(is_admin_user, login_url='/dashboard/')
def crear_espacio_view(request):
    """Vista para crear espacio (template)"""
    return render(request, 'reservas/crear_espacio.html')

# --- Vista de Login Modificada ---
@csrf_exempt
def login_view(request):
    if request.method == 'GET':
        if request.user.is_authenticated:
            return redirect('dashboard')
        return render(request, 'reservas/login.html')

    if request.method == 'POST':
        try:
            data = json.loads(request.body)
            email = data.get('email', '').strip()
            password = data.get('password')
            user_type = data.get('user_type', 'usuario')  # 'usuario' o 'administrador'

            print(f"üîê Intento de login: {email} - Tipo: {user_type}")

            if not email or not password:
                return JsonResponse({
                    'success': False,
                    'message': 'Correo electr√≥nico y contrase√±a son requeridos.'
                }, status=400)

            # Autenticaci√≥n
            user = authenticate(request, username=email, password=password)
            
            if user is not None and user.is_active:
                try:
                    perfil = PerfilUsuario.objects.get(user=user)
                    print(f"üë§ Perfil encontrado: {perfil.rol}")
                    
                    # üîë VERIFICACI√ìN CORREGIDA DE ACCESO - ACTUALIZADA
                    is_admin_login = user_type == 'administrador'
                    
                    # Roles que pueden acceder como administradores
                    admin_roles = ['Administrativo', 'Investigacion', 'Aprobador']
                    # Roles que pueden acceder como usuarios normales (todos)
                    user_roles = ['Usuario', 'Docente', 'Investigacion', 'Administrativo', 'Aprobador']
                    
                    print(f"üîÑ Login tipo: {user_type}, Rol usuario: {perfil.rol}")
                    print(f"üéØ Roles admin: {admin_roles}")
                    print(f"üéØ Roles usuario: {user_roles}")
                    
                    if is_admin_login:
                        # Para login de administrador: solo roles espec√≠ficos de admin
                        if perfil.rol not in admin_roles:
                            return JsonResponse({
                                'success': False,
                                'message': f'No tienes permisos de administrador. Tu rol es: {perfil.rol}. Solo Personal Administrativo e Investigaci√≥n pueden acceder aqu√≠.'
                            }, status=403)
                    else:
                        # Para login de usuario: todos los roles pueden acceder
                        if perfil.rol not in user_roles:
                            return JsonResponse({
                                'success': False,
                                'message': f'Rol no autorizado. Tu rol es: {perfil.rol}'
                            }, status=403)

                    # ‚úÖ Login exitoso
                    login(request, user)
                    perfil.ultimo_acceso = timezone.now()
                    perfil.save()

                    print(f"‚úÖ Login exitoso - Redirigiendo a dashboard")

                    return JsonResponse({
                        'success': True,
                        'message': 'Login exitoso',
                        'redirect_url': '/dashboard/'
                    })

                except PerfilUsuario.DoesNotExist:
                    return JsonResponse({
                        'success': False,
                        'message': 'Error: Perfil de usuario no configurado.'
                    }, status=500)
            else:
                return JsonResponse({
                    'success': False, 
                    'message': 'Credenciales incorrectas o cuenta desactivada'
                }, status=401)

        except Exception as e:
            print(f"üí• Error en login: {str(e)}")
            return JsonResponse({
                'success': False, 
                'message': 'Error interno del servidor'
            }, status=500)

# --- Funci√≥n de Registro Autom√°tico Modificada ---
def registrar_usuario_automatico(email, password, rol='Usuario'):
    """Registra un usuario autom√°ticamente si no existe (insensible a may√∫sculas/min√∫sculas)."""
    try:
        username_base = email.split('@')[0]
        first_name = username_base.capitalize()

        if User.objects.filter(Q(email__iexact=email) | Q(username__iexact=email)).exists():
            print(f"‚ö†Ô∏è Intento de registro autom√°tico para usuario existente: {email}")
            return None

        user = User.objects.create_user(
            username=email,
            email=email,
            password=password,
            first_name=first_name,
            last_name='Usuario'
        )
        print(f"‚úÖ Usuario base creado: {email}")

        area_default, _ = Area.objects.get_or_create(
            nombre_area="General",
            defaults={'descripcion': '√Årea general por defecto'}
        )

        PerfilUsuario.objects.create(
            user=user,
            rol=rol,
            area=area_default,
            departamento='Indefinido',
            estado='activo'
        )
        print(f"‚úÖ PerfilUsuario creado para: {email}")
        return user

    except IntegrityError as e:
         print(f"‚ùå Error de integridad al registrar usuario {email}: {e}")
         return None
    except Exception as e:
        print(f"‚ùå Error inesperado registrando usuario {email}: {e}")
        traceback.print_exc()
        return None

# --- Vista del Dashboard Modificada ---
@login_required
def dashboard_view(request):
    try:
        perfil = PerfilUsuario.objects.get(user=request.user)
        print(f"üéØ Usuario {request.user.username} accediendo a dashboard. Rol: {perfil.rol}")
        
        # Obtener datos REALES de la base de datos
        reservas_usuario = Reserva.objects.filter(solicitante=request.user)
        reservas_activas = reservas_usuario.filter(
            estado='Aprobada', 
            fecha_reserva__gte=timezone.now().date()
        ).count()
        reservas_pendientes = reservas_usuario.filter(estado='Pendiente').count()
        
        # Obtener las 5 reservas m√°s recientes
        reservas_recientes = reservas_usuario.select_related('espacio').order_by('-fecha_solicitud')[:5]
        
        print(f"üìä Estad√≠sticas - Activas: {reservas_activas}, Pendientes: {reservas_pendientes}, Total: {reservas_usuario.count()}")
        
        context = {
            'user': request.user,
            'perfil': perfil,
            'reservas_activas': reservas_activas,
            'reservas_pendientes': reservas_pendientes,
            'total_reservas': reservas_usuario.count(),
            'reservas_recientes': reservas_recientes,
        }
        
        # Redirigir seg√∫n el rol - ACTUALIZADO
        if perfil.rol in ['Administrativo', 'Investigacion', 'Aprobador']:
            print("‚û°Ô∏è Redirigiendo a dashboard admin")
            return render(request, 'reservas/dashboard_admin.html', context)
        else:
            print("‚û°Ô∏è Redirigiendo a dashboard usuario")
            return render(request, 'reservas/dashboard_usuario.html', context)
            
    except PerfilUsuario.DoesNotExist:
        print(f"‚ùå Usuario {request.user.username} no tiene perfil")
        logout(request)
        return redirect('login')
    except Exception as e:
        print(f"üí• Error en dashboard: {str(e)}")
        import traceback
        traceback.print_exc()
        logout(request)
        return redirect('login')

@login_required
def reservas_view(request):
    """Vista del historial de reservas con datos REALES"""
    try:
        # Obtener reservas REALES del usuario
        reservas = Reserva.objects.filter(solicitante=request.user).order_by('-fecha_solicitud')
        
        context = {
            'user': request.user,
            'reservas': reservas,
            'reservas_count': reservas.count()
        }
        return render(request, 'reservas/reservas.html', context)
        
    except Exception as e:
        print(f"Error en reservas_view: {e}")
        return render(request, 'reservas/reservas.html', {'reservas': [], 'reservas_count': 0})

@login_required
def calendario_view(request):
    """Vista del calendario con eventos REALES"""
    try:
        # Obtener reservas REALES para el calendario
        reservas_calendario = Reserva.objects.filter(
            solicitante=request.user,
            fecha_reserva__month=timezone.now().month
        ).select_related('espacio')
        
        eventos_calendario = []
        for reserva in reservas_calendario:
            eventos_calendario.append({
                'title': reserva.espacio.nombre,
                'start': f"{reserva.fecha_reserva}T{reserva.hora_inicio}",
                'end': f"{reserva.fecha_reserva}T{reserva.hora_fin}",
                'color': '#10b981' if reserva.estado == 'Aprobada' else '#f59e0b',
                'estado': reserva.estado
            })
        
        context = {
            'user': request.user,
            'eventos': eventos_calendario
        }
        return render(request, 'reservas/calendario.html', context)
        
    except Exception as e:
        print(f"Error en calendario_view: {e}")
        return render(request, 'reservas/calendario.html', {'eventos': []})

# --- Vistas de API ---
@login_required
def get_user_reservas(request):
    try:
        reservas = Reserva.objects.filter(solicitante=request.user).order_by('-fecha_solicitud')
        data = []
        for reserva in reservas:
            data.append({
                'id': reserva.id,
                'espacio': reserva.espacio.nombre,
                'fecha': reserva.fecha_reserva.strftime('%d/%m/%Y'),
                'hora_inicio': reserva.hora_inicio.strftime('%H:%M'),
                'hora_fin': reserva.hora_fin.strftime('%H:%M'),
                'estado': reserva.estado,
                'proposito': reserva.proposito,
                'num_asistentes': reserva.num_asistentes,
                'fecha_solicitud': reserva.fecha_solicitud.strftime('%d/%m/%Y %H:%M')
            })
        return JsonResponse({'success': True, 'reservas': data})
    except Exception as e:
        print(f"‚ùå Error en get_user_reservas: {e}")
        traceback.print_exc()
        return JsonResponse({'success': False, 'error': str(e)})

@login_required
def get_espacios_disponibles(request):
    try:
        espacios = Espacio.objects.filter(estado='Disponible')
        data = []
        for espacio in espacios:
            data.append({
                'id': espacio.id,
                'nombre': espacio.nombre,
                'tipo': espacio.tipo,
                'edificio': espacio.edificio,
                'piso': espacio.piso,
                'capacidad': espacio.capacidad,
                'descripcion': espacio.descripcion,
                'estado': espacio.estado
            })
        return JsonResponse({'success': True, 'espacios': data})
    except Exception as e:
        print(f"‚ùå Error en get_espacios_disponibles: {e}")
        traceback.print_exc()
        return JsonResponse({'success': False, 'error': str(e)})

@login_required
def get_notificaciones(request):
    try:
        notificaciones = Notificacion.objects.filter(
            destinatario=request.user,
            leida=False
        ).order_by('-fecha_creacion')[:10]

        data = []
        for notif in notificaciones:
            data.append({
                'id': notif.id,
                'tipo': notif.tipo,
                'titulo': notif.titulo,
                'mensaje': notif.mensaje,
                'fecha': notif.fecha_creacion.strftime('%d/%m/%Y %H:%M'),
                'leida': notif.leida
            })
        return JsonResponse({'success': True, 'notificaciones': data})
    except Exception as e:
        print(f"‚ùå Error en get_notificaciones: {e}")
        traceback.print_exc()
        return JsonResponse({'success': False, 'error': str(e)})

@login_required
@csrf_exempt
def reportar_incidencia(request):
    if request.method == 'POST':
        try:
            data = json.loads(request.body)
            incidencia = Incidencia.objects.create(
                id_usuario=request.user,
                descripcion=data.get('descripcion'),
                prioridad=data.get('prioridad', 'Media'),
                id_espacio_id=data.get('id_espacio'),
                id_equipo_id=data.get('id_equipo')
            )
            return JsonResponse({'success': True, 'incidencia_id': incidencia.id})
        except Exception as e:
            print(f"‚ùå Error en reportar_incidencia: {e}")
            traceback.print_exc()
            return JsonResponse({'success': False, 'error': str(e)}, status=500)
    return JsonResponse({'success': False, 'error': 'M√©todo no permitido'}, status=405)

@csrf_exempt
def registro_usuario(request):
    """
    Vista para registrar nuevos usuarios desde el formulario de registro
    """
    if request.method == 'POST':
        try:
            data = json.loads(request.body)
            email = data.get('email', '').strip().lower()
            password = data.get('password')
            first_name = data.get('first_name', '').strip()
            last_name = data.get('last_name', '').strip()
            department = data.get('department', 'Indefinido')
            rol = data.get('rol', 'Usuario')

            # Validaciones b√°sicas
            if not all([email, password, first_name, last_name]):
                return JsonResponse({
                    'success': False,
                    'message': 'Todos los campos son requeridos'
                }, status=400)

            if len(password) < 6:
                return JsonResponse({
                    'success': False,
                    'message': 'La contrase√±a debe tener al menos 6 caracteres'
                }, status=400)

            # Verificar si el usuario ya existe
            if User.objects.filter(Q(email__iexact=email) | Q(username__iexact=email)).exists():
                return JsonResponse({
                    'success': False,
                    'message': 'Ya existe un usuario con este correo electr√≥nico'
                }, status=400)

            # Validar que el rol sea permitido para registro p√∫blico
            roles_permitidos = ['Usuario', 'Docente', 'Investigacion', 'Administrativo']
            if rol not in roles_permitidos:
                return JsonResponse({
                    'success': False,
                    'message': 'Rol no v√°lido para registro p√∫blico'
                }, status=400)

            # Crear el usuario
            user = User.objects.create_user(
                username=email,
                email=email,
                password=password,
                first_name=first_name,
                last_name=last_name
            )

            # Obtener o crear √°rea por defecto
            area, _ = Area.objects.get_or_create(
                nombre_area="General",
                defaults={'descripcion': '√Årea general por defecto'}
            )

            # Crear perfil de usuario CON EL ROL SELECCIONADO
            PerfilUsuario.objects.create(
                user=user,
                rol=rol,
                area=area,
                departamento=department,
                estado='activo'
            )

            print(f"‚úÖ Nuevo usuario registrado: {email} - {first_name} {last_name} - Rol: {rol}")

            try:
                from .services import NotificacionAdminService
                NotificacionAdminService.notificar_usuario_registrado(user, request)
                print(f"üì¢ Notificaci√≥n de admin creada para nuevo usuario: {user.username}")
            except Exception as notif_error:
                print(f"‚ö†Ô∏è Error en notificaci√≥n de admin: {notif_error}")

            return JsonResponse({
                'success': True,
                'message': 'Usuario registrado exitosamente. Ahora puedes iniciar sesi√≥n.'
            })

        except json.JSONDecodeError:
            return JsonResponse({
                'success': False,
                'message': 'Error en los datos enviados'
            }, status=400)
        except Exception as e:
            print(f"‚ùå Error en registro_usuario: {e}")
            return JsonResponse({
                'success': False,
                'message': 'Error interno del servidor al crear la cuenta'
            }, status=500)

    return JsonResponse({
        'success': False,
        'message': 'M√©todo no permitido'
    }, status=405)

@login_required
def get_dashboard_stats(request):
    try:
        perfil = PerfilUsuario.objects.get(user=request.user)
        stats = {}

        # ACTUALIZADO: Roles de administraci√≥n
        if perfil.rol in ['Administrativo', 'Investigacion', 'Aprobador']:
            stats['reservas_pendientes_aprobacion'] = Reserva.objects.filter(
                estado='Pendiente'
            ).count()
            stats['total_espacios'] = Espacio.objects.count()
            stats['espacios_disponibles'] = Espacio.objects.filter(estado='Disponible').count()
        else:
            # Usuario normal
            stats['reservas_activas'] = Reserva.objects.filter(
                solicitante=request.user,
                estado='Aprobada',
                fecha_reserva__gte=timezone.now().date()
            ).count()
            stats['reservas_pendientes'] = Reserva.objects.filter(
                solicitante=request.user,
                estado='Pendiente'
            ).count()
            stats['total_reservas'] = Reserva.objects.filter(
                solicitante=request.user
            ).count()

        stats['notificaciones_sin_leer'] = Notificacion.objects.filter(
            destinatario=request.user,
            leida=False
        ).count()

        return JsonResponse({'success': True, 'stats': stats})

    except PerfilUsuario.DoesNotExist:
         print(f"‚ö†Ô∏è Error en get_dashboard_stats: Usuario {request.user.username} sin PerfilUsuario.")
         return JsonResponse({'success': False, 'error': 'Perfil no encontrado'}, status=404)
    except Exception as e:
        print(f"‚ùå Error en get_dashboard_stats: {e}")
        traceback.print_exc()
        return JsonResponse({'success': False, 'error': str(e)}, status=500)

# --- Vista de Logout ---
def logout_view(request):
    logout(request)
    return redirect('login')

# --- VISTAS PARA SERVIR TEMPLATES HTML ---
@login_required
def notificaciones_view(request):
    return render(request, 'reservas/notificaciones.html')

@login_required
def crear_reserva_view(request):
    """Vista para crear reserva con espacios disponibles"""
    try:
        # Obtener espacios disponibles
        espacios = Espacio.objects.filter(estado='Disponible').prefetch_related('equipamientos')
        
        # Obtener fecha actual para el formulario
        today = timezone.now().date()
        
        print(f"üè¢ Espacios disponibles encontrados: {espacios.count()}")
        
        context = {
            'user': request.user,
            'espacios': espacios,
            'today': today.isoformat()  # Para el campo date min
        }
        return render(request, 'reservas/crear_reserva.html', context)
        
    except Exception as e:
        print(f"‚ùå Error en crear_reserva_view: {e}")
        import traceback
        traceback.print_exc()
        # Si hay error, pasar lista vac√≠a
        context = {
            'user': request.user,
            'espacios': [],
            'today': timezone.now().date().isoformat()
        }
        return render(request, 'reservas/crear_reserva.html', context)

@login_required
def reserva_exitosa(request):
    """Vista de confirmaci√≥n de reserva exitosa con datos REALES"""
    reserva_id = request.GET.get('reserva_id')
    print(f"üîç ID de reserva recibido: {reserva_id}")
    
    try:
        if reserva_id:
            # Obtener la reserva espec√≠fica
            reserva = Reserva.objects.select_related('espacio').get(id=reserva_id, solicitante=request.user)
            print(f"‚úÖ Reserva encontrada: {reserva.id} - {reserva.espacio.nombre}")
        else:
            # Obtener la √∫ltima reserva del usuario
            reserva = Reserva.objects.select_related('espacio').filter(
                solicitante=request.user
            ).order_by('-fecha_solicitud').first()
            print(f"üìã √öltima reserva encontrada: {reserva.id if reserva else 'None'}")
        
        context = {
            'user': request.user,
            'reserva': reserva
        }
        return render(request, 'reservas/reserva_exitosa.html', context)
        
    except Reserva.DoesNotExist:
        print(f"‚ùå Reserva no encontrada: ID {reserva_id}")
        # Si no hay reserva, mostrar p√°gina gen√©rica
        context = {
            'user': request.user,
            'reserva': None
        }
        return render(request, 'reservas/reserva_exitosa.html', context)
    except Exception as e:
        print(f"üí• Error en reserva_exitosa: {e}")
        import traceback
        traceback.print_exc()
        context = {
            'user': request.user,
            'reserva': None
        }
        return render(request, 'reservas/reserva_exitosa.html', context)

@login_required
def detalle_reserva_view(request):
    """Vista de detalle de reserva con datos REALES de la BD"""
    reserva_id = request.GET.get('id')
    
    try:
        # Obtener la reserva espec√≠fica del usuario
        reserva = Reserva.objects.select_related('espacio', 'solicitante').get(
            id=reserva_id, 
            solicitante=request.user
        )
        
        # Formatear datos para el template
        context = {
            'user': request.user,
            'reserva': reserva,
            'reserva_data': {
                'id': reserva.id,
                'estado': reserva.estado.lower(),
                'espacio': {
                    'id': reserva.espacio.id,
                    'nombre': reserva.espacio.nombre,
                    'ubicacion': f"{reserva.espacio.edificio or 'Edificio Principal'}, Piso {reserva.espacio.piso or 'N/A'}",
                    'capacidad': f"{reserva.espacio.capacidad} personas",
                    'equipamiento': ', '.join([eq.nombre_equipo for eq in reserva.espacio.equipamientos.all()]) or "Equipamiento b√°sico",
                    'descripcion': reserva.espacio.descripcion or "Espacio disponible para reuniones y eventos."
                },
                'fecha': reserva.fecha_reserva.strftime('%A, %d de %B %Y'),
                'horario': f"{reserva.hora_inicio.strftime('%H:%M')} - {reserva.hora_fin.strftime('%H:%M')}",
                'duracion': calcular_duracion(reserva.hora_inicio, reserva.hora_fin),
                'proposito': reserva.proposito,
                'asistentes': f"{reserva.num_asistentes} personas",
                'usuario': {
                    'nombre': f"{reserva.solicitante.first_name} {reserva.solicitante.last_name}",
                    'email': reserva.solicitante.email,
                    'telefono': 'N/A'
                },
                'fechaSolicitud': reserva.fecha_solicitud.strftime('%d de %B, %H:%M'),
                'comentariosAdmin': reserva.comentario_admin or "Sin comentarios adicionales."
            }
        }
        return render(request, 'reservas/detalle_reserva.html', context)
        
    except Reserva.DoesNotExist:
        messages.error(request, 'Reserva no encontrada.')
        return redirect('reservas')
    except Exception as e:
        print(f"Error en detalle_reserva_view: {e}")
        messages.error(request, 'Error al cargar los detalles de la reserva.')
        return redirect('reservas')

def calcular_duracion(hora_inicio, hora_fin):
    """Calcular la duraci√≥n en formato legible"""
    if isinstance(hora_inicio, str):
        hora_inicio = datetime.strptime(hora_inicio, '%H:%M:%S').time()
    if isinstance(hora_fin, str):
        hora_fin = datetime.strptime(hora_fin, '%H:%M:%S').time()
    
    diferencia = datetime.combine(date.today(), hora_fin) - datetime.combine(date.today(), hora_inicio)
    horas = diferencia.seconds // 3600
    minutos = (diferencia.seconds % 3600) // 60
    
    if horas > 0:
        return f"{horas} hora{'s' if horas > 1 else ''} {minutos} minuto{'s' if minutos > 1 else ''}"
    else:
        return f"{minutos} minutos"

@login_required
def cancelar_reserva_view(request):
    return render(request, 'reservas/cancelar_reserva.html')

# --- Vistas de Administraci√≥n - ACTUALIZADAS ---
@login_required
def admin_dashboard_view(request):
    """Dashboard para administradores - CON DATOS REALES"""
    try:
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return redirect('dashboard')
        
        # Datos REALES de la base de datos
        total_reservas = Reserva.objects.count()
        reservas_pendientes = Reserva.objects.filter(estado='Pendiente').count()
        total_espacios = Espacio.objects.count()
        usuarios_activos = User.objects.filter(is_active=True).count()
        
        # Reservas recientes (√∫ltimas 5)
        reservas_recientes = Reserva.objects.select_related('solicitante', 'espacio').order_by('-fecha_solicitud')[:5]
        
        # Notificaciones sin leer
        notificaciones_sin_leer = Notificacion.objects.filter(
            destinatario=request.user,
            leida=False
        ).count()
        
        context = {
            'user': request.user,
            'perfil': perfil,
            'total_reservas': total_reservas,
            'reservas_pendientes': reservas_pendientes,
            'total_espacios': total_espacios,
            'usuarios_activos': usuarios_activos,
            'reservas_recientes': reservas_recientes,
            'notificaciones_sin_leer': notificaciones_sin_leer,
        }
        return render(request, 'reservas/dashboard_admin.html', context)
    except PerfilUsuario.DoesNotExist:
        return redirect('login')

@login_required
def solicitudes_pendientes_view(request):
    """Vista de solicitudes pendientes para administradores - CON DATOS REALES"""
    try:
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return redirect('dashboard')
        
        # Obtener solicitudes REALES pendientes
        solicitudes = Reserva.objects.filter(estado='Pendiente').select_related('solicitante', 'espacio')
        
        context = {
            'user': request.user,
            'solicitudes': solicitudes
        }
        return render(request, 'reservas/solicitudes_pendientes.html', context)
    except PerfilUsuario.DoesNotExist:
        return redirect('login')

@login_required
def gestion_espacios_view(request):
    """Vista de gesti√≥n de espacios para administradores - CON DATOS REALES"""
    try:
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return redirect('dashboard')
        
        # Obtener todos los espacios
        espacios = Espacio.objects.all().order_by('nombre')
        
        context = {
            'user': request.user,
            'espacios': espacios
        }
        return render(request, 'reservas/gestion_espacios.html', context)
    except PerfilUsuario.DoesNotExist:
        return redirect('login')

@login_required
def gestion_usuarios_view(request):
    """Vista de gesti√≥n de usuarios para administradores - CON DATOS REALES"""
    try:
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return redirect('dashboard')
        
        # Obtener TODOS los usuarios (activos e inactivos) con sus perfiles
        usuarios = User.objects.all().select_related('perfilusuario').order_by('-date_joined')
        
        context = {
            'user': request.user,
            'usuarios': usuarios
        }
        return render(request, 'reservas/gestion_usuarios.html', context)
    except PerfilUsuario.DoesNotExist:
        return redirect('login')

@login_required
def reportes_view(request):
    """Vista de reportes para administradores - CON DATOS REALES"""
    try:
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return redirect('dashboard')
        
        # Datos REALES para reportes
        total_reservas = Reserva.objects.count()
        usuarios_activos = User.objects.filter(is_active=True).count()
        total_espacios = Espacio.objects.count()
        
        # Calcular tasa de aprobaci√≥n
        reservas_aprobadas = Reserva.objects.filter(estado='Aprobada').count()
        tasa_aprobacion = round((reservas_aprobadas / total_reservas * 100) if total_reservas > 0 else 0)
        
        context = {
            'user': request.user,
            'total_reservas': total_reservas,
            'usuarios_activos': usuarios_activos,
            'total_espacios': total_espacios,
            'tasa_aprobacion': tasa_aprobacion
        }
        return render(request, 'reservas/reportes.html', context)
    except PerfilUsuario.DoesNotExist:
        return redirect('login')

@login_required
def revisar_solicitud_view(request):
    """Vista para revisar una solicitud espec√≠fica"""
    try:
        perfil = PerfilUsuario.objects.get(user=request.user)
        # ACTUALIZADO: Roles que pueden acceder
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return redirect('dashboard')
        
        solicitud_id = request.GET.get('id')
        if solicitud_id:
            solicitud = Reserva.objects.get(id=solicitud_id)
            context = {
                'user': request.user,
                'solicitud': solicitud
            }
            return render(request, 'reservas/revisar_solicitud.html', context)
        else:
            return redirect('solicitudes_pendientes')
    except Reserva.DoesNotExist:
        return redirect('solicitudes_pendientes')
    except PerfilUsuario.DoesNotExist:
        return redirect('login')

@login_required
@csrf_exempt
def cancelar_reserva_api(request, reserva_id):
    if request.method == 'POST':
        try:
            reserva = Reserva.objects.get(id=reserva_id, solicitante=request.user)
            
            if reserva.estado in ['Pendiente', 'Aprobada']:
                reserva.estado = 'Cancelada'
                reserva.save()
                
                # Crear notificaci√≥n
                Notificacion.objects.create(
                    destinatario=request.user,
                    tipo='reserva',
                    titulo='Reserva Cancelada',
                    mensaje=f'Tu reserva para {reserva.espacio.nombre} ha sido cancelada.',
                    leida=False
                )
                
                return JsonResponse({'success': True, 'message': 'Reserva cancelada exitosamente'})
            else:
                return JsonResponse({'success': False, 'error': 'No se puede cancelar esta reserva'})
                
        except Reserva.DoesNotExist:
            return JsonResponse({'success': False, 'error': 'Reserva no encontrada'})
        except Exception as e:
            return JsonResponse({'success': False, 'error': str(e)})
    
    return JsonResponse({'success': False, 'error': 'M√©todo no permitido'})

@login_required
@csrf_exempt
def crear_reserva_api(request):
    """API para crear reservas REALES en la base de datos - VERSI√ìN MEJORADA"""
    if request.method == 'POST':
        try:
            print("üîç Lleg√≥ la solicitud POST a crear_reserva_api")
            data = json.loads(request.body)
            print(f"üìù Datos recibidos para crear reserva: {data}")
            
            # Validar datos requeridos
            required_fields = ['espacio_id', 'fecha_reserva', 'hora_inicio', 'hora_fin', 'proposito', 'num_asistentes']
            for field in required_fields:
                if not data.get(field):
                    return JsonResponse({
                        'success': False, 
                        'message': f'El campo {field} es requerido'
                    }, status=400)

            # Verificar que el espacio existe
            try:
                espacio = Espacio.objects.get(id=data['espacio_id'])
                print(f"üè¢ Espacio encontrado: {espacio.nombre}")
            except Espacio.DoesNotExist:
                print(f"‚ùå Espacio no encontrado: ID {data['espacio_id']}")
                return JsonResponse({
                    'success': False,
                    'message': 'El espacio seleccionado no existe'
                }, status=400)

            # Crear la reserva REAL
            reserva = Reserva.objects.create(
                espacio=espacio,
                solicitante=request.user,
                fecha_reserva=data['fecha_reserva'],
                hora_inicio=data['hora_inicio'],
                hora_fin=data['hora_fin'],
                proposito=data['proposito'],
                num_asistentes=data['num_asistentes'],
                estado='Pendiente'
            )
            
            print(f"‚úÖ Reserva REAL creada: ID {reserva.id} para {request.user.username}")
            print(f"üìÖ Detalles: {reserva.espacio.nombre} - {reserva.fecha_reserva} - {reserva.hora_inicio} a {reserva.hora_fin}")
            
            # NOTIFICAR AL USUARIO - VERSI√ìN MEJORADA
            try:
                notificacion = NotificacionService.notificar_creacion_reserva(reserva)
                if notificacion:
                    print(f"üìß Notificaci√≥n de creaci√≥n enviada exitosamente: {notificacion.id}")
                else:
                    print("‚ö†Ô∏è No se pudo crear la notificaci√≥n de creaci√≥n")
            except Exception as notif_error:
                print(f"‚ö†Ô∏è Error en notificaci√≥n: {notif_error}")
                # No fallar la reserva por error en notificaci√≥n
                
            NotificacionAdminService.notificar_nueva_reserva(reserva, request)
            
            return JsonResponse({
                'success': True,
                'message': 'Reserva creada exitosamente',
                'reserva_id': reserva.id,
                'notificacion_creada': notificacion is not None,
                'redirect_url': f'/reserva-exitosa/?reserva_id={reserva.id}'
            })

        except json.JSONDecodeError as e:
            print(f"‚ùå Error JSON: {e}")
            return JsonResponse({
                'success': False,
                'message': 'Error en los datos enviados'
            }, status=400)
        except Exception as e:
            print(f"‚ùå Error creando reserva: {e}")
            import traceback
            traceback.print_exc()
            return JsonResponse({
                'success': False,
                'message': f'Error interno del servidor: {str(e)}'
            }, status=500)

    return JsonResponse({
        'success': False,
        'message': 'M√©todo no permitido'
    }, status=405)

@login_required
def espacios_view(request):
    """Vista para mostrar los espacios disponibles"""
    try:
        espacios = Espacio.objects.filter(estado='Disponible').prefetch_related('equipamientos')
        print(f"üè¢ Espacios encontrados: {espacios.count()}")
        
        context = {
            'user': request.user,
            'espacios': espacios
        }
        return render(request, 'reservas/espacios.html', context)
    except Exception as e:
        print(f"‚ùå Error en espacios_view: {e}")
        return render(request, 'reservas/espacios.html', {'espacios': []})

@login_required
def notificaciones_view(request):
    """Vista para mostrar notificaciones"""
    try:
        notificaciones = Notificacion.objects.filter(
            destinatario=request.user
        ).order_by('-fecha_creacion')[:10]
        
        context = {
            'user': request.user,
            'notificaciones': notificaciones
        }
        return render(request, 'reservas/notificaciones.html', context)
    except Exception as e:
        print(f"Error en notificaciones_view: {e}")
        return render(request, 'reservas/notificaciones.html', {'notificaciones': []})

@login_required
@csrf_exempt
def aprobar_reserva_api(request, reserva_id):
    """API para que administradores aprueben reservas - VERSI√ìN CORREGIDA"""
    if request.method == 'POST':
        try:
            # Verificar que el usuario es administrador - ACTUALIZADO
            perfil = PerfilUsuario.objects.get(user=request.user)
            if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
                return JsonResponse({
                    'success': False, 
                    'error': 'No tienes permisos para aprobar reservas'
                }, status=403)
            
            # Obtener datos del cuerpo de la solicitud
            data = json.loads(request.body) if request.body else {}
            comentario_admin = data.get('comentario', '')
            
            reserva = Reserva.objects.get(id=reserva_id)
            estado_anterior = reserva.estado
            reserva.estado = 'Aprobada'
            reserva.id_aprobador = request.user
            reserva.comentario_admin = comentario_admin
            reserva.save()
            
            print(f"‚úÖ Reserva {reserva_id} aprobada por {request.user.username}")
            
            # NOTIFICAR AL USUARIO - VERSI√ìN CORREGIDA
            notificacion = NotificacionService.notificar_aprobacion_reserva(
                reserva, 
                comentario_admin
            )
            
            if notificacion:
                print(f"üìß Notificaci√≥n de aprobaci√≥n creada: {notificacion.id}")
            else:
                print("‚ö†Ô∏è No se pudo crear la notificaci√≥n de aprobaci√≥n")
            
            # Crear historial
            HistorialAprobacion.objects.create(
                reserva=reserva,
                usuario_admin=request.user,
                tipo_accion='Aprobada',
                motivo=comentario_admin
            )
            
            return JsonResponse({
                'success': True, 
                'message': 'Reserva aprobada exitosamente',
                'notificacion_creada': notificacion is not None
            })
            
        except Reserva.DoesNotExist:
            return JsonResponse({'success': False, 'error': 'Reserva no encontrada'})
        except Exception as e:
            print(f"‚ùå Error en aprobar_reserva_api: {e}")
            return JsonResponse({'success': False, 'error': str(e)})

@login_required
@csrf_exempt
def rechazar_reserva_api(request, reserva_id):
    """API para que administradores rechacen reservas - VERSI√ìN CORREGIDA"""
    if request.method == 'POST':
        try:
            # Verificar que el usuario es administrador - ACTUALIZADO
            perfil = PerfilUsuario.objects.get(user=request.user)
            if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
                return JsonResponse({
                    'success': False, 
                    'error': 'No tienes permisos para rechazar reservas'
                }, status=403)
            
            # Obtener datos del cuerpo de la solicitud
            data = json.loads(request.body) if request.body else {}
            motivo = data.get('motivo', 'Sin motivo especificado')
            
            reserva = Reserva.objects.get(id=reserva_id)
            estado_anterior = reserva.estado
            reserva.estado = 'Rechazada'
            reserva.id_aprobador = request.user
            reserva.comentario_admin = motivo
            reserva.save()
            
            print(f"‚ùå Reserva {reserva_id} rechazada por {request.user.username}")
            
            # NOTIFICAR AL USUARIO - VERSI√ìN CORREGIDA
            notificacion = NotificacionService.notificar_rechazo_reserva(
                reserva, 
                motivo
            )
            
            if notificacion:
                print(f"üìß Notificaci√≥n de rechazo creada: {notificacion.id}")
            else:
                print("‚ö†Ô∏è No se pudo crear la notificaci√≥n de rechazo")
            
            # Crear historial
            HistorialAprobacion.objects.create(
                reserva=reserva,
                usuario_admin=request.user,
                tipo_accion='Rechazada',
                motivo=motivo
            )
            
            return JsonResponse({
                'success': True, 
                'message': 'Reserva rechazada exitosamente',
                'notificacion_creada': notificacion is not None
            })
            
        except Reserva.DoesNotExist:
            return JsonResponse({'success': False, 'error': 'Reserva no encontrada'})
        except Exception as e:
            print(f"‚ùå Error en rechazar_reserva_api: {e}")
            return JsonResponse({'success': False, 'error': str(e)})

def force_logout(request):
    from django.contrib.auth import logout
    logout(request)
    return redirect('login')

# Agregar estas vistas al final del views.py existente

@login_required
@require_http_methods(["GET"])
def get_notificaciones_usuario(request):
    """
    API para obtener las notificaciones del usuario - VERSI√ìN MEJORADA
    """
    try:
        # Obtener par√°metros de la solicitud
        no_leidas = request.GET.get('no_leidas', 'false').lower() == 'true'
        limite = int(request.GET.get('limite', 20))
        
        # Obtener notificaciones usando el servicio
        notificaciones = NotificacionService.obtener_notificaciones_usuario(
            usuario=request.user,
            no_leidas=no_leidas,
            limite=limite
        )
        
        # Formatear respuesta con m√°s informaci√≥n
        data = []
        for notif in notificaciones:
            notif_data = {
                'id': notif.id,
                'tipo': notif.tipo,
                'titulo': notif.titulo,
                'mensaje': notif.mensaje,
                'leida': notif.leida,
                'fecha_creacion': notif.fecha_creacion.strftime('%d/%m/%Y %H:%M'),
                'fecha_creacion_formateada': notif.get_fecha_creacion_formateada(),
            }
            
            # Incluir informaci√≥n de la reserva si existe
            if notif.reserva:
                notif_data.update({
                    'reserva_id': notif.reserva.id,
                    'espacio_nombre': notif.reserva.espacio.nombre,
                    'fecha_reserva': notif.reserva.fecha_reserva.strftime('%d/%m/%Y') if notif.reserva.fecha_reserva else None,
                    'estado_reserva': notif.reserva.estado
                })
            
            data.append(notif_data)
        
        # Contar notificaciones no le√≠das
        total_no_leidas = NotificacionService.contar_notificaciones_no_leidas(request.user)
        
        return JsonResponse({
            'success': True,
            'notificaciones': data,
            'total_no_leidas': total_no_leidas,
            'total': len(data)
        })
        
    except Exception as e:
        print(f"‚ùå Error en get_notificaciones_usuario: {e}")
        return JsonResponse({
            'success': False,
            'error': 'Error al obtener notificaciones',
            'notificaciones': [],
            'total_no_leidas': 0,
            'total': 0
        })

@login_required
@csrf_exempt
@require_http_methods(["POST"])
def marcar_notificacion_leida(request, notificacion_id):
    """
    API para marcar una notificaci√≥n como le√≠da
    """
    try:
        # Verificar que la notificaci√≥n pertenece al usuario
        notificacion = Notificacion.objects.get(
            id=notificacion_id,
            destinatario=request.user
        )
        
        # Marcar como le√≠da usando el servicio
        NotificacionService.marcar_como_leida(notificacion_id)
        
        return JsonResponse({
            'success': True,
            'message': 'Notificaci√≥n marcada como le√≠da'
        })
        
    except Notificacion.DoesNotExist:
        return JsonResponse({
            'success': False,
            'error': 'Notificaci√≥n no encontrada'
        }, status=404)
    except Exception as e:
        print(f"‚ùå Error en marcar_notificacion_leida: {e}")
        return JsonResponse({
            'success': False,
            'error': 'Error al marcar notificaci√≥n como le√≠da'
        }, status=500)

@login_required
@csrf_exempt
@require_http_methods(["POST"])
def marcar_todas_leidas(request):
    """
    API para marcar todas las notificaciones como le√≠das
    """
    try:
        count = NotificacionService.marcar_todas_como_leidas(request.user)
        
        return JsonResponse({
            'success': True,
            'message': f'{count} notificaciones marcadas como le√≠das',
            'count': count
        })
        
    except Exception as e:
        print(f"‚ùå Error en marcar_todas_leidas: {e}")
        return JsonResponse({
            'success': False,
            'error': 'Error al marcar notificaciones como le√≠das'
        }, status=500)

@login_required
@require_http_methods(["GET"])
def contar_notificaciones_no_leidas(request):
    """
    API para contar notificaciones no le√≠das
    """
    try:
        count = NotificacionService.contar_notificaciones_no_leidas(request.user)
        
        return JsonResponse({
            'success': True,
            'count': count
        })
        
    except Exception as e:
        print(f"‚ùå Error en contar_notificaciones_no_leidas: {e}")
        return JsonResponse({
            'success': False,
            'error': 'Error al contar notificaciones'
        }, status=500)

# ViewSets para tu API
class UserViewSet(viewsets.ModelViewSet):
    queryset = User.objects.all()
    serializer_class = UserSerializer
    permission_classes = [permissions.IsAuthenticated]

class PerfilUsuarioViewSet(viewsets.ModelViewSet):
    queryset = PerfilUsuario.objects.all()
    serializer_class = PerfilUsuarioSerializer
    permission_classes = [permissions.IsAuthenticated]

class EspacioViewSet(viewsets.ModelViewSet):
    queryset = Espacio.objects.all()
    serializer_class = EspacioSerializer
    permission_classes = [permissions.IsAuthenticated]

class ReservaViewSet(viewsets.ModelViewSet):
    queryset = Reserva.objects.all()
    serializer_class = ReservaSerializer
    permission_classes = [permissions.IsAuthenticated]

    def get_queryset(self):
        # Filtrar reservas por usuario (solo sus propias reservas)
        user = self.request.user
        if user.is_authenticated:
            return Reserva.objects.filter(solicitante=user)
        return Reserva.objects.none()

class NotificacionViewSet(viewsets.ModelViewSet):
    queryset = Notificacion.objects.all()
    serializer_class = NotificacionSerializer
    permission_classes = [permissions.IsAuthenticated]

    def get_queryset(self):
        # Filtrar notificaciones por usuario
        user = self.request.user
        if user.is_authenticated:
            return Notificacion.objects.filter(destinatario=user)
        return Notificacion.objects.none()

class HistorialAprobacionViewSet(viewsets.ModelViewSet):
    queryset = HistorialAprobacion.objects.all()
    serializer_class = HistorialAprobacionSerializer
    permission_classes = [permissions.IsAuthenticated]

class EquipamientoViewSet(viewsets.ModelViewSet):
    queryset = Equipamiento.objects.all()
    serializer_class = EquipamientoSerializer
    permission_classes = [permissions.IsAuthenticated]

class AreaViewSet(viewsets.ModelViewSet):
    queryset = Area.objects.all()
    serializer_class = AreaSerializer
    permission_classes = [permissions.IsAuthenticated]
    
    # Agregar estas vistas al final del views.py

@login_required
@csrf_exempt
@require_http_methods(["POST"])
def actualizar_usuario_api(request, user_id):
    """API para actualizar datos de usuario"""
    try:
        # Verificar permisos de administrador
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return JsonResponse({'success': False, 'error': 'No tienes permisos'}, status=403)
        
        data = json.loads(request.body)
        usuario = User.objects.get(id=user_id)
        
        # Actualizar datos b√°sicos
        usuario.first_name = data.get('first_name', usuario.first_name)
        usuario.last_name = data.get('last_name', usuario.last_name)
        usuario.email = data.get('email', usuario.email)
        usuario.save()
        
        # Actualizar perfil
        try:
            perfil_usuario = PerfilUsuario.objects.get(user=usuario)
            perfil_usuario.rol = data.get('rol', perfil_usuario.rol)
            perfil_usuario.save()
        except PerfilUsuario.DoesNotExist:
            # Crear perfil si no existe
            area_default = Area.objects.get_or_create(nombre_area="General")[0]
            PerfilUsuario.objects.create(
                user=usuario,
                rol=data.get('rol', 'Usuario'),
                area=area_default,
                departamento='Indefinido',
                estado='activo'
            )
        
        return JsonResponse({'success': True, 'message': 'Usuario actualizado exitosamente'})
        
    except User.DoesNotExist:
        return JsonResponse({'success': False, 'error': 'Usuario no encontrado'}, status=404)
    except Exception as e:
        return JsonResponse({'success': False, 'error': str(e)}, status=500)

@login_required
@csrf_exempt
@require_http_methods(["POST"])
def cambiar_estado_usuario_api(request, user_id):
    """API para activar/desactivar usuario"""
    try:
        # Verificar permisos de administrador
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return JsonResponse({'success': False, 'error': 'No tienes permisos'}, status=403)
        
        data = json.loads(request.body)
        activo = data.get('activo', True)
        
        usuario = User.objects.get(id=user_id)
        usuario.is_active = activo
        usuario.save()
        
        # Actualizar estado en el perfil tambi√©n
        try:
            perfil_usuario = PerfilUsuario.objects.get(user=usuario)
            perfil_usuario.estado = 'activo' if activo else 'inactivo'
            perfil_usuario.save()
        except PerfilUsuario.DoesNotExist:
            pass
        
        accion = "activado" if activo else "desactivado"
        return JsonResponse({'success': True, 'message': f'Usuario {accion} exitosamente'})
        
    except User.DoesNotExist:
        return JsonResponse({'success': False, 'error': 'Usuario no encontrado'}, status=404)
    except Exception as e:
        return JsonResponse({'success': False, 'error': str(e)}, status=500)

@login_required
@require_http_methods(["GET"])
def obtener_usuario_api(request, user_id):
    """API para obtener datos de un usuario espec√≠fico"""
    try:
        usuario = User.objects.get(id=user_id)
        return JsonResponse({
            'success': True,
            'id': usuario.id,
            'username': usuario.username,
            'first_name': usuario.first_name,
            'last_name': usuario.last_name,
            'email': usuario.email,
            'is_active': usuario.is_active
        })
    except User.DoesNotExist:
        return JsonResponse({'success': False, 'error': 'Usuario no encontrado'}, status=404)

@login_required
@require_http_methods(["GET"])
def obtener_perfiles_usuario_api(request):
    """API para obtener perfiles de usuario"""
    try:
        user_id = request.GET.get('user_id')
        if user_id:
            perfiles = PerfilUsuario.objects.filter(user_id=user_id)
        else:
            perfiles = PerfilUsuario.objects.all()
        
        data = []
        for perfil in perfiles:
            data.append({
                'id': perfil.id,
                'user_id': perfil.user.id,
                'rol': perfil.rol,
                'estado': perfil.estado,
                'departamento': perfil.departamento
            })
        
        return JsonResponse({'success': True, 'perfiles': data})
    except Exception as e:
        return JsonResponse({'success': False, 'error': str(e)}, status=500)

# === VISTAS PARA GESTI√ìN DE ESPACIOS ===

@login_required
def crear_espacio_view(request):
    """Vista para crear espacio (template)"""
    try:
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return redirect('dashboard')
        
        return render(request, 'reservas/crear_espacio.html')
    except PerfilUsuario.DoesNotExist:
        return redirect('login')

@login_required
def editar_espacio_view(request):
    """Vista para editar espacio (template)"""
    try:
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return redirect('dashboard')
        
        espacio_id = request.GET.get('id')
        if not espacio_id:
            return redirect('gestion_espacios')
            
        # Verificar que el espacio existe
        espacio = Espacio.objects.get(id=espacio_id)
        
        context = {
            'user': request.user,
            'espacio_id': espacio_id,
            'espacio': espacio
        }
        return render(request, 'reservas/editar_espacio.html', context)
        
    except Espacio.DoesNotExist:
        messages.error(request, 'Espacio no encontrado')
        return redirect('gestion_espacios')
    except PerfilUsuario.DoesNotExist:
        return redirect('login')

# APIs para gesti√≥n de espacios
@login_required
@csrf_exempt
@require_http_methods(["POST"])
def crear_espacio_api(request):
    """API para crear espacios - VERSI√ìN CORREGIDA"""
    print("üîç Lleg√≥ solicitud a crear_espacio_api")
    
    try:
        # Verificar permisos de administrador
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            print("‚ùå Usuario sin permisos de administrador")
            return JsonResponse({
                'success': False, 
                'error': 'No tienes permisos para crear espacios'
            }, status=403)
        
        # Parsear datos
        data = json.loads(request.body)
        print(f"üìù Datos recibidos: {data}")
        
        # Validaciones
        required_fields = ['nombre', 'tipo', 'capacidad']
        for field in required_fields:
            if not data.get(field):
                return JsonResponse({
                    'success': False, 
                    'error': f'El campo {field} es requerido'
                }, status=400)
        
        # Validar capacidad
        try:
            capacidad = int(data['capacidad'])
            if capacidad <= 0:
                return JsonResponse({
                    'success': False, 
                    'error': 'La capacidad debe ser mayor a 0'
                }, status=400)
        except (ValueError, TypeError):
            return JsonResponse({
                'success': False, 
                'error': 'La capacidad debe ser un n√∫mero v√°lido'
            }, status=400)
        
        # Crear espacio
        espacio = Espacio.objects.create(
            nombre=data['nombre'].strip(),
            tipo=data['tipo'],
            capacidad=capacidad,
            edificio=data.get('edificio', '').strip() or None,
            piso=data.get('piso'),
            descripcion=data.get('descripcion', '').strip() or None,
            estado=data.get('estado', 'Disponible')
        )
        
        print(f"‚úÖ Espacio creado exitosamente: {espacio.id} - {espacio.nombre}")
        
        NotificacionAdminService.notificar_espacio_creado(espacio, request.user, request)
        
        return JsonResponse({
            'success': True, 
            'message': 'Espacio creado exitosamente',
            'espacio_id': espacio.id
        })
        
    except json.JSONDecodeError as e:
        print(f"‚ùå Error JSON: {e}")
        return JsonResponse({
            'success': False, 
            'error': 'Error en el formato de datos JSON'
        }, status=400)
    except Exception as e:
        print(f"‚ùå Error inesperado: {str(e)}")
        import traceback
        traceback.print_exc()
        return JsonResponse({
            'success': False, 
            'error': f'Error interno del servidor: {str(e)}'
        }, status=500)

@login_required
@require_http_methods(["GET"])
def obtener_espacio_api(request, espacio_id):
    """API para obtener datos de un espacio espec√≠fico - VERSI√ìN CORREGIDA"""
    try:
        print(f"üîç Buscando espacio ID: {espacio_id}")
        
        # Verificar permisos
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return JsonResponse({
                'success': False, 
                'error': 'No tienes permisos para editar espacios'
            }, status=403)
        
        espacio = Espacio.objects.get(id=espacio_id)
        print(f"‚úÖ Espacio encontrado: {espacio.nombre}")
        
        return JsonResponse({
            'success': True,
            'espacio': {
                'id': espacio.id,
                'nombre': espacio.nombre,
                'tipo': espacio.tipo,
                'edificio': espacio.edificio or '',
                'piso': espacio.piso,
                'capacidad': espacio.capacidad,
                'descripcion': espacio.descripcion or '',
                'estado': espacio.estado
            }
        })
    except Espacio.DoesNotExist:
        print(f"‚ùå Espacio {espacio_id} no encontrado")
        return JsonResponse({
            'success': False, 
            'error': 'Espacio no encontrado'
        }, status=404)
    except Exception as e:
        print(f"üí• Error al obtener espacio: {str(e)}")
        return JsonResponse({
            'success': False, 
            'error': f'Error al cargar espacio: {str(e)}'
        }, status=500)
        
@login_required
@csrf_exempt
@require_http_methods(["POST"])  
def actualizar_espacio_api(request, espacio_id):
    """API para actualizar espacios"""
    print(f"üîç Actualizando espacio ID: {espacio_id}")
    
    if request.method != 'POST':
        return JsonResponse({'success': False, 'error': 'M√©todo no permitido'})
    
    try:
        # Verificar permisos
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return JsonResponse({'success': False, 'error': 'No tienes permisos de administrador'})
        
        # Obtener espacio
        espacio = Espacio.objects.get(id=espacio_id)
        
        # Parsear datos
        data = json.loads(request.body)
        print(f"üìù Datos para actualizar: {data}")
        
        # Actualizar campos
        if 'nombre' in data:
            espacio.nombre = data['nombre'].strip()
        if 'tipo' in data:
            espacio.tipo = data['tipo']
        if 'capacidad' in data:
            espacio.capacidad = int(data['capacidad'])
        if 'edificio' in data:
            espacio.edificio = data['edificio'].strip() or None
        if 'piso' in data:
            piso = data['piso']
            espacio.piso = int(piso) if piso and str(piso).strip() else None
        if 'descripcion' in data:
            espacio.descripcion = data['descripcion'].strip() or None
        if 'estado' in data:
            espacio.estado = data['estado']
        
        # Guardar cambios
        espacio.save()
        
        print(f"‚úÖ Espacio actualizado: {espacio.id} - {espacio.nombre}")
        
        return JsonResponse({
            'success': True, 
            'message': 'Espacio actualizado exitosamente'
        })
        
    except Espacio.DoesNotExist:
        return JsonResponse({'success': False, 'error': 'Espacio no encontrado'})
    except json.JSONDecodeError:
        return JsonResponse({'success': False, 'error': 'Error en el formato de datos JSON'})
    except Exception as e:
        print(f"‚ùå Error al actualizar: {str(e)}")
        import traceback
        traceback.print_exc()
        return JsonResponse({'success': False, 'error': f'Error interno del servidor: {str(e)}'})

@login_required
@csrf_exempt
@require_http_methods(["POST"])
def eliminar_espacio_api(request, espacio_id):
    """API para eliminar un espacio"""
    try:
        # Verificar permisos de administrador
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return JsonResponse({'success': False, 'error': 'No tienes permisos'}, status=403)
        
        espacio = Espacio.objects.get(id=espacio_id)
        espacio_nombre = espacio.nombre
        espacio.delete()
        
        return JsonResponse({
            'success': True, 
            'message': f'Espacio "{espacio_nombre}" eliminado exitosamente'
        })
        
    except Espacio.DoesNotExist:
        return JsonResponse({'success': False, 'error': 'Espacio no encontrado'}, status=404)
    except Exception as e:
        return JsonResponse({'success': False, 'error': str(e)}, status=500)
    
@login_required
def notificaciones_admin_view(request):
    """Vista de notificaciones para administradores"""
    try:
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return redirect('dashboard')
        
        return render(request, 'reservas/notificaciones_admin.html')
    except PerfilUsuario.DoesNotExist:
        return redirect('login')

@login_required
def get_notificaciones_admin_api(request):
    """API para obtener notificaciones de administradores"""
    try:
        # Verificar que el usuario es administrador
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return JsonResponse({'success': False, 'error': 'No autorizado'}, status=403)
        
        # Obtener par√°metros
        no_leidas = request.GET.get('no_leidas', 'false').lower() == 'true'
        limite = int(request.GET.get('limite', 50))
        tipo_filtro = request.GET.get('tipo', '')
        
        # Consulta base
        notificaciones = NotificacionAdmin.objects.all()
        
        # Aplicar filtros
        if no_leidas:
            notificaciones = notificaciones.filter(leida=False)
        
        if tipo_filtro:
            notificaciones = notificaciones.filter(tipo=tipo_filtro)
        
        # Ordenar y limitar
        notificaciones = notificaciones.select_related(
            'usuario_relacionado', 'reserva', 'reserva__espacio', 'espacio'
        ).order_by('-fecha_creacion')[:limite]
        
        # Formatear respuesta
        data = []
        for notif in notificaciones:
            notif_data = {
                'id': notif.id,
                'tipo': notif.tipo,
                'titulo': notif.titulo,
                'mensaje': notif.mensaje,
                'prioridad': notif.prioridad,
                'leida': notif.leida,
                'fecha_creacion': notif.fecha_creacion.strftime('%d/%m/%Y %H:%M:%S'),
                'fecha_creacion_timestamp': notif.fecha_creacion.timestamp(),
                'usuario_relacionado': None,
                'reserva_info': None,
                'espacio_info': None
            }
            
            # Informaci√≥n del usuario relacionado
            if notif.usuario_relacionado:
                notif_data['usuario_relacionado'] = {
                    'username': notif.usuario_relacionado.username,
                    'nombre_completo': f"{notif.usuario_relacionado.first_name} {notif.usuario_relacionado.last_name}"
                }
            
            # Informaci√≥n de la reserva
            if notif.reserva:
                notif_data['reserva_info'] = {
                    'id': notif.reserva.id,
                    'espacio_nombre': notif.reserva.espacio.nombre,
                    'fecha': notif.reserva.fecha_reserva.strftime('%d/%m/%Y'),
                    'estado': notif.reserva.estado
                }
            
            # Informaci√≥n del espacio
            if notif.espacio:
                notif_data['espacio_info'] = {
                    'id': notif.espacio.id,
                    'nombre': notif.espacio.nombre,
                    'tipo': notif.espacio.tipo
                }
            
            data.append(notif_data)
        
        # Contar no le√≠das
        total_no_leidas = NotificacionAdmin.objects.filter(leida=False).count()
        
        return JsonResponse({
            'success': True,
            'notificaciones': data,
            'total_no_leidas': total_no_leidas,
            'total': len(data)
        })
        
    except Exception as e:
        print(f"‚ùå Error en get_notificaciones_admin_api: {e}")
        return JsonResponse({
            'success': False,
            'error': 'Error al obtener notificaciones'
        })
# === VISTAS PARA NOTIFICACIONES DE ADMINISTRADOR ===

@login_required
@require_http_methods(["GET"])
def contar_notificaciones_admin_no_leidas(request):
    """API para contar notificaciones de admin no le√≠das"""
    try:
        # Verificar que el usuario es administrador
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return JsonResponse({'success': False, 'error': 'No autorizado'}, status=403)
        
        count = NotificacionAdmin.objects.filter(leida=False).count()
        
        return JsonResponse({
            'success': True,
            'count': count
        })
        
    except Exception as e:
        print(f"‚ùå Error en contar_notificaciones_admin_no_leidas: {e}")
        return JsonResponse({
            'success': False,
            'error': 'Error al contar notificaciones'
        }, status=500)

@login_required
@csrf_exempt
@require_http_methods(["POST"])
def marcar_todas_notificaciones_admin_leidas(request):
    """API para marcar todas las notificaciones de admin como le√≠das"""
    try:
        # Verificar que el usuario es administrador
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return JsonResponse({'success': False, 'error': 'No autorizado'}, status=403)
        
        notificaciones = NotificacionAdmin.objects.filter(leida=False)
        count = notificaciones.count()
        notificaciones.update(leida=True, fecha_lectura=timezone.now())
        
        print(f"üì≠ Marcadas {count} notificaciones admin como le√≠das")
        
        return JsonResponse({
            'success': True,
            'message': f'{count} notificaciones marcadas como le√≠das',
            'count': count
        })
        
    except Exception as e:
        print(f"‚ùå Error en marcar_todas_notificaciones_admin_leidas: {e}")
        return JsonResponse({
            'success': False,
            'error': 'Error al marcar notificaciones como le√≠das'
        }, status=500)

@login_required
@csrf_exempt
@require_http_methods(["POST"])
def marcar_notificacion_admin_leida(request, notificacion_id):
    """API para marcar una notificaci√≥n de admin como le√≠da"""
    try:
        # Verificar que el usuario es administrador
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return JsonResponse({'success': False, 'error': 'No autorizado'}, status=403)
        
        notificacion = NotificacionAdmin.objects.get(id=notificacion_id)
        notificacion.marcar_como_leida()
        
        return JsonResponse({
            'success': True,
            'message': 'Notificaci√≥n marcada como le√≠da'
        })
        
    except NotificacionAdmin.DoesNotExist:
        return JsonResponse({
            'success': False,
            'error': 'Notificaci√≥n no encontrada'
        }, status=404)
    except Exception as e:
        print(f"‚ùå Error en marcar_notificacion_admin_leida: {e}")
        return JsonResponse({
            'success': False,
            'error': 'Error al marcar notificaci√≥n como le√≠da'
        }, status=500)

@login_required
def notificaciones_admin_view(request):
    """Vista de notificaciones para administradores"""
    try:
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return redirect('dashboard')
        
        return render(request, 'reservas/notificaciones_admin.html')
    except PerfilUsuario.DoesNotExist:
        return redirect('login')

@login_required
def get_notificaciones_admin_api(request):
    """API para obtener notificaciones de administradores"""
    try:
        # Verificar que el usuario es administrador
        perfil = PerfilUsuario.objects.get(user=request.user)
        if perfil.rol not in ['Administrativo', 'Investigacion', 'Aprobador']:
            return JsonResponse({'success': False, 'error': 'No autorizado'}, status=403)
        
        # Obtener par√°metros
        no_leidas = request.GET.get('no_leidas', 'false').lower() == 'true'
        limite = int(request.GET.get('limite', 50))
        tipo_filtro = request.GET.get('tipo', '')
        
        # Consulta base
        notificaciones = NotificacionAdmin.objects.all()
        
        # Aplicar filtros
        if no_leidas:
            notificaciones = notificaciones.filter(leida=False)
        
        if tipo_filtro:
            notificaciones = notificaciones.filter(tipo=tipo_filtro)
        
        # Ordenar y limitar
        notificaciones = notificaciones.select_related(
            'usuario_relacionado', 'reserva', 'reserva__espacio', 'espacio'
        ).order_by('-fecha_creacion')[:limite]
        
        # Formatear respuesta
        data = []
        for notif in notificaciones:
            notif_data = {
                'id': notif.id,
                'tipo': notif.tipo,
                'titulo': notif.titulo,
                'mensaje': notif.mensaje,
                'prioridad': notif.prioridad,
                'leida': notif.leida,
                'fecha_creacion': notif.fecha_creacion.strftime('%d/%m/%Y %H:%M:%S'),
                'fecha_creacion_timestamp': notif.fecha_creacion.timestamp(),
                'usuario_relacionado': None,
                'reserva_info': None,
                'espacio_info': None
            }
            
            # Informaci√≥n del usuario relacionado
            if notif.usuario_relacionado:
                notif_data['usuario_relacionado'] = {
                    'username': notif.usuario_relacionado.username,
                    'nombre_completo': f"{notif.usuario_relacionado.first_name} {notif.usuario_relacionado.last_name}"
                }
            
            # Informaci√≥n de la reserva
            if notif.reserva:
                notif_data['reserva_info'] = {
                    'id': notif.reserva.id,
                    'espacio_nombre': notif.reserva.espacio.nombre,
                    'fecha': notif.reserva.fecha_reserva.strftime('%d/%m/%Y'),
                    'estado': notif.reserva.estado
                }
            
            # Informaci√≥n del espacio
            if notif.espacio:
                notif_data['espacio_info'] = {
                    'id': notif.espacio.id,
                    'nombre': notif.espacio.nombre,
                    'tipo': notif.espacio.tipo
                }
            
            data.append(notif_data)
        
        # Contar no le√≠das
        total_no_leidas = NotificacionAdmin.objects.filter(leida=False).count()
        
        return JsonResponse({
            'success': True,
            'notificaciones': data,
            'total_no_leidas': total_no_leidas,
            'total': len(data)
        })
        
    except Exception as e:
        print(f"‚ùå Error en get_notificaciones_admin_api: {e}")
        return JsonResponse({
            'success': False,
            'error': 'Error al obtener notificaciones'
        })
============================================================


===== __init__.py =====

============================================================


################################################################################
üìÅ Carpeta: C:\Users\kevin\OneDrive\Liceo\Escritorio\Info\4_semestre\proyecto_integrado\Backend\Inacap_reserva\reservas\templates\reservas
################################################################################


===== calendario.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario - Sistema de Reservas</title>
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f9fafb;
            color: #111827;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: #2563eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav-menu {
            display: flex;
            gap: 32px;
        }

        .nav-item {
            color: #6b7280;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background: #2563eb;
            color: white;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            padding: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
            font-size: 14px;
            color: #6b7280;
        }

        .breadcrumb a {
            color: #2563eb;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #9ca3af;
        }

        /* Page Header */
        .page-header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .new-reservation-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .new-reservation-btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        /* Filters */
        .filters-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .filter-select, .filter-input {
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: #2563eb;
        }

        .view-toggles {
            display: flex;
            background: #f3f4f6;
            border-radius: 8px;
            padding: 4px;
        }

        .view-toggle {
            padding: 8px 16px;
            border: none;
            background: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-toggle.active {
            background: white;
            color: #2563eb;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* Calendar Section */
        .calendar-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        #calendar {
            background: white;
            border-radius: 8px;
            padding: 20px;
            height: 600px;
        }

        .fc {
            height: 100%;
        }

        .fc-header-toolbar {
            margin-bottom: 1em;
        }

        .fc-toolbar-title {
            font-size: 1.5em;
            font-weight: 600;
        }

        .fc-event {
            cursor: pointer;
            border: none;
            font-size: 0.85em;
            font-weight: 500;
        }

        .fc-day-today {
            background-color: #eff6ff !important;
        }

        /* Legend */
        .calendar-legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 20px;
            padding: 16px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .legend-color.available {
            background: white;
            border: 2px solid #e5e7eb;
        }

        .legend-color.occupied {
            background: #fee2e2;
            border: 2px solid #dc2626;
        }

        .legend-color.partial {
            background: #fef3c7;
            border: 2px solid #f59e0b;
        }

        .legend-color.today {
            background: white;
            border: 2px solid #2563eb;
        }

        /* Sidebar */
        .content-with-sidebar {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 24px;
        }

        .sidebar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            height: fit-content;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #111827;
        }

        .selected-date {
            background: #f3f4f6;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            text-align: center;
        }

        .selected-date-text {
            font-size: 18px;
            font-weight: 600;
            color: #2563eb;
        }

        .reservation-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .reservation-item {
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .reservation-item.approved {
            border-left-color: #10b981;
        }

        .reservation-item.pending {
            border-left-color: #f59e0b;
        }

        .reservation-time {
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
        }

        .reservation-space {
            font-size: 14px;
            font-weight: 500;
            color: #111827;
            margin-top: 2px;
        }

        /* Keyboard Help */
        .keyboard-help {
            margin-top: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
            font-size: 12px;
            border: 1px solid #e2e8f0;
        }

        .keyboard-help-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .keyboard-shortcuts {
            color: #6b7280;
            line-height: 1.4;
        }

        .keyboard-tip {
            margin-top: 8px;
            color: #9ca3af;
            font-size: 11px;
            font-style: italic;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .content-with-sidebar {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .calendar-legend {
                flex-wrap: wrap;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo">SR</div>
            <div style="font-weight: 600; color: #111827;">Sistema de Reservas</div>
        </div>
        
        <nav class="nav-menu">
            <a href="{% url 'dashboard' %}" class="nav-item">Dashboard</a>
            <a href="{% url 'crear_reserva' %}" class="nav-item">Reservar</a>
            <a href="{% url 'reservas' %}" class="nav-item">Historial</a>
            <a href="{% url 'calendario' %}" class="nav-item active">Calendario</a>
            <a href="{% url 'espacios' %}" class="nav-item">Espacios</a>
            <a href="{% url 'notificaciones' %}" class="nav-item">Notificaciones</a>
        </nav>
        
        <div class="user-menu">
            <div class="user-avatar">
                {% if user.first_name and user.last_name %}
                    {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                {% else %}
                    {{ user.username|first|upper }}
                {% endif %}
            </div>
            <span>
                {% if user.first_name %}
                    {{ user.first_name }} {{ user.last_name }}
                {% else %}
                    {{ user.username }}
                {% endif %}
            </span>
            <a href="{% url 'logout' %}" style="margin-left: 10px; color: #666; text-decoration: none;">üö™</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="{% url 'dashboard' %}">Dashboard</a>
            <span class="breadcrumb-separator">‚Ä∫</span>
            <span>Calendario</span>
        </nav>

        <!-- Page Header -->
        <div class="page-header">
            <div class="header-content">
                <h1 class="page-title">Calendario de Disponibilidad</h1>
                <div class="header-actions">
                    <a href="{% url 'crear_reserva' %}" class="new-reservation-btn">
                        <span>‚ûï</span>
                        Nueva Reserva
                    </a>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-section">
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">üè¢ Seleccionar Espacio</label>
                    <select class="filter-select" id="spaceFilter">
                        <option value="">Todos los espacios</option>
                        {% for espacio in espacios %}
                            <option value="{{ espacio.id }}">{{ espacio.nombre }}</option>
                        {% empty %}
                            <option value="">No hay espacios disponibles</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">üìÖ Mes/A√±o</label>
                    <input type="month" class="filter-input" id="monthFilter" value="{{ current_month }}">
                </div>

                <div class="filter-group">
                    <label class="filter-label">Vista</label>
                    <div class="view-toggles">
                        <button class="view-toggle active" data-view="dayGridMonth">Mes</button>
                        <button class="view-toggle" data-view="timeGridWeek">Semana</button>
                        <button class="view-toggle" data-view="timeGridDay">D√≠a</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content with Sidebar -->
        <div class="content-with-sidebar">
            <!-- Calendar Section -->
            <div class="calendar-section">
                <div id="calendar"></div>

                <!-- Legend -->
                <div class="calendar-legend">
                    <div class="legend-item">
                        <div class="legend-color available"></div>
                        <span>Disponible</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color partial"></div>
                        <span>Parcialmente ocupado</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color occupied"></div>
                        <span>Ocupado</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color today"></div>
                        <span>D√≠a actual</span>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <h3 class="sidebar-title">D√≠a Seleccionado</h3>
                <div class="selected-date">
                    <div class="selected-date-text" id="selectedDate">Hoy</div>
                </div>

                <h4 class="sidebar-title">Reservas del D√≠a</h4>
                <div class="reservation-list" id="dayReservations">
                    <div class="empty-state">
                        <p>Selecciona un d√≠a para ver las reservas</p>
                    </div>
                </div>

                <!-- Keyboard Help Section -->
                <div class="keyboard-help">
                    <div class="keyboard-help-title">
                        <span>‚å®Ô∏è</span>
                        Atajos de Teclado
                    </div>
                    <div class="keyboard-shortcuts">
                        Presiona letras para navegar: 
                        <strong>E</strong>=Ene, <strong>F</strong>=Feb, <strong>M</strong>=Mar, 
                        <strong>A</strong>=Abr, <strong>Y</strong>=May, <strong>J</strong>=Jun, 
                        <strong>U</strong>=Jul, <strong>G</strong>=Ago, <strong>S</strong>=Sep, 
                        <strong>O</strong>=Oct, <strong>N</strong>=Nov, <strong>D</strong>=Dic
                    </div>
                    <div class="keyboard-tip">
                        Presiona F1 para ayuda completa
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/locales/es.global.min.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        
        // Obtener eventos desde el contexto de Django
        var eventos = {{ eventos|safe }};
        console.log('Eventos cargados:', eventos);
        
        // Configurar calendario
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'es',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            buttonText: {
                today: 'Hoy',
                month: 'Mes',
                week: 'Semana',
                day: 'D√≠a'
            },
            events: eventos,
            eventClick: function(info) {
                alert('Reserva: ' + info.event.title + '\nEstado: ' + info.event.extendedProps.estado);
            },
            dateClick: function(info) {
                updateSelectedDate(info.dateStr);
                updateDayReservations(info.dateStr);
            },
            eventDisplay: 'block',
            eventColor: '#3788d8',
            eventTextColor: '#ffffff'
        });
        
        calendar.render();
        
        // === ATAJOS DE TECLADO PARA MESES ===
        document.addEventListener('keydown', function(e) {
            // Solo activar si no hay campos de texto enfocados
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {
                return;
            }
            
            const key = e.key.toLowerCase();
            const currentDate = calendar.getDate();
            const currentYear = currentDate.getFullYear();
            
            let targetMonth;
            
            // Mapeo de teclas a meses
            switch(key) {
                case 'e': targetMonth = 0; break;  // Enero
                case 'f': targetMonth = 1; break;  // Febrero
                case 'm': targetMonth = 2; break;  // Marzo
                case 'a': targetMonth = 3; break;  // Abril
                case 'y': targetMonth = 4; break;  // Mayo (Y por "May")
                case 'j': targetMonth = 5; break;  // Junio
                case 'u': targetMonth = 6; break;  // Julio
                case 'g': targetMonth = 7; break;  // Agosto
                case 's': targetMonth = 8; break;  // Septiembre
                case 'o': targetMonth = 9; break;  // Octubre
                case 'n': targetMonth = 10; break; // Noviembre
                case 'd': targetMonth = 11; break; // Diciembre
                default: return; // Si no es una tecla de mes, salir
            }
            
            // Prevenir el comportamiento por defecto
            e.preventDefault();
            
            // Navegar al mes correspondiente
            const targetDate = new Date(currentYear, targetMonth, 1);
            calendar.gotoDate(targetDate);
            
            // Mostrar notificaci√≥n temporal
            showMonthNotification(targetMonth);
        });
        
        // Funci√≥n para mostrar notificaci√≥n del mes
        function showMonthNotification(monthIndex) {
            const monthNames = [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
            ];
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10b981;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                animation: fadeInOut 2s ease-in-out;
            `;
            
            notification.textContent = `Navegando a ${monthNames[monthIndex]}`;
            document.body.appendChild(notification);
            
            // Remover despu√©s de 2 segundos
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 2000);
        }
        
        // Agregar estilos CSS para la animaci√≥n
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translateY(-20px); }
                20% { opacity: 1; transform: translateY(0); }
                80% { opacity: 1; transform: translateY(0); }
                100% { opacity: 0; transform: translateY(-20px); }
            }
        `;
        document.head.appendChild(style);

        // === AYUDA DE TECLADO (F1) ===
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F1') {
                e.preventDefault();
                showKeyboardHelp();
            }
        });

        function showKeyboardHelp() {
            const helpModal = document.createElement('div');
            helpModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            `;

            const helpContent = document.createElement('div');
            helpContent.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 12px;
                max-width: 500px;
                max-height: 80vh;
                overflow-y: auto;
            `;

            helpContent.innerHTML = `
                <h2 style="margin-bottom: 20px; color: #111827;">‚å®Ô∏è Atajos de Teclado del Calendario</h2>
                <div style="display: grid; gap: 12px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between;">
                        <span><strong>E</strong> - Enero</span>
                        <span><strong>J</strong> - Junio</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span><strong>F</strong> - Febrero</span>
                        <span><strong>U</strong> - Julio</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span><strong>M</strong> - Marzo</span>
                        <span><strong>G</strong> - Agosto</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span><strong>A</strong> - Abril</span>
                        <span><strong>S</strong> - Septiembre</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span><strong>Y</strong> - Mayo</span>
                        <span><strong>O</strong> - Octubre</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span><strong>N</strong> - Noviembre</span>
                        <span><strong>D</strong> - Diciembre</span>
                    </div>
                </div>
                <div style="padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #2563eb;">
                    <strong>üí° Consejo:</strong> Presiona cualquier letra arriba mencionada para navegar instant√°neamente al mes correspondiente.
                </div>
                <button onclick="this.parentElement.parentElement.remove()" 
                        style="margin-top: 20px; padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 6px; cursor: pointer; width: 100%;">
                    Cerrar Ayuda
                </button>
            `;

            helpModal.appendChild(helpContent);
            document.body.appendChild(helpModal);

            // Cerrar al hacer clic fuera
            helpModal.addEventListener('click', function(e) {
                if (e.target === helpModal) {
                    helpModal.remove();
                }
            });
        }

        // === FUNCIONES EXISTENTES ===
        // Actualizar fecha seleccionada
        function updateSelectedDate(dateStr) {
            const date = new Date(dateStr);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = date.toLocaleDateString('es-ES', options);
            document.getElementById('selectedDate').textContent = formattedDate;
        }
        
        // Actualizar reservas del d√≠a
        function updateDayReservations(dateStr) {
            const dayReservationsEl = document.getElementById('dayReservations');
            const events = calendar.getEvents();
            const dayEvents = events.filter(event => {
                const eventDate = event.start.toISOString().split('T')[0];
                return eventDate === dateStr;
            });
            
            if (dayEvents.length === 0) {
                dayReservationsEl.innerHTML = '<div class="empty-state"><p>No hay reservas para este d√≠a</p></div>';
            } else {
                let html = '';
                dayEvents.forEach(event => {
                    const startTime = event.start.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
                    const endTime = event.end.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
                    const status = event.extendedProps.estado || 'Pendiente';
                    const statusClass = status.toLowerCase();
                    
                    html += `
                        <div class="reservation-item ${statusClass}">
                            <div class="reservation-time">${startTime} - ${endTime}</div>
                            <div class="reservation-space">${event.title}</div>
                            <div class="reservation-status">${status}</div>
                        </div>
                    `;
                });
                dayReservationsEl.innerHTML = html;
            }
        }
        
        // Botones de vista
        const viewToggles = document.querySelectorAll('.view-toggle');
        viewToggles.forEach(toggle => {
            toggle.addEventListener('click', function() {
                const view = this.dataset.view;
                
                // Actualizar botones activos
                viewToggles.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Cambiar vista del calendario
                calendar.changeView(view);
            });
        });
        
        // Filtro de espacio
        const spaceFilter = document.getElementById('spaceFilter');
        spaceFilter.addEventListener('change', function() {
            const selectedSpace = this.value;
            console.log('üîÑ Filtro cambiado. Espacio seleccionado:', selectedSpace);
            
            // Obtener todos los eventos
            const allEvents = {{ eventos|safe }};
            console.log('üìä Total de eventos:', allEvents.length);
            
            if (!selectedSpace) {
                // Mostrar todos los eventos
                console.log('‚úÖ Mostrando todos los eventos');
                calendar.removeAllEvents();
                calendar.addEventSource(allEvents);
            } else {
                // Filtrar eventos por espacio
                const filteredEvents = allEvents.filter(event => {
                    const espacioId = event.extendedProps?.espacio_id;
                    console.log(`üîç Comparando: ${espacioId} == ${selectedSpace} (${espacioId == selectedSpace})`);
                    return espacioId == selectedSpace;
                });
                
                console.log('üéØ Eventos filtrados encontrados:', filteredEvents.length);
                console.log('üìã Eventos filtrados:', filteredEvents);
                
                // Limpiar y agregar eventos filtrados
                calendar.removeAllEvents();
                if (filteredEvents.length > 0) {
                    calendar.addEventSource(filteredEvents);
                } else {
                    console.log('‚ÑπÔ∏è No hay eventos para este espacio');
                }
            }
            
            // Forzar rerender del calendario
            calendar.render();
        });
        
        // Filtro de mes
        const monthFilter = document.getElementById('monthFilter');
        monthFilter.addEventListener('change', function() {
            const selectedDate = new Date(this.value + '-01');
            calendar.gotoDate(selectedDate);
        });
        
        // Sincronizar el filtro de mes con la vista actual del calendario
        calendar.on('datesSet', function(info) {
            const currentDate = info.view.currentStart;
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const monthYear = `${year}-${month}`;
            
            console.log('üîÑ Calendario cambi√≥ a:', monthYear);
            
            // Actualizar el valor del filtro de mes
            monthFilter.value = monthYear;
        });
            
        // Inicializar con la fecha de hoy
        updateSelectedDate(new Date().toISOString().split('T')[0]);
        updateDayReservations(new Date().toISOString().split('T')[0]);
    });
    </script>
</body>
</html>
============================================================


===== cancelar_reserva.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cancelar Reserva</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: rgba(0, 0, 0, 0.5);
            color: #111827;
            line-height: 1.6;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Modal */
        .modal {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            margin: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            padding: 24px 24px 0 24px;
            text-align: center;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
        }
        
        .modal-subtitle {
            color: #6B7280;
            font-size: 14px;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        /* Reservation Summary */
        .reservation-summary {
            background: #F3F4F6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }
        
        .summary-title {
            font-weight: 600;
            margin-bottom: 16px;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .summary-label {
            color: #6B7280;
            font-weight: 500;
        }
        
        .summary-value {
            color: #111827;
            font-weight: 600;
        }
        
        /* Warning */
        .warning {
            background: #FEF3C7;
            border: 1px solid #F59E0B;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .warning-icon {
            color: #F59E0B;
            font-size: 20px;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .warning-content {
            flex: 1;
        }
        
        .warning-title {
            font-weight: 600;
            color: #92400E;
            margin-bottom: 4px;
        }
        
        .warning-text {
            color: #78350F;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* Form */
        .form-group {
            margin-bottom: 24px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }
        
        .required {
            color: #DC2626;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.2s;
            resize: vertical;
            min-height: 100px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #2563EB;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .form-help {
            font-size: 12px;
            color: #6B7280;
            margin-top: 4px;
        }
        
        /* Buttons */
        .modal-footer {
            padding: 0 24px 24px 24px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 12px 24px;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            font-size: 14px;
            font-family: inherit;
        }
        
        .btn-secondary {
            background: white;
            color: #6B7280;
            border-color: #E5E7EB;
        }
        
        .btn-secondary:hover {
            background: #F9FAFB;
            border-color: #D1D5DB;
        }
        
        .btn-danger {
            background: #DC2626;
            color: white;
        }
        
        .btn-danger:hover {
            background: #B91C1C;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* Success State */
        .success-modal {
            text-align: center;
            padding: 40px 24px;
        }
        
        .success-icon {
            font-size: 64px;
            margin-bottom: 16px;
            display: block;
        }
        
        .success-title {
            font-size: 24px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 12px;
        }
        
        .success-message {
            color: #6B7280;
            margin-bottom: 16px;
            line-height: 1.6;
        }
        
        .success-details {
            background: #F0FDF4;
            border: 1px solid #BBF7D0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            text-align: left;
        }
        
        .success-details h4 {
            color: #15803D;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .success-details p {
            color: #166534;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Modal de Cancelaci√≥n -->
    <div class="modal" id="cancelModal">
        <div class="modal-header">
            <h2 class="modal-title">‚ùå Cancelar Reserva</h2>
            <p class="modal-subtitle">Esta acci√≥n no se puede deshacer</p>
        </div>
        
        <div class="modal-body">
            <!-- Resumen de la Reserva -->
            <div class="reservation-summary">
                <div class="summary-title">
                    üìã Informaci√≥n de la Reserva
                </div>
                
                <div class="summary-item">
                    <span class="summary-label">Espacio:</span>
                    <span class="summary-value">Sala de Conferencias A1</span>
                </div>
                
                <div class="summary-item">
                    <span class="summary-label">Fecha:</span>
                    <span class="summary-value">Viernes, 15 de Marzo 2025</span>
                </div>
                
                <div class="summary-item">
                    <span class="summary-label">Hora:</span>
                    <span class="summary-value">09:00 - 11:30</span>
                </div>
                
                <div class="summary-item">
                    <span class="summary-label">Duraci√≥n:</span>
                    <span class="summary-value">2 horas 30 minutos</span>
                </div>
            </div>
            
            <!-- Advertencia -->
            <div class="warning">
                <div class="warning-icon">‚ö†Ô∏è</div>
                <div class="warning-content">
                    <div class="warning-title">Pol√≠tica de Cancelaci√≥n</div>
                    <div class="warning-text">
                        ‚Ä¢ Las cancelaciones deben realizarse con al menos 24 horas de anticipaci√≥n<br>
                        ‚Ä¢ Esta acci√≥n no se puede deshacer<br>
                        ‚Ä¢ Se enviar√° una notificaci√≥n autom√°tica a todos los participantes
                    </div>
                </div>
            </div>
            
            <!-- Formulario -->
            <div class="form-group">
                <label for="cancelReason" class="form-label">
                    Motivo de cancelaci√≥n <span class="required">*</span>
                </label>
                <textarea 
                    id="cancelReason" 
                    class="form-control" 
                    placeholder="Por favor, proporciona el motivo de la cancelaci√≥n..."
                    required
                ></textarea>
                <div class="form-help">
                    Este motivo ser√° incluido en la notificaci√≥n enviada a los participantes
                </div>
            </div>
        </div>
        
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">
                ‚Ü©Ô∏è No, mantener reserva
            </button>
            <button type="button" class="btn btn-danger" onclick="confirmCancel()" disabled id="confirmBtn">
                ‚ùå S√≠, cancelar reserva
            </button>
        </div>
    </div>
    
    <!-- Modal de Confirmaci√≥n de √âxito -->
    <div class="modal hidden" id="successModal">
        <div class="success-modal">
            <span class="success-icon">‚úÖ</span>
            <h2 class="success-title">Reserva Cancelada Exitosamente</h2>
            <p class="success-message">
                Tu reserva ha sido cancelada y se han enviado las notificaciones correspondientes.
            </p>
            
            <div class="success-details">
                <h4>üìß Informaci√≥n sobre Pol√≠ticas</h4>
                <p>
                    Como la cancelaci√≥n se realiz√≥ con m√°s de 24 horas de anticipaci√≥n, 
                    no se aplicar√°n penalizaciones. Los participantes han sido notificados 
                    autom√°ticamente sobre la cancelaci√≥n.
                </p>
            </div>
            
            <button type="button" class="btn btn-secondary" onclick="goToHistory()">
                üìã Volver al historial
            </button>
        </div>
    </div>

    <script>
        // Habilitar bot√≥n de confirmaci√≥n cuando se escriba el motivo
        document.getElementById('cancelReason').addEventListener('input', function() {
            const confirmBtn = document.getElementById('confirmBtn');
            const hasText = this.value.trim().length > 10;
            confirmBtn.disabled = !hasText;
            
            if (hasText) {
                confirmBtn.style.opacity = '1';
            } else {
                confirmBtn.style.opacity = '0.5';
            }
        });
        
        function closeModal() {
            // En una aplicaci√≥n real, esto cerrar√≠a el modal
            alert('Modal cerrado - La reserva se mantiene activa');
        }
        
        function confirmCancel() {
            const reason = document.getElementById('cancelReason').value.trim();
            
            if (reason.length < 10) {
                alert('Por favor, proporciona un motivo m√°s detallado (m√≠nimo 10 caracteres)');
                return;
            }
            
            // Simular proceso de cancelaci√≥n
            document.getElementById('confirmBtn').innerHTML = '‚è≥ Cancelando...';
            document.getElementById('confirmBtn').disabled = true;
            
            setTimeout(() => {
                // Ocultar modal de cancelaci√≥n y mostrar confirmaci√≥n
                document.getElementById('cancelModal').classList.add('hidden');
                document.getElementById('successModal').classList.remove('hidden');
            }, 1500);
        }
        
        function goToHistory() {
            // En una aplicaci√≥n real, esto navegar√≠a al historial
            alert('Navegando al historial de reservas...');
        }
        
        // Cerrar modal con Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>
============================================================


===== crear_espacio.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Espacio - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f9fafb;
            color: #111827;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 24px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #2563eb;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .btn-primary {
            background: #10b981;
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-error {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #2563eb;
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <a href="{% url 'gestion_espacios' %}" class="back-link">
        ‚Üê Volver a Gesti√≥n de Espacios
    </a>

    <div class="container">
        <h1>‚ûï Crear Nuevo Espacio</h1>

        <div id="alertMessage" class="alert"></div>

        <form id="createSpaceForm">
            <div class="form-group">
                <label class="form-label">Nombre del Espacio *</label>
                <input type="text" class="form-input" id="nombre" name="nombre" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Tipo de Espacio *</label>
                <select class="form-select" id="tipo" name="tipo" required>
                    <option value="">Seleccionar tipo...</option>
                    <option value="Sala de Reuniones">Sala de Reuniones</option>
                    <option value="Auditorio">Auditorio</option>
                    <option value="Laboratorio">Laboratorio</option>
                    <option value="Oficina">Oficina</option>
                    <option value="Aula">Aula</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Capacidad *</label>
                <input type="number" class="form-input" id="capacidad" name="capacidad" min="1" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Edificio</label>
                <input type="text" class="form-input" id="edificio" name="edificio">
            </div>
            
            <div class="form-group">
                <label class="form-label">Piso</label>
                <input type="number" class="form-input" id="piso" name="piso" min="0">
            </div>
            
            <div class="form-group">
                <label class="form-label">Descripci√≥n</label>
                <textarea class="form-textarea" id="descripcion" name="descripcion"></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Estado</label>
                <select class="form-select" id="estado" name="estado">
                    <option value="Disponible">Disponible</option>
                    <option value="Mantenimiento">Mantenimiento</option>
                    <option value="Fuera de Servicio">Fuera de Servicio</option>
                </select>
            </div>
            
            <div class="form-actions">
                <a href="{% url 'gestion_espacios' %}" class="btn btn-secondary">Cancelar</a>
                <button type="submit" class="btn btn-primary">Crear Espacio</button>
            </div>
        </form>
    </div>

    <script>
        function showAlert(message, type) {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.display = 'block';
            setTimeout(() => { alertDiv.style.display = 'none'; }, 5000);
        }

        function getCSRFToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Form submission
        document.getElementById('createSpaceForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = '‚è≥ Creando...';
            submitBtn.disabled = true;
            
            const formData = {
                nombre: document.getElementById('nombre').value,
                tipo: document.getElementById('tipo').value,
                capacidad: document.getElementById('capacidad').value,
                edificio: document.getElementById('edificio').value,
                piso: document.getElementById('piso').value,
                descripcion: document.getElementById('descripcion').value,
                estado: document.getElementById('estado').value
            };

            console.log('üì§ Enviando datos:', formData);

            try {
                const response = await fetch('/api/espacios/crear/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                console.log('üì• Respuesta recibida:', data);

                if (data.success) {
                    showAlert('‚úÖ ' + data.message, 'success');
                    setTimeout(() => {
                        window.location.href = "{% url 'gestion_espacios' %}";
                    }, 1500);
                } else {
                    // Mostrar error espec√≠fico del servidor
                    const errorMsg = data.error || 'Error desconocido al crear el espacio';
                    showAlert('‚ùå Error: ' + errorMsg, 'error');
                    console.error('Error detallado:', data);
                }
            } catch (error) {
                console.error('‚ùå Error de conexi√≥n:', error);
                showAlert('‚ùå Error de conexi√≥n: ' + error.message, 'error');
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
============================================================


===== crear_reserva.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nueva Reserva - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f9fafb;
            color: #111827;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: #2563eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            max-width: 1000px;
            margin: 0 auto;
            padding: 24px;
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
            font-size: 14px;
            color: #6b7280;
        }

        .breadcrumb a {
            color: #2563eb;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        /* Step Wizard */
        .step-wizard {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .wizard-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .wizard-title {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
        }

        .wizard-subtitle {
            color: #6b7280;
            font-size: 16px;
        }

        .steps-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 32px;
            margin: 32px 0;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: #2563eb;
            color: white;
        }

        .step.completed .step-number {
            background: #10b981;
            color: white;
        }

        .step.pending .step-number {
            background: #e5e7eb;
            color: #6b7280;
        }

        .step-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .step.active .step-label {
            color: #2563eb;
        }

        .step-connector {
            width: 40px;
            height: 2px;
            background: #e5e7eb;
        }

        .step-connector.completed {
            background: #10b981;
        }

        /* Form Container */
        .form-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .form-step {
            padding: 32px;
            display: none;
        }

        .form-step.active {
            display: block;
        }

        .step-title {
            font-size: 24px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 24px;
        }

        /* Step 1 - Space Selection */
        .filters-section {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .filter-select, .filter-input {
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: #2563eb;
        }

        .spaces-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .space-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            background: white;
        }

        .space-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .space-card.selected {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .space-image {
            width: 100%;
            height: 160px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            position: relative;
        }

        .space-status {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .space-status.available {
            background: rgba(16, 185, 129, 0.9);
            color: white;
        }

        .space-status.occupied {
            background: rgba(220, 38, 38, 0.9);
            color: white;
        }

        .space-content {
            padding: 16px;
        }

        .space-name {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }

        .space-details {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 12px;
            font-size: 14px;
            color: #6b7280;
        }

        .space-detail {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .space-equipment {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .equipment-tag {
            background: #f3f4f6;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: #6b7280;
        }

        .space-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .action-btn {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            color: #374151;
        }

        .action-btn:hover {
            border-color: #2563eb;
            color: #2563eb;
        }

        .action-btn.primary {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .action-btn.primary:hover {
            background: #1d4ed8;
        }

        /* Step 2 - Date and Time */
        .datetime-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .form-input {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .availability-check {
            background: #f3f4f6;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .availability-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .availability-status.available {
            color: #10b981;
        }

        .availability-status.unavailable {
            color: #dc2626;
        }

        .recurring-options {
            margin-top: 20px;
            padding: 16px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        /* Step 3 - Details */
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .special-equipment {
            margin-top: 16px;
            display: none;
        }

        .special-equipment.visible {
            display: block;
        }

        /* Step 4 - Confirmation */
        .reservation-summary {
            background: #f9fafb;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .summary-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 16px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .summary-item {
            background: white;
            padding: 12px;
            border-radius: 8px;
        }

        .summary-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .summary-value {
            font-size: 16px;
            color: #111827;
            font-weight: 500;
        }

        .terms-section {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .terms-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .terms-text {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.5;
        }

        /* Form Navigation */
        .form-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 32px;
            background: #f9fafb;
            border-top: 1px solid #e5e7eb;
        }

        .nav-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .nav-btn.secondary {
            background: #6b7280;
            color: white;
        }

        .nav-btn.secondary:hover {
            background: #4b5563;
        }

        .nav-btn.primary {
            background: #2563eb;
            color: white;
        }

        .nav-btn.primary:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .nav-btn.success {
            background: #10b981;
            color: white;
        }

        .nav-btn.success:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .nav-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        /* Error Message */
        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .steps-indicator {
                gap: 16px;
            }

            .step-label {
                display: none;
            }

            .step-connector {
                width: 20px;
            }

            .datetime-grid {
                grid-template-columns: 1fr;
            }

            .spaces-grid {
                grid-template-columns: 1fr;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo">SR</div>
        </div>
        
        <div class="user-menu">
            <div class="user-avatar">
                {% if user.first_name and user.last_name %}
                    {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                {% else %}
                    {{ user.username|first|upper }}
                {% endif %}
            </div>
            <span>
                {% if user.first_name %}
                    {{ user.first_name }}
                {% else %}
                    {{ user.username }}
                {% endif %}
            </span>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="{% url 'dashboard' %}">Dashboard</a>
            <span>‚Ä∫</span>
            <a href="{% url 'crear_reserva' %}">Reservar</a>
            <span>‚Ä∫</span>
            <span>Nueva Reserva</span>
        </nav>

        <!-- Step Wizard -->
        <div class="step-wizard">
            <div class="wizard-header">
                <h1 class="wizard-title">Nueva Reserva</h1>
                <p class="wizard-subtitle">Completa los siguientes pasos para solicitar tu reserva</p>
            </div>

            <div class="steps-indicator">
                <div class="step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Espacio</div>
                </div>
                <div class="step-connector"></div>
                <div class="step pending" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Fecha/Hora</div>
                </div>
                <div class="step-connector"></div>
                <div class="step pending" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Detalles</div>
                </div>
                <div class="step-connector"></div>
                <div class="step pending" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">Confirmar</div>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div class="error-message" id="errorMessage"></div>

        <!-- Form Container -->
        <div class="form-container">
            <!-- Step 1: Space Selection -->
            <div class="form-step active" data-step="1">
                <h2 class="step-title">Selecciona un Espacio</h2>

                <!-- Filters -->
                <div class="filters-section">
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label class="filter-label">üë• Capacidad</label>
                            <select class="filter-select" id="capacityFilter">
                                <option value="">Cualquier capacidad</option>
                                <option value="1-10">1-10 personas</option>
                                <option value="11-25">11-25 personas</option>
                                <option value="26-50">26-50 personas</option>
                                <option value="50+">M√°s de 50</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label">üè¢ Edificio</label>
                            <select class="filter-select" id="buildingFilter">
                                <option value="">Todos los edificios</option>
                                <option value="a">Edificio A</option>
                                <option value="b">Edificio B</option>
                                <option value="c">Edificio C</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label class="filter-label">üîß Equipamiento</label>
                            <select class="filter-select" id="equipmentFilter">
                                <option value="">Sin filtro</option>
                                <option value="projector">Proyector</option>
                                <option value="wifi">WiFi</option>
                                <option value="ac">Aire Acondicionado</option>
                                <option value="whiteboard">Pizarra</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Spaces Grid -->
                <div class="spaces-grid" id="spacesGrid">
                    {% for espacio in espacios %}
                    <div class="space-card" data-space-id="{{ espacio.id }}">
                        <div class="space-image">
                            {% if espacio.tipo == 'Sala de Reuniones' %}
                                üèõÔ∏è
                            {% elif espacio.tipo == 'Auditorio' %}
                                üé≠
                            {% elif espacio.tipo == 'Laboratorio' %}
                                üî¨
                            {% elif espacio.tipo == 'Oficina' %}
                                üíº
                            {% elif espacio.tipo == 'Aula' %}
                                üè´
                            {% else %}
                                üè¢
                            {% endif %}
                            <div class="space-status available">Disponible</div>
                        </div>
                        <div class="space-content">
                            <h3 class="space-name">{{ espacio.nombre }}</h3>
                            <div class="space-location">
                                <span>üìç</span>
                                <span>
                                    {% if espacio.edificio and espacio.piso %}
                                        {{ espacio.edificio }}, Piso {{ espacio.piso }}
                                    {% elif espacio.edificio %}
                                        {{ espacio.edificio }}
                                    {% else %}
                                        Ubicaci√≥n no especificada
                                    {% endif %}
                                </span>
                            </div>
                            
                            <div class="space-details">
                                <div class="space-detail">
                                    <span>üë•</span>
                                    <span>{{ espacio.capacidad }} personas</span>
                                </div>
                                <div class="space-detail">
                                    <span>üìê</span>
                                    <span>{{ espacio.tipo }}</span>
                                </div>
                            </div>

                            {% if espacio.descripcion %}
                            <p style="color: #6b7280; font-size: 14px; margin-bottom: 12px; line-height: 1.4;">
                                {{ espacio.descripcion }}
                            </p>
                            {% endif %}

                            <div class="space-equipment">
                                {% for equipamiento in espacio.equipamientos.all %}
                                <span class="equipment-tag">{{ equipamiento.nombre_equipo }}</span>
                                {% empty %}
                                <span class="equipment-tag">Equipamiento b√°sico</span>
                                {% endfor %}
                            </div>

                            <div class="space-actions">
                                <button class="action-btn primary" onclick="selectSpace(this, {{ espacio.id }}, '{{ espacio.nombre }}')">
                                    Seleccionar
                                </button>
                                <button class="action-btn" onclick="verDetallesEspacio({{ espacio.id }})">
                                    Ver Detalles
                                </button>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="empty-state">
                        <div style="text-align: center; padding: 40px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">üè¢</div>
                            <h3 style="color: #6b7280; margin-bottom: 8px;">No hay espacios disponibles</h3>
                            <p style="color: #9ca3af; margin-bottom: 20px;">
                                Todos los espacios est√°n ocupados o en mantenimiento.
                            </p>
                            <a href="{% url 'dashboard' %}" class="action-btn primary">
                                Volver al Dashboard
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>

            <!-- Step 2: Date and Time -->
            <div class="form-step" data-step="2">
                <h2 class="step-title">Selecciona Fecha y Hora</h2>

                <div class="datetime-grid">
                    <div class="form-group">
                        <label class="form-label">üìÖ Fecha de la Reserva</label>
                        <input type="date" class="form-input" id="reservationDate" min="{{ today }}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">‚è∞ Hora de Inicio</label>
                        <select class="form-input" id="startTime">
                            <option value="">Selecciona hora</option>
                            <option value="08:00">08:00</option>
                            <option value="08:30">08:30</option>
                            <option value="09:00">09:00</option>
                            <option value="09:30">09:30</option>
                            <option value="10:00">10:00</option>
                            <option value="10:30">10:30</option>
                            <option value="11:00">11:00</option>
                            <option value="11:30">11:30</option>
                            <option value="12:00">12:00</option>
                            <option value="12:30">12:30</option>
                            <option value="13:00">13:00</option>
                            <option value="13:30">13:30</option>
                            <option value="14:00">14:00</option>
                            <option value="14:30">14:30</option>
                            <option value="15:00">15:00</option>
                            <option value="15:30">15:30</option>
                            <option value="16:00">16:00</option>
                            <option value="16:30">16:30</option>
                            <option value="17:00">17:00</option>
                            <option value="17:30">17:30</option>
                            <option value="18:00">18:00</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">‚è∞ Hora de Fin</label>
                        <select class="form-input" id="endTime">
                            <option value="">Selecciona hora</option>
                            <option value="09:00">09:00</option>
                            <option value="09:30">09:30</option>
                            <option value="10:00">10:00</option>
                            <option value="10:30">10:30</option>
                            <option value="11:00">11:00</option>
                            <option value="11:30">11:30</option>
                            <option value="12:00">12:00</option>
                            <option value="12:30">12:30</option>
                            <option value="13:00">13:00</option>
                            <option value="13:30">13:30</option>
                            <option value="14:00">14:00</option>
                            <option value="14:30">14:30</option>
                            <option value="15:00">15:00</option>
                            <option value="15:30">15:30</option>
                            <option value="16:00">16:00</option>
                            <option value="16:30">16:30</option>
                            <option value="17:00">17:00</option>
                            <option value="17:30">17:30</option>
                            <option value="18:00">18:00</option>
                            <option value="18:30">18:30</option>
                            <option value="19:00">19:00</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">‚è±Ô∏è Duraci√≥n</label>
                        <input type="text" class="form-input" id="duration" readonly placeholder="Selecciona horas para calcular">
                    </div>
                </div>

                <div class="availability-check">
                    <div class="availability-status available">
                        ‚úÖ Horario disponible para el espacio seleccionado
                    </div>
                </div>

                <div class="recurring-options">
                    <div class="checkbox-group">
                        <input type="checkbox" id="recurring">
                        <label for="recurring">üîÑ Reserva recurrente</label>
                    </div>
                    <div id="recurringDetails" style="display: none;">
                        <div class="form-group" style="margin-top: 12px;">
                            <label class="form-label">Repetir cada:</label>
                            <select class="form-input">
                                <option value="weekly">Semanal</option>
                                <option value="biweekly">Cada 2 semanas</option>
                                <option value="monthly">Mensual</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Details -->
            <div class="form-step" data-step="3">
                <h2 class="step-title">Detalles de la Reserva</h2>

                <div class="form-group">
                    <label class="form-label">üìù Prop√≥sito de la Reserva *</label>
                    <textarea class="form-input form-textarea" id="purpose" placeholder="Describe brevemente el prop√≥sito de tu reserva..." required></textarea>
                </div>

                <div class="datetime-grid">
                    <div class="form-group">
                        <label class="form-label">üë• N√∫mero de Asistentes *</label>
                        <input type="number" class="form-input" id="attendees" placeholder="0" min="1" max="200" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üìû Contacto Responsable</label>
                        <input type="tel" class="form-input" id="contact" placeholder="+56 9 1234 5678">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="specialEquipment">
                    <label for="specialEquipment">üîß Requiere equipos especiales</label>
                </div>

                <div class="special-equipment" id="specialEquipmentDetails">
                    <div class="form-group">
                        <label class="form-label">Detalles del equipamiento especial</label>
                        <textarea class="form-input" placeholder="Especifica qu√© equipos adicionales necesitas..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Step 4: Confirmation -->
            <div class="form-step" data-step="4">
                <h2 class="step-title">Confirmar Reserva</h2>

                <div class="reservation-summary">
                    <h3 class="summary-title">Resumen de la Reserva</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">Espacio</div>
                            <div class="summary-value" id="summarySpace">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Fecha</div>
                            <div class="summary-value" id="summaryDate">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Horario</div>
                            <div class="summary-value" id="summaryTime">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Duraci√≥n</div>
                            <div class="summary-value" id="summaryDuration">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Asistentes</div>
                            <div class="summary-value" id="summaryAttendees">-</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Prop√≥sito</div>
                            <div class="summary-value" id="summaryPurpose">-</div>
                        </div>
                    </div>
                </div>

                <div class="terms-section">
                    <h4 class="terms-title">üìã T√©rminos y Condiciones</h4>
                    <div class="terms-text">
                        <p>Al enviar esta solicitud de reserva, acepto los siguientes t√©rminos:</p>
                        <ul style="margin: 12px 0 12px 20px; line-height: 1.6;">
                            <li>La reserva est√° sujeta a aprobaci√≥n por parte del administrador</li>
                            <li>Debo llegar puntualmente y utilizar el espacio responsablemente</li>
                            <li>Cualquier da√±o ser√° responsabilidad del solicitante</li>
                            <li>Las cancelaciones deben realizarse con al menos 24 horas de anticipaci√≥n</li>
                            <li>El uso del espacio debe cumplir con las pol√≠ticas institucionales</li>
                        </ul>
                    </div>
                    
                    <div class="checkbox-group" style="margin-top: 16px;">
                        <input type="checkbox" id="acceptTerms" required>
                        <label for="acceptTerms">‚úÖ Acepto los t√©rminos y condiciones *</label>
                    </div>
                </div>
            </div>

            <!-- Form Navigation -->
            <div class="form-navigation">
                <button type="button" class="nav-btn secondary" id="prevBtn" style="visibility: hidden;">‚¨ÖÔ∏è Anterior</button>
                <button type="button" class="nav-btn primary" id="nextBtn">Siguiente ‚û°Ô∏è</button>
            </div>
        </div>
    </main>

<script>
    // Form wizard functionality
    let currentStep = 1;
    let selectedSpace = {
        id: null,
        name: null
    };
    let formData = {};

    const steps = document.querySelectorAll('.step');
    const formSteps = document.querySelectorAll('.form-step');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const errorMessage = document.getElementById('errorMessage');

    // Space selection - FUNCI√ìN CORREGIDA
    function selectSpace(button, spaceId, spaceName) {
        // Remover selecci√≥n anterior
        document.querySelectorAll('.space-card').forEach(card => {
            card.classList.remove('selected');
        });
        
        // Agregar selecci√≥n actual
        const spaceCard = button.closest('.space-card');
        spaceCard.classList.add('selected');
        
        // Guardar datos del espacio seleccionado
        selectedSpace.id = spaceId;
        selectedSpace.name = spaceName;
        
        console.log('Espacio seleccionado:', selectedSpace);
        
        // Ocultar mensaje de error si existe
        hideError();
    }

    function verDetallesEspacio(espacioId) {
        alert(`Mostrando detalles del espacio ID: ${espacioId}`);
    }

    // Date and time handling
    const startTimeSelect = document.getElementById('startTime');
    const endTimeSelect = document.getElementById('endTime');
    const durationInput = document.getElementById('duration');

    function calculateDuration() {
        const startTime = startTimeSelect.value;
        const endTime = endTimeSelect.value;

        if (startTime && endTime) {
            const start = new Date(`2024-01-01T${startTime}`);
            const end = new Date(`2024-01-01T${endTime}`);
            const diff = (end - start) / (1000 * 60); // minutes

            if (diff > 0) {
                const hours = Math.floor(diff / 60);
                const minutes = diff % 60;
                durationInput.value = `${hours}h ${minutes > 0 ? minutes + 'm' : ''}`;
            } else {
                durationInput.value = 'Horario inv√°lido';
            }
        }
    }

    startTimeSelect.addEventListener('change', calculateDuration);
    endTimeSelect.addEventListener('change', calculateDuration);

    // Recurring checkbox
    const recurringCheckbox = document.getElementById('recurring');
    const recurringDetails = document.getElementById('recurringDetails');

    recurringCheckbox.addEventListener('change', function() {
        recurringDetails.style.display = this.checked ? 'block' : 'none';
    });

    // Special equipment checkbox
    const specialEquipmentCheckbox = document.getElementById('specialEquipment');
    const specialEquipmentDetails = document.getElementById('specialEquipmentDetails');

    specialEquipmentCheckbox.addEventListener('change', function() {
        specialEquipmentDetails.classList.toggle('visible', this.checked);
    });

    // Navigation functions
    function showStep(step) {
        // Hide all steps
        steps.forEach((s, index) => {
            s.classList.remove('active', 'completed');
            if (index + 1 < step) {
                s.classList.add('completed');
            } else if (index + 1 === step) {
                s.classList.add('active');
            } else {
                s.classList.add('pending');
            }
        });

        formSteps.forEach((s, index) => {
            s.classList.toggle('active', index + 1 === step);
        });

        // Update step connectors
        const connectors = document.querySelectorAll('.step-connector');
        connectors.forEach((connector, index) => {
            connector.classList.toggle('completed', index + 1 < step);
        });

        // Update navigation buttons
        prevBtn.style.visibility = step === 1 ? 'hidden' : 'visible';
        
        if (step === 4) {
            nextBtn.textContent = '‚úÖ Enviar Solicitud';
            nextBtn.classList.remove('primary');
            nextBtn.classList.add('success');
            updateSummary();
        } else {
            nextBtn.textContent = 'Siguiente ‚û°Ô∏è';
            nextBtn.classList.remove('success');
            nextBtn.classList.add('primary');
        }
    }

    // FUNCI√ìN DE VALIDACI√ìN MEJORADA
    function validateStep(step) {
        hideError();
        
        switch(step) {
            case 1:
                if (!selectedSpace.id) {
                    showError('Por favor, selecciona un espacio disponible.');
                    return false;
                }
                return true;
                
            case 2:
                const date = document.getElementById('reservationDate').value;
                const startTime = document.getElementById('startTime').value;
                const endTime = document.getElementById('endTime').value;
                
                if (!date) {
                    showError('Por favor, selecciona una fecha para la reserva.');
                    return false;
                }
                if (!startTime) {
                    showError('Por favor, selecciona una hora de inicio.');
                    return false;
                }
                if (!endTime) {
                    showError('Por favor, selecciona una hora de fin.');
                    return false;
                }
                
                // Validar que la hora de fin sea despu√©s de la hora de inicio
                if (startTime >= endTime) {
                    showError('La hora de fin debe ser posterior a la hora de inicio.');
                    return false;
                }
                return true;
                
            case 3:
                const purpose = document.getElementById('purpose').value.trim();
                const attendees = document.getElementById('attendees').value;
                
                if (!purpose) {
                    showError('Por favor, describe el prop√≥sito de la reserva.');
                    return false;
                }
                if (purpose.length < 10) {
                    showError('El prop√≥sito debe tener al menos 10 caracteres.');
                    return false;
                }
                if (!attendees || parseInt(attendees) < 1) {
                    showError('Por favor, ingresa un n√∫mero v√°lido de asistentes.');
                    return false;
                }
                return true;
                
            case 4:
                if (!document.getElementById('acceptTerms').checked) {
                    showError('Debes aceptar los t√©rminos y condiciones para continuar.');
                    return false;
                }
                return true;
                
            default:
                return true;
        }
    }

    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
    }

    function hideError() {
        errorMessage.style.display = 'none';
    }

    function updateSummary() {
        if (currentStep === 4) {
            document.getElementById('summarySpace').textContent = selectedSpace.name || '-';
            document.getElementById('summaryDate').textContent = document.getElementById('reservationDate').value || '-';
            document.getElementById('summaryTime').textContent = 
                `${document.getElementById('startTime').value} - ${document.getElementById('endTime').value}`;
            document.getElementById('summaryDuration').textContent = document.getElementById('duration').value || '-';
            document.getElementById('summaryAttendees').textContent = document.getElementById('attendees').value || '-';
            document.getElementById('summaryPurpose').textContent = document.getElementById('purpose').value || '-';
        }
    }

    // FUNCI√ìN PARA OBTENER TOKEN CSRF
    function getCSRFToken() {
        const name = 'csrftoken';
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // FUNCI√ìN PRINCIPAL PARA CREAR RESERVA - CORREGIDA
    // FUNCI√ìN PRINCIPAL PARA CREAR RESERVA - CORREGIDA
// FUNCI√ìN PRINCIPAL PARA CREAR RESERVA - CORREGIDA
// FUNCI√ìN PRINCIPAL PARA CREAR RESERVA - CORREGIDA
async function crearReservaReal() {
    // Validar t√©rminos
    if (!document.getElementById('acceptTerms').checked) {
        showError('Por favor, acepta los t√©rminos y condiciones para continuar.');
        return false;
    }

    // Validar que hay un espacio seleccionado
    if (!selectedSpace.id) {
        showError('Por favor, selecciona un espacio.');
        return false;
    }

    // Recopilar datos del formulario
    const reservaData = {
        espacio_id: selectedSpace.id,
        fecha_reserva: document.getElementById('reservationDate').value,
        hora_inicio: document.getElementById('startTime').value,
        hora_fin: document.getElementById('endTime').value,
        proposito: document.getElementById('purpose').value,
        num_asistentes: parseInt(document.getElementById('attendees').value)
    };

    console.log('Datos a enviar:', reservaData);

    // Validar datos requeridos
    if (!reservaData.fecha_reserva || !reservaData.hora_inicio || !reservaData.hora_fin) {
        showError('Por favor, completa la fecha y hora de la reserva.');
        return false;
    }

    if (!reservaData.proposito || reservaData.proposito.length < 10) {
        showError('Por favor, proporciona un prop√≥sito m√°s detallado (m√≠nimo 10 caracteres).');
        return false;
    }

    // Mostrar loading
    const nextBtn = document.getElementById('nextBtn');
    nextBtn.innerHTML = '‚è≥ Creando reserva...';
    nextBtn.disabled = true;

    try {
        console.log('üì§ Enviando datos al servidor...');
        
        const response = await fetch('/api/crear-reserva/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken()
            },
            body: JSON.stringify(reservaData)
        });

        const data = await response.json();
        console.log('üì• Respuesta recibida:', data);

        if (data.success) {
            // Redirigir a la p√°gina de √©xito con el ID de la reserva
            window.location.href = data.redirect_url || `/reserva-exitosa/?reserva_id=${data.reserva_id}`;
        } else {
            console.log('‚ùå Error en la respuesta:', data.message);
            showError('Error al crear la reserva: ' + data.message);
            nextBtn.innerHTML = '‚úÖ Enviar Solicitud';
            nextBtn.disabled = false;
        }

    } catch (error) {
        console.error('‚ùå Error de conexi√≥n:', error);
        showError('Error de conexi√≥n. Intenta nuevamente.');
        nextBtn.innerHTML = '‚úÖ Enviar Solicitud';
        nextBtn.disabled = false;
    }
}

    // Event listeners
    nextBtn.addEventListener('click', function() {
        if (currentStep === 4) {
            // Llamar a la funci√≥n para crear reserva REAL
            crearReservaReal();
        } else {
            if (validateStep(currentStep)) {
                currentStep++;
                showStep(currentStep);
            }
        }
    });

    prevBtn.addEventListener('click', function() {
        if (currentStep > 1) {
            currentStep--;
            showStep(currentStep);
        }
    });

    // Initialize
    showStep(1);

    // Filters functionality
    const capacityFilter = document.getElementById('capacityFilter');
    const buildingFilter = document.getElementById('buildingFilter');
    const equipmentFilter = document.getElementById('equipmentFilter');

    function applyFilters() {
        const capacity = capacityFilter.value;
        const building = buildingFilter.value;
        const equipment = equipmentFilter.value;

        // Esta funci√≥n puede implementarse para filtrar espacios
        console.log('Aplicando filtros:', { capacity, building, equipment });
    }

    capacityFilter.addEventListener('change', applyFilters);
    buildingFilter.addEventListener('change', applyFilters);
    equipmentFilter.addEventListener('change', applyFilters);

    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('reservationDate').min = today;
</script>
</body>
</html>
============================================================


===== dashboard.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - INACAP</title>
</head>
<body>
    <h1>Bienvenido al Dashboard</h1>
    <p>Login exitoso! Esta es la p√°gina principal.</p>
    <a href="/logout/">Cerrar Sesi√≥n</a>
    
    <script>
        // Mostrar informaci√≥n del usuario
        const userData = sessionStorage.getItem('currentUser');
        if (userData) {
            const user = JSON.parse(userData);
            document.querySelector('h1').textContent = `Bienvenido ${user.nombre_completo}`;
            document.querySelector('p').innerHTML += `<br>Rol: ${user.rol}`;
        }
    </script>
</body>
</html>
============================================================


===== dashboard_admin.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Administrador - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #F9FAFB;
            color: #111827;
            line-height: 1.6;
        }
        
        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #E5E7EB;
            padding: 16px 24px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 700;
            color: #111827;
        }
        
        .nav-menu {
            display: flex;
            gap: 32px;
        }
        
        .nav-item {
            color: #6B7280;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .nav-item:hover, .nav-item.active {
            color: #2563EB;
            background: #EFF6FF;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .notification-badge {
            position: relative;
            background: #F3F4F6;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .notification-badge:hover {
            background: #E5E7EB;
        }
        
        .badge-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #DC2626;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .admin-avatar {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .admin-avatar:hover {
            background: #F3F4F6;
        }
        
        .avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #111827;
        }
        
        .page-subtitle {
            color: #6B7280;
            margin-bottom: 32px;
        }
        
        /* Metrics Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }
        
        .metric-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        
        .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .metric-icon.pending { background: #FEF3C7; color: #F59E0B; }
        .metric-icon.success { background: #D1FAE5; color: #10B981; }
        .metric-icon.info { background: #DBEAFE; color: #2563EB; }
        .metric-icon.purple { background: #EDE9FE; color: #7C3AED; }
        
        .metric-value {
            font-size: 36px;
            font-weight: 700;
            color: #111827;
            line-height: 1;
        }
        
        .metric-label {
            color: #6B7280;
            font-size: 14px;
            font-weight: 500;
        }
        
        .metric-change {
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 8px;
        }
        
        .metric-change.positive { color: #10B981; }
        .metric-change.negative { color: #DC2626; }
        
        /* Activity Section */
        .activity-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        
        .activity-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .activity-header {
            padding: 20px;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .activity-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
        }
        
        .view-all {
            color: #2563EB;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }
        
        .activity-content {
            padding: 20px;
        }
        
        /* Quick Actions */
        .quick-action {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-radius: 8px;
            text-decoration: none;
            color: #374151;
            transition: all 0.2s;
            margin-bottom: 8px;
        }
        
        .quick-action:hover {
            background: #F3F4F6;
            color: #2563EB;
        }
        
        .action-icon {
            width: 32px;
            height: 32px;
            background: #EFF6FF;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #2563EB;
        }
        
        .action-text {
            font-weight: 500;
        }
        
        /* Recent Activity */
        .activity-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #F3F4F6;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-avatar {
            width: 32px;
            height: 32px;
            background: #E5E7EB;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .activity-details {
            flex: 1;
        }
        
        .activity-description {
            font-size: 14px;
            color: #374151;
            margin-bottom: 2px;
        }
        
        .activity-time {
            font-size: 12px;
            color: #9CA3AF;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                üè¢ Panel Administrativo
            </div>
            
            <nav class="nav-menu">
                <a href="{% url 'admin_dashboard' %}" class="nav-item active">Dashboard</a>
                <a href="{% url 'solicitudes_pendientes' %}" class="nav-item">Solicitudes</a>
                <a href="{% url 'gestion_espacios' %}" class="nav-item">Espacios</a>
                <a href="{% url 'gestion_usuarios' %}" class="nav-item">Usuarios</a>
                <a href="{% url 'reportes' %}" class="nav-item">Reportes</a>
            </nav>
            
            <div class="header-right">
                <div class="notification-badge">
                    üîî
                    <span class="badge-count">{{ notificaciones_sin_leer }}</span>
                </div>
                
                <div class="admin-avatar">
                    <div class="avatar">
                        {% if user.first_name and user.last_name %}
                            {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                        {% else %}
                            {{ user.username|first|upper }}
                        {% endif %}
                    </div>
                    <span>
                        {% if user.first_name %}
                            {{ user.first_name }}
                        {% else %}
                            {{ user.username }}
                        {% endif %}
                    </span>
                    <a href="{% url 'logout' %}" style="margin-left: 10px; color: #666; text-decoration: none;">üö™</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-title">üìä Dashboard Administrativo</div>
        <div class="page-subtitle">
            Bienvenido, 
            {% if user.first_name %}
                {{ user.first_name }} {{ user.last_name }}
            {% else %}
                {{ user.username }}
            {% endif %}
            - Vista general del sistema de reservas
        </div>

        <!-- Metrics Cards -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <div>
                        <div class="metric-value">{{ total_reservas }}</div>
                        <div class="metric-label">Total Reservas</div>
                        <div class="metric-change positive">
                            ‚¨ÜÔ∏è Total del sistema
                        </div>
                    </div>
                    <div class="metric-icon info">üìä</div>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div>
                        <div class="metric-value">{{ reservas_pendientes }}</div>
                        <div class="metric-label">Solicitudes Pendientes</div>
                        <div class="metric-change positive">
                            ‚¨ÜÔ∏è Esperando aprobaci√≥n
                        </div>
                    </div>
                    <div class="metric-icon pending">‚è∞</div>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div>
                        <div class="metric-value">{{ total_espacios }}</div>
                        <div class="metric-label">Espacios Totales</div>
                        <div class="metric-change positive">
                            ‚¨ÜÔ∏è Disponibles
                        </div>
                    </div>
                    <div class="metric-icon success">üè¢</div>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div>
                        <div class="metric-value">{{ usuarios_activos }}</div>
                        <div class="metric-label">Usuarios Activos</div>
                        <div class="metric-change positive">
                            ‚¨ÜÔ∏è En el sistema
                        </div>
                    </div>
                    <div class="metric-icon purple">üë•</div>
                </div>
            </div>
        </div>

        <!-- Activity Section -->
        <div class="activity-section">
            <!-- Quick Actions -->
            <div class="activity-card">
                <div class="activity-header">
                    <div class="activity-title">‚ö° Acciones R√°pidas</div>
                </div>
                <div class="activity-content">
                    <a href="{% url 'solicitudes_pendientes' %}" class="quick-action">
                        <div class="action-icon">üìã</div>
                        <div class="action-text">Revisar solicitudes pendientes</div>
                    </a>
                    
                    <a href="{% url 'gestion_espacios' %}" class="quick-action">
                        <div class="action-icon">üè¢</div>
                        <div class="action-text">Gestionar espacios</div>
                    </a>
                    
                    <a href="{% url 'gestion_usuarios' %}" class="quick-action">
                        <div class="action-icon">üë•</div>
                        <div class="action-text">Gestionar usuarios</div>
                    </a>
                    
                    <a href="{% url 'reportes' %}" class="quick-action">
                        <div class="action-icon">üìä</div>
                        <div class="action-text">Ver reportes</div>
                    </a>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="activity-card">
                <div class="activity-header">
                    <div class="activity-title">‚è±Ô∏è Reservas Recientes</div>
                    <a href="{% url 'solicitudes_pendientes' %}" class="view-all">Ver todas</a>
                </div>
                <div class="activity-content">
                    {% for reserva in reservas_recientes %}
                    <div class="activity-item">
                        <div class="activity-avatar">
                            {{ reserva.solicitante.first_name|first|upper }}{{ reserva.solicitante.last_name|first|upper }}
                        </div>
                        <div class="activity-details">
                            <div class="activity-description">
                                {{ reserva.solicitante.first_name }} reserv√≥ {{ reserva.espacio.nombre }}
                            </div>
                            <div class="activity-time">
                                {{ reserva.fecha_reserva }} - {{ reserva.estado }}
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="activity-item">
                        <div class="activity-avatar">-</div>
                        <div class="activity-details">
                            <div class="activity-description">No hay reservas recientes</div>
                            <div class="activity-time">-</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </main>
</body>
</html>
============================================================


===== dashboard_usuario.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f9fafb;
            color: #111827;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: #2563eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav-menu {
            display: flex;
            gap: 32px;
        }

        .nav-item {
            color: #6b7280;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background: #2563eb;
            color: white;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            padding: 24px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: #6b7280;
            font-size: 16px;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border-left: 4px solid;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .stat-card.green {
            border-left-color: #10b981;
        }

        .stat-card.blue {
            border-left-color: #3b82f6;
        }

        .stat-card.orange {
            border-left-color: #f59e0b;
        }

        .stat-card.purple {
            border-left-color: #8b5cf6;
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .stat-title {
            color: #6b7280;
            font-size: 14px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-card.green .stat-icon {
            background: #d1fae5;
            color: #10b981;
        }

        .stat-card.blue .stat-icon {
            background: #dbeafe;
            color: #3b82f6;
        }

        .stat-card.orange .stat-icon {
            background: #fef3c7;
            color: #f59e0b;
        }

        .stat-card.purple .stat-icon {
            background: #ede9fe;
            color: #8b5cf6;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
            line-height: 1;
        }

        .stat-change {
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .stat-change.positive {
            color: #10b981;
        }

        .stat-change.negative {
            color: #ef4444;
        }

        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        .main-section, .sidebar-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
        }

        .view-all-btn {
            color: #2563eb;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }

        .view-all-btn:hover {
            text-decoration: underline;
        }

        /* Reservations Table */
        .reservations-table {
            width: 100%;
            border-collapse: collapse;
        }

        .reservations-table th,
        .reservations-table td {
            text-align: left;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .reservations-table th {
            font-weight: 600;
            color: #6b7280;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .reservations-table td {
            color: #111827;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge.approved {
            background: #d1fae5;
            color: #065f46;
        }

        .status-badge.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-badge.rejected {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .action-btn {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn.primary {
            background: #10b981;
            color: white;
        }

        .action-btn.primary:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .action-btn.secondary {
            background: #2563eb;
            color: white;
        }

        .action-btn.secondary:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        /* Recent Activity */
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 32px;
            height: 32px;
            background: #f3f4f6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 14px;
            color: #374151;
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .activity-time {
            font-size: 12px;
            color: #9ca3af;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .empty-state-text {
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 0 16px;
            }

            .nav-menu {
                display: none;
            }

            .main-content {
                padding: 16px;
            }

            .content-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .quick-actions {
                flex-direction: row;
            }

            .action-btn {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo">SR</div>
            <div style="font-weight: 600; color: #111827;">Sistema de Reservas</div>
        </div>
        
        <nav class="nav-menu">
            <a href="{% url 'dashboard' %}" class="nav-item active">Dashboard</a>
            <a href="{% url 'crear_reserva' %}" class="nav-item">Reservar</a>
            <a href="{% url 'reservas' %}" class="nav-item">Historial</a>
            <a href="{% url 'calendario' %}" class="nav-item">Calendario</a>
            <a href="{% url 'espacios' %}" class="nav-item">Espacios</a>
            <a href="{% url 'notificaciones' %}" class="nav-item">Notificaciones</a>
        </nav>
        
        <div class="user-menu">
            <div class="user-avatar">
                {% if user.first_name and user.last_name %}
                    {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                {% else %}
                    {{ user.username|first|upper }}
                {% endif %}
            </div>
            <span>
                {% if user.first_name %}
                    {{ user.first_name }} {{ user.last_name }}
                {% else %}
                    {{ user.username }}
                {% endif %}
            </span>
            <a href="{% url 'logout' %}" style="margin-left: 10px; color: #666; text-decoration: none;">üö™</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">Dashboard</h1>
            <p class="page-subtitle">
                Bienvenido de vuelta, 
                {% if user.first_name %}
                    {{ user.first_name }}
                {% else %}
                    {{ user.username }}
                {% endif %}. 
                Aqu√≠ tienes un resumen de tus reservas.
            </p>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card green">
                <div class="stat-header">
                    <div class="stat-title">Reservas Activas</div>
                    <div class="stat-icon">üìÖ</div>
                </div>
                <div class="stat-value">{{ reservas_activas }}</div>
                <div class="stat-change positive">‚úÖ Activas este mes</div>
            </div>

            <div class="stat-card orange">
                <div class="stat-header">
                    <div class="stat-title">Reservas Pendientes</div>
                    <div class="stat-icon">‚è∞</div>
                </div>
                <div class="stat-value">{{ reservas_pendientes }}</div>
                <div class="stat-change positive">üîÑ En espera de aprobaci√≥n</div>
            </div>

            <div class="stat-card blue">
                <div class="stat-header">
                    <div class="stat-title">Reservas Totales</div>
                    <div class="stat-icon">üìä</div>
                </div>
                <div class="stat-value">{{ total_reservas }}</div>
                <div class="stat-change positive">üìà Historial completo</div>
            </div>

            <div class="stat-card purple">
                <div class="stat-header">
                    <div class="stat-title">Espacios Favoritos</div>
                    <div class="stat-icon">‚ù§Ô∏è</div>
                </div>
                <div class="stat-value">3</div>
                <div class="stat-change positive">‚≠ê M√°s utilizados</div>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="content-grid">
            <!-- Main Section - Pr√≥ximas Reservas -->
            <div class="main-section">
                <div class="section-header">
                    <h2 class="section-title">Pr√≥ximas Reservas</h2>
                    <a href="{% url 'reservas' %}" class="view-all-btn">Ver todas</a>
                </div>
                
                {% if reservas_recientes %}
                <table class="reservations-table">
                    <thead>
                        <tr>
                            <th>Espacio</th>
                            <th>Fecha</th>
                            <th>Hora</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for reserva in reservas_recientes %}
                        <tr>
                            <td>{{ reserva.espacio.nombre }}</td>
                            <td>{{ reserva.fecha_reserva|date:"d M Y" }}</td>
                            <td>{{ reserva.hora_inicio|time:"H:i" }} - {{ reserva.hora_fin|time:"H:i" }}</td>
                            <td>
                                <span class="status-badge {{ reserva.estado|lower }}">
                                    {{ reserva.estado }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <h3 class="empty-state-title">No hay reservas recientes</h3>
                    <p class="empty-state-text">Crea tu primera reserva para comenzar</p>
                    <a href="{% url 'crear_reserva' %}" class="action-btn primary" style="margin-top: 16px;">
                        Crear Reserva
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar -->
            <div class="sidebar-section">
                <!-- Quick Actions -->
                <div class="section-header">
                    <h2 class="section-title">Acciones R√°pidas</h2>
                </div>
                <div class="quick-actions">
                    <a href="{% url 'crear_reserva' %}" class="action-btn primary">
                        <span>‚ûï</span>
                        Nueva Reserva
                    </a>
                    <a href="{% url 'calendario' %}" class="action-btn secondary">
                        <span>üìÖ</span>
                        Ver Calendario
                    </a>
                </div>

                <!-- Recent Activity -->
                <div style="margin-top: 24px;">
                    <div class="section-header">
                        <h2 class="section-title">Actividad Reciente</h2>
                    </div>
                    <div class="activity-list">
                        {% if reservas_recientes %}
                            {% for reserva in reservas_recientes|slice:":3" %}
                            <div class="activity-item">
                                <div class="activity-icon">
                                    {% if reserva.estado == 'Aprobada' %}
                                        ‚úÖ
                                    {% elif reserva.estado == 'Pendiente' %}
                                        ‚è∞
                                    {% else %}
                                        üìã
                                    {% endif %}
                                </div>
                                <div class="activity-content">
                                    <div class="activity-text">
                                        Reserva {{ reserva.estado|lower }} para {{ reserva.espacio.nombre }}
                                    </div>
                                    <div class="activity-time">
                                        {{ reserva.fecha_solicitud|timesince }} ago
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="activity-item">
                                <div class="activity-icon">üëã</div>
                                <div class="activity-content">
                                    <div class="activity-text">
                                        Bienvenido al sistema de reservas
                                    </div>
                                    <div class="activity-time">
                                        Comienza creando tu primera reserva
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Simple animations
        document.addEventListener('DOMContentLoaded', function() {
            // Add hover effects to stat cards
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px)';
                });
                card.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        });
    </script>
</body>
</html>
============================================================


===== detalle_reserva.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle de Reserva - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #F9FAFB;
            color: #111827;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .status-badge {
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-approved { background: #D1FAE5; color: #065F46; }
        .status-pending { background: #FEF3C7; color: #92400E; }
        .status-rejected { background: #FEE2E2; color: #991B1B; }
        .status-cancelled { background: #F3F4F6; color: #6B7280; }
        
        .reservation-id {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .btn-danger { background: #DC2626; color: white; }
        .btn-primary { background: #2563EB; color: white; }
        .btn-secondary { background: #6B7280; color: white; }
        .btn-success { background: #10B981; color: white; }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .card h3 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #111827;
            border-bottom: 2px solid #E5E7EB;
            padding-bottom: 8px;
        }
        
        .space-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
        }
        
        .space-info h4 {
            font-size: 20px;
            margin-bottom: 8px;
            color: #111827;
        }
        
        .space-description {
            color: #6B7280;
            margin-bottom: 16px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 0;
        }
        
        .info-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            color: #6B7280;
        }
        
        .info-label {
            font-weight: 600;
            color: #374151;
            min-width: 120px;
        }
        
        .info-value {
            color: #6B7280;
        }
        
        /* Timeline */
        .timeline-card {
            grid-column: 1 / -1;
        }
        
        .timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #E5E7EB;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 24px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -35px;
            top: 6px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: white;
            border: 3px solid #2563EB;
        }
        
        .timeline-item.completed::before {
            background: #10B981;
            border-color: #10B981;
        }
        
        .timeline-content {
            background: #F9FAFB;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #2563EB;
        }
        
        .timeline-content.completed {
            border-left-color: #10B981;
        }
        
        .timeline-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .timeline-date {
            color: #6B7280;
            font-size: 14px;
        }
        
        /* Observaciones */
        .observations {
            background: #FEF9E7;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #F59E0B;
            margin-top: 16px;
        }
        
        .observations h4 {
            color: #92400E;
            margin-bottom: 8px;
        }
        
        .observations p {
            color: #78350F;
        }
        
        .notes-section {
            margin-top: 16px;
        }
        
        .notes-section textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
        }
        
        .save-notes {
            margin-top: 8px;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
        }

        /* Modal de confirmaci√≥n */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        }

        .alert-success {
            background: #D1FAE5;
            color: #065F46;
            border: 1px solid #A7F3D0;
        }

        .alert-error {
            background: #FEE2E2;
            color: #991B1B;
            border: 1px solid #FECACA;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Alertas -->
        <div class="alert alert-success" id="successAlert"></div>
        <div class="alert alert-error" id="errorAlert"></div>

        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="status-badge" id="statusBadge">CARGANDO...</div>
                <div class="reservation-id">ID: <span id="reservationId">RES-{{ reserva.id }}</span></div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-danger" onclick="cancelarReserva()" id="cancelBtn">‚ùå Cancelar Reserva</button>
                <button class="btn btn-success" onclick="duplicarReserva()" id="duplicateBtn">üìã Duplicar</button>
                <button class="btn btn-secondary" onclick="imprimirReserva()" id="printBtn">üñ®Ô∏è Imprimir</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Informaci√≥n del Espacio -->
            <div class="card">
                <h3>üìç Informaci√≥n del Espacio</h3>
                <div class="space-image">
                    {% if reserva.espacio.tipo == 'Sala de Reuniones' %}
                        üèõÔ∏è
                    {% elif reserva.espacio.tipo == 'Auditorio' %}
                        üé≠
                    {% elif reserva.espacio.tipo == 'Laboratorio' %}
                        üî¨
                    {% elif reserva.espacio.tipo == 'Oficina' %}
                        üíº
                    {% elif reserva.espacio.tipo == 'Aula' %}
                        üè´
                    {% else %}
                        üè¢
                    {% endif %}
                </div>
                <div class="space-info">
                    <h4 id="spaceName">{{ reserva.espacio.nombre }}</h4>
                    <p class="space-description" id="spaceDescription">
                        {{ reserva.espacio.descripcion|default:"Espacio disponible para reuniones y eventos." }}
                    </p>
                    
                    <div class="info-item">
                        <div class="info-icon">üìç</div>
                        <div class="info-label">Ubicaci√≥n:</div>
                        <div class="info-value" id="spaceLocation">
                            {% if reserva.espacio.edificio and reserva.espacio.piso %}
                                {{ reserva.espacio.edificio }}, Piso {{ reserva.espacio.piso }}
                            {% elif reserva.espacio.edificio %}
                                {{ reserva.espacio.edificio }}
                            {% else %}
                                Edificio Principal
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">üë•</div>
                        <div class="info-label">Capacidad:</div>
                        <div class="info-value" id="spaceCapacity">{{ reserva.espacio.capacidad }} personas</div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">‚öôÔ∏è</div>
                        <div class="info-label">Equipamiento:</div>
                        <div class="info-value" id="spaceEquipment">
                            {% if reserva.espacio.equipamientos.all %}
                                {% for equipamiento in reserva.espacio.equipamientos.all %}
                                    {{ equipamiento.nombre_equipo }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            {% else %}
                                Equipamiento b√°sico
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Informaci√≥n Temporal y Detalles -->
            <div class="card">
                <h3>‚è∞ Detalles de la Reserva</h3>
                
                <div style="margin-bottom: 24px;">
                    <h4 style="color: #374151; margin-bottom: 12px;">Informaci√≥n Temporal</h4>
                    <div class="info-item">
                        <div class="info-icon">üìÖ</div>
                        <div class="info-label">Fecha:</div>
                        <div class="info-value" id="reservationDate">
                            {{ reserva.fecha_reserva|date:"l, d F Y" }}
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">üïê</div>
                        <div class="info-label">Hora:</div>
                        <div class="info-value" id="reservationTime">
                            {{ reserva.hora_inicio|time:"H:i" }} - {{ reserva.hora_fin|time:"H:i" }}
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">‚è±Ô∏è</div>
                        <div class="info-label">Duraci√≥n:</div>
                        <div class="info-value" id="reservationDuration">
                            {{ reserva_data.duracion }}
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4 style="color: #374151; margin-bottom: 12px;">Detalles Adicionales</h4>
                    <div class="info-item">
                        <div class="info-icon">üéØ</div>
                        <div class="info-label">Prop√≥sito:</div>
                        <div class="info-value" id="reservationPurpose">{{ reserva.proposito }}</div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">üë•</div>
                        <div class="info-label">Asistentes:</div>
                        <div class="info-value" id="reservationAttendees">{{ reserva.num_asistentes }} personas</div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">üë§</div>
                        <div class="info-label">Solicitante:</div>
                        <div class="info-value" id="reservationUser">
                            {{ user.get_full_name|default:user.username }}<br>
                            <small style="color: #9CA3AF;">{{ user.email }}<br>Usuario registrado</small>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-icon">üìù</div>
                        <div class="info-label">Fecha solicitud:</div>
                        <div class="info-value" id="requestDate">
                            {{ reserva.fecha_solicitud|date:"d F, H:i" }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timeline de Estados -->
        <div class="card timeline-card">
            <h3>üìä Timeline de Estados</h3>
            <div class="timeline">
                <div class="timeline-item completed">
                    <div class="timeline-content completed">
                        <div class="timeline-title">‚úÖ Solicitud Enviada</div>
                        <div class="timeline-date">{{ reserva.fecha_solicitud|date:"d F, H:i" }}</div>
                    </div>
                </div>
                
                {% if reserva.estado != 'Pendiente' %}
                <div class="timeline-item completed">
                    <div class="timeline-content completed">
                        <div class="timeline-title">
                            {% if reserva.estado == 'Aprobada' %}
                                ‚úÖ Aprobada
                            {% elif reserva.estado == 'Rechazada' %}
                                ‚ùå Rechazada
                            {% elif reserva.estado == 'Cancelada' %}
                                üö´ Cancelada
                            {% endif %}
                        </div>
                        <div class="timeline-date">
                            {% if reserva.id_aprobador %}
                                Por: {{ reserva.id_aprobador.get_full_name|default:reserva.id_aprobador.username }}
                            {% else %}
                                Procesada por el sistema
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            
            <!-- Observaciones -->
            {% if reserva.comentario_admin %}
            <div class="observations">
                <h4>üí¨ Comentarios del Administrador</h4>
                <p id="adminComments">{{ reserva.comentario_admin }}</p>
            </div>
            {% endif %}
            
            <div class="notes-section">
                <h4 style="margin-bottom: 8px;">üìù Notas del Usuario</h4>
                <textarea placeholder="Agregar notas personales sobre esta reserva..." id="userNotes"></textarea>
                <div class="save-notes">
                    <button class="btn btn-primary btn-small" onclick="guardarNotas()">üíæ Guardar Notas</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmaci√≥n -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <h3 id="modalTitle">Confirmar Acci√≥n</h3>
            <p id="modalMessage">¬øEst√°s seguro de que deseas realizar esta acci√≥n?</p>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="cerrarModal()">Cancelar</button>
                <button class="btn btn-primary" id="confirmActionBtn">Confirmar</button>
            </div>
        </div>
    </div>

    <script>
        // Datos de la reserva desde Django
        const reservaData = {
            id: {{ reserva.id }},
            estado: "{{ reserva.estado|lower }}",
            espacio: {
                id: {{ reserva.espacio.id }},
                nombre: "{{ reserva.espacio.nombre }}",
                tipo: "{{ reserva.espacio.tipo }}"
            }
        };

        // Inicializar la p√°gina con los datos
        document.addEventListener('DOMContentLoaded', function() {
            actualizarEstadoBotones();
            cargarNotasGuardadas();
        });

        function actualizarEstadoBotones() {
            const cancelBtn = document.getElementById('cancelBtn');
            const duplicateBtn = document.getElementById('duplicateBtn');
            const statusBadge = document.getElementById('statusBadge');

            // Actualizar badge de estado
            statusBadge.className = 'status-badge ';
            switch(reservaData.estado) {
                case 'aprobada':
                    statusBadge.classList.add('status-approved');
                    statusBadge.textContent = 'APROBADA';
                    break;
                case 'pendiente':
                    statusBadge.classList.add('status-pending');
                    statusBadge.textContent = 'PENDIENTE';
                    break;
                case 'rechazada':
                    statusBadge.classList.add('status-rejected');
                    statusBadge.textContent = 'RECHAZADA';
                    cancelBtn.disabled = true;
                    cancelBtn.textContent = '‚ùå Reserva Rechazada';
                    break;
                case 'cancelada':
                    statusBadge.classList.add('status-cancelled');
                    statusBadge.textContent = 'CANCELADA';
                    cancelBtn.disabled = true;
                    cancelBtn.textContent = '‚ùå Reserva Cancelada';
                    duplicateBtn.disabled = true;
                    break;
            }

            // Deshabilitar cancelaci√≥n si no est√° pendiente o aprobada
            if (reservaData.estado !== 'pendiente' && reservaData.estado !== 'aprobada') {
                cancelBtn.disabled = true;
            }
        }

        // Funci√≥n para obtener el token CSRF
        function getCSRFToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Funci√≥n para mostrar alertas
        function mostrarAlerta(mensaje, tipo = 'success') {
            const alert = document.getElementById(tipo === 'success' ? 'successAlert' : 'errorAlert');
            alert.textContent = mensaje;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // Funci√≥n para mostrar modal de confirmaci√≥n
        function mostrarModal(titulo, mensaje, callback) {
            document.getElementById('modalTitle').textContent = titulo;
            document.getElementById('modalMessage').textContent = mensaje;
            
            const confirmBtn = document.getElementById('confirmActionBtn');
            confirmBtn.onclick = callback;
            
            document.getElementById('confirmationModal').style.display = 'flex';
        }

        function cerrarModal() {
            document.getElementById('confirmationModal').style.display = 'none';
        }

        // Funci√≥n para cancelar reserva
        function cancelarReserva() {
            if (reservaData.estado === 'cancelada') {
                mostrarAlerta('Esta reserva ya est√° cancelada.', 'error');
                return;
            }

            if (reservaData.estado === 'rechazada') {
                mostrarAlerta('No se puede cancelar una reserva rechazada.', 'error');
                return;
            }

            mostrarModal(
                'Cancelar Reserva',
                '¬øEst√°s seguro de que deseas cancelar esta reserva? Esta acci√≥n no se puede deshacer.',
                function() {
                    realizarCancelacion();
                }
            );
        }

        async function realizarCancelacion() {
            try {
                // Mostrar loading
                document.body.classList.add('loading');
                const cancelBtn = document.getElementById('cancelBtn');
                const originalText = cancelBtn.innerHTML;
                cancelBtn.innerHTML = '‚è≥ Cancelando...';
                cancelBtn.disabled = true;

                // Llamar a la API de cancelaci√≥n CORRECTA
                const response = await fetch(`/api/reservas/${reservaData.id}/cancelar/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    }
                });

                const data = await response.json();

                if (data.success) {
                    // Actualizar estado local
                    reservaData.estado = 'cancelada';
                    actualizarEstadoBotones();
                    
                    mostrarAlerta('‚úÖ Reserva cancelada exitosamente');
                    cerrarModal();
                    
                    // Recargar la p√°gina despu√©s de 2 segundos para mostrar cambios
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                } else {
                    throw new Error(data.error || 'Error al cancelar la reserva');
                }
            } catch (error) {
                console.error('Error:', error);
                mostrarAlerta('‚ùå Error al cancelar la reserva: ' + error.message, 'error');
                
                // Restaurar bot√≥n
                const cancelBtn = document.getElementById('cancelBtn');
                cancelBtn.innerHTML = originalText;
                cancelBtn.disabled = false;
            } finally {
                document.body.classList.remove('loading');
                cerrarModal();
            }
        }

        // Funci√≥n para duplicar reserva
        function duplicarReserva() {
            if (reservaData.estado === 'cancelada') {
                mostrarAlerta('No se puede duplicar una reserva cancelada.', 'error');
                return;
            }

            // Redirigir a la p√°gina de crear reserva con los datos prellenados
            const params = new URLSearchParams({
                espacio_id: reservaData.espacio.id,
                duplicar: reservaData.id
            });
            
            window.location.href = `/crear-reserva/?${params}`;
        }

        // Funci√≥n para imprimir reserva
        function imprimirReserva() {
            // Abrir ventana de impresi√≥n con los datos actuales
            const ventanaImpresion = window.open('', '_blank');
            const contenido = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Comprobante de Reserva - RES-${reservaData.id}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.4; }
                        .header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
                        .section { margin-bottom: 20px; }
                        .section h3 { color: #333; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
                        .info-item { display: flex; margin-bottom: 8px; }
                        .info-label { font-weight: bold; min-width: 150px; }
                        .status { padding: 5px 10px; border-radius: 10px; font-weight: bold; text-align: center; display: inline-block; }
                        .approved { background: #d1fae5; color: #065f46; }
                        .pending { background: #fef3c7; color: #92400e; }
                        .rejected { background: #fee2e2; color: #991b1b; }
                        .cancelled { background: #f3f4f6; color: #6b7280; }
                        @media print {
                            body { margin: 10px; }
                            .no-print { display: none; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Comprobante de Reserva</h1>
                        <p><strong>ID:</strong> RES-${reservaData.id}</p>
                        <div class="status ${reservaData.estado}">
                            ${reservaData.estado.toUpperCase()}
                        </div>
                    </div>
                    
                    <div class="section">
                        <h3>Informaci√≥n del Espacio</h3>
                        <div class="info-item">
                            <span class="info-label">Espacio:</span>
                            <span>${document.getElementById('spaceName').textContent}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Ubicaci√≥n:</span>
                            <span>${document.getElementById('spaceLocation').textContent}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Capacidad:</span>
                            <span>${document.getElementById('spaceCapacity').textContent}</span>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h3>Detalles de la Reserva</h3>
                        <div class="info-item">
                            <span class="info-label">Fecha:</span>
                            <span>${document.getElementById('reservationDate').textContent}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Horario:</span>
                            <span>${document.getElementById('reservationTime').textContent}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Duraci√≥n:</span>
                            <span>${document.getElementById('reservationDuration').textContent}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Asistentes:</span>
                            <span>${document.getElementById('reservationAttendees').textContent}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Prop√≥sito:</span>
                            <span>${document.getElementById('reservationPurpose').textContent}</span>
                        </div>
                    </div>
                    
                    <div class="section">
                        <h3>Informaci√≥n del Solicitante</h3>
                        <div class="info-item">
                            <span class="info-label">Nombre:</span>
                            <span>${document.getElementById('reservationUser').textContent.split('\\n')[0]}</span>
                        </div>
                    </div>
                    
                    <div class="section no-print">
                        <p><em>Documento generado el ${new Date().toLocaleDateString('es-CL')}</em></p>
                    </div>
                </body>
                </html>
            `;
            
            ventanaImpresion.document.write(contenido);
            ventanaImpresion.document.close();
            ventanaImpresion.focus();
            ventanaImpresion.print();
        }

        // Funci√≥n para guardar notas
        function guardarNotas() {
            const notas = document.getElementById('userNotes').value;
            // Guardar en localStorage
            localStorage.setItem(`notas_reserva_${reservaData.id}`, notas);
            mostrarAlerta('‚úÖ Notas guardadas correctamente');
        }

        // Cargar notas guardadas
        function cargarNotasGuardadas() {
            const notasGuardadas = localStorage.getItem(`notas_reserva_${reservaData.id}`);
            if (notasGuardadas) {
                document.getElementById('userNotes').value = notasGuardadas;
            }
        }

        // Cerrar modal al hacer clic fuera
        document.getElementById('confirmationModal').addEventListener('click', function(e) {
            if (e.target === this) {
                cerrarModal();
            }
        });

        // Cerrar modal con ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                cerrarModal();
            }
        });
    </script>
</body>
</html>
============================================================


===== editar_espacio.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Espacio - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f9fafb;
            color: #111827;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 24px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #374151;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #2563eb;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-error {
            background: #fee2e2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #2563eb;
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .back-link:hover {
            text-decoration: underline;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <a href="{% url 'gestion_espacios' %}" class="back-link">
        ‚Üê Volver a Gesti√≥n de Espacios
    </a>

    <div class="container">
        <h1>‚úèÔ∏è Editar Espacio</h1>

        <div id="alertMessage" class="alert"></div>
        <div id="loadingMessage" class="loading">Cargando datos del espacio...</div>

        <form id="editSpaceForm" style="display: none;">
            <input type="hidden" id="espacio_id" name="espacio_id">
            
            <div class="form-group">
                <label class="form-label">Nombre del Espacio *</label>
                <input type="text" class="form-input" id="nombre" name="nombre" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Tipo de Espacio *</label>
                <select class="form-select" id="tipo" name="tipo" required>
                    <option value="">Seleccionar tipo...</option>
                    <option value="Sala de Reuniones">Sala de Reuniones</option>
                    <option value="Auditorio">Auditorio</option>
                    <option value="Laboratorio">Laboratorio</option>
                    <option value="Oficina">Oficina</option>
                    <option value="Aula">Aula</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Capacidad *</label>
                <input type="number" class="form-input" id="capacidad" name="capacidad" min="1" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Edificio</label>
                <input type="text" class="form-input" id="edificio" name="edificio">
            </div>
            
            <div class="form-group">
                <label class="form-label">Piso</label>
                <input type="number" class="form-input" id="piso" name="piso" min="0">
            </div>
            
            <div class="form-group">
                <label class="form-label">Descripci√≥n</label>
                <textarea class="form-textarea" id="descripcion" name="descripcion"></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Estado</label>
                <select class="form-select" id="estado" name="estado">
                    <option value="Disponible">Disponible</option>
                    <option value="Mantenimiento">Mantenimiento</option>
                    <option value="Fuera de Servicio">Fuera de Servicio</option>
                </select>
            </div>
            
            <div class="form-actions">
                <a href="{% url 'gestion_espacios' %}" class="btn btn-secondary">Cancelar</a>
                <button type="submit" class="btn btn-primary">Actualizar Espacio</button>
            </div>
        </form>
    </div>

    <script>
        function showAlert(message, type) {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.display = 'block';
            setTimeout(() => { alertDiv.style.display = 'none'; }, 5000);
        }

        function getCSRFToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Cargar datos del espacio al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', async function() {
        const urlParams = new URLSearchParams(window.location.search);
        const espacioId = urlParams.get('id');
        
        console.log('üîç ID del espacio:', espacioId);
        
        if (!espacioId) {
            showAlert('‚ùå ID de espacio no especificado', 'error');
            return;
        }

        try {
            console.log('üì§ Solicitando datos del espacio...');
            const response = await fetch(`/api/espacios/${espacioId}/`);
            const data = await response.json();
            
            console.log('üì• Respuesta recibida:', data);

            if (data.success) {
                document.getElementById('espacio_id').value = data.espacio.id;
                document.getElementById('nombre').value = data.espacio.nombre;
                document.getElementById('tipo').value = data.espacio.tipo;
                document.getElementById('capacidad').value = data.espacio.capacidad;
                document.getElementById('edificio').value = data.espacio.edificio || '';
                document.getElementById('piso').value = data.espacio.piso || '';
                document.getElementById('descripcion').value = data.espacio.descripcion || '';
                document.getElementById('estado').value = data.espacio.estado;
                
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('editSpaceForm').style.display = 'block';
                console.log('‚úÖ Formulario cargado correctamente');
            } else {
                const errorMsg = data.error || 'Error desconocido';
                showAlert('‚ùå Error al cargar el espacio: ' + errorMsg, 'error');
                console.error('Error detallado:', data);
            }
        } catch (error) {
            console.error('‚ùå Error de conexi√≥n:', error);
            showAlert('‚ùå Error de conexi√≥n al cargar el espacio: ' + error.message, 'error');
        }
    });

    // Form submission para editar - VERSI√ìN DEBUG
    document.getElementById('editSpaceForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = '‚è≥ Actualizando...';
        submitBtn.disabled = true;
        
        const espacioId = document.getElementById('espacio_id').value;
        const formData = {
            nombre: document.getElementById('nombre').value,
            tipo: document.getElementById('tipo').value,
            capacidad: document.getElementById('capacidad').value,
            edificio: document.getElementById('edificio').value,
            piso: document.getElementById('piso').value,
            descripcion: document.getElementById('descripcion').value,
            estado: document.getElementById('estado').value
        };

        console.log('üì§ Actualizando espacio ID:', espacioId);
        console.log('üì§ Datos a enviar:', formData);

        try {
            const response = await fetch(`/api/espacios/${espacioId}/actualizar/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                },
                body: JSON.stringify(formData)
            });

            const data = await response.json();
            console.log('üì• Respuesta recibida:', data);

            if (data.success) {
                showAlert('‚úÖ ' + data.message, 'success');
                setTimeout(() => {
                    window.location.href = "{% url 'gestion_espacios' %}";
                }, 1500);
            } else {
                const errorMsg = data.error || 'Error desconocido';
                showAlert('‚ùå Error: ' + errorMsg, 'error');
                console.error('Error detallado:', data);
            }
        } catch (error) {
            console.error('‚ùå Error de conexi√≥n:', error);
            showAlert('‚ùå Error de conexi√≥n: ' + error.message, 'error');
        } finally {
            submitBtn.textContent = originalText;
            submitBtn.disabled = false;
        }
    });
    </script>
</body>
</html>
============================================================


===== espacios.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espacios Disponibles - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f9fafb;
            color: #111827;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: #2563eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav-menu {
            display: flex;
            gap: 32px;
        }

        .nav-item {
            color: #6b7280;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background: #2563eb;
            color: white;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            padding: 24px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: #6b7280;
            font-size: 16px;
        }

        /* Spaces Grid */
        .spaces-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 24px;
        }

        .space-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .space-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .space-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            position: relative;
        }

        .space-status {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .space-status.available {
            background: #10b981;
            color: white;
        }

        .space-status.maintenance {
            background: #f59e0b;
            color: white;
        }

        .space-status.unavailable {
            background: #ef4444;
            color: white;
        }

        .space-content {
            padding: 20px;
        }

        .space-name {
            font-size: 20px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }

        .space-location {
            color: #6b7280;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .space-details {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .space-detail {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #6b7280;
            font-size: 14px;
        }

        .space-equipment {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .equipment-tag {
            background: #f3f4f6;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            color: #6b7280;
        }

        .space-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-align: center;
            text-decoration: none;
            color: #374151;
        }

        .action-btn:hover {
            border-color: #2563eb;
            color: #2563eb;
        }

        .action-btn.primary {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .action-btn.primary:hover {
            background: #1d4ed8;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .action-btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 20px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }

        .empty-state-text {
            color: #6b7280;
            margin-bottom: 24px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .spaces-grid {
                grid-template-columns: 1fr;
            }

            .space-details {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .space-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo">SR</div>
        </div>
        
        <nav class="nav-menu">
            <a href="{% url 'dashboard' %}" class="nav-item">Dashboard</a>
            <a href="{% url 'crear_reserva' %}" class="nav-item">Reservar</a>
            <a href="{% url 'reservas' %}" class="nav-item">Historial</a>
            <a href="{% url 'calendario' %}" class="nav-item">Calendario</a>
            <a href="{% url 'espacios' %}" class="nav-item active">Espacios</a>
            <a href="{% url 'notificaciones' %}" class="nav-item">Notificaciones</a>
        </nav>

        <div class="user-menu">
            <div class="user-avatar">
                {% if user.first_name and user.last_name %}
                    {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                {% else %}
                    {{ user.username|first|upper }}
                {% endif %}
            </div>
            <span>
                {% if user.first_name %}
                    {{ user.first_name }}
                {% else %}
                    {{ user.username }}
                {% endif %}
            </span>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">üè¢ Espacios Disponibles</h1>
            <p class="page-subtitle">Explora y conoce todos los espacios disponibles para reservar</p>
        </div>

        <!-- Spaces Grid -->
        <div class="spaces-grid">
            {% for espacio in espacios %}
            <div class="space-card">
                <div class="space-image">
                    {% if espacio.tipo == 'Sala de Reuniones' %}
                        üèõÔ∏è
                    {% elif espacio.tipo == 'Auditorio' %}
                        üé≠
                    {% elif espacio.tipo == 'Laboratorio' %}
                        üî¨
                    {% elif espacio.tipo == 'Oficina' %}
                        üíº
                    {% elif espacio.tipo == 'Aula' %}
                        üè´
                    {% else %}
                        üè¢
                    {% endif %}
                    <div class="space-status available">Disponible</div>
                </div>
                <div class="space-content">
                    <h3 class="space-name">{{ espacio.nombre }}</h3>
                    <div class="space-location">
                        <span>üìç</span>
                        <span>
                            {% if espacio.edificio and espacio.piso %}
                                {{ espacio.edificio }}, Piso {{ espacio.piso }}
                            {% elif espacio.edificio %}
                                {{ espacio.edificio }}
                            {% else %}
                                Ubicaci√≥n no especificada
                            {% endif %}
                        </span>
                    </div>
                    
                    <div class="space-details">
                        <div class="space-detail">
                            <span>üë•</span>
                            <span>{{ espacio.capacidad }} personas</span>
                        </div>
                        <div class="space-detail">
                            <span>üìê</span>
                            <span>{{ espacio.tipo }}</span>
                        </div>
                    </div>

                    {% if espacio.descripcion %}
                    <p style="color: #6b7280; font-size: 14px; margin-bottom: 12px; line-height: 1.4;">
                        {{ espacio.descripcion }}
                    </p>
                    {% endif %}

                    <div class="space-equipment">
                        {% for equipamiento in espacio.equipamientos.all %}
                        <span class="equipment-tag">{{ equipamiento.nombre_equipo }}</span>
                        {% empty %}
                        <span class="equipment-tag">Equipamiento b√°sico</span>
                        {% endfor %}
                    </div>

                    <div class="space-actions">
                        <a href="{% url 'crear_reserva' %}?espacio_id={{ espacio.id }}" class="action-btn primary">
                            Reservar
                        </a>
                        <button class="action-btn" onclick="verDetallesEspacio({{ espacio.id }})">
                            Ver Detalles
                        </button>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <div class="empty-state-icon">üè¢</div>
                <h2 class="empty-state-title">No hay espacios disponibles</h2>
                <p class="empty-state-text">
                    Actualmente no hay espacios disponibles para reservar.
                </p>
                <a href="{% url 'dashboard' %}" class="action-btn primary">
                    Volver al Dashboard
                </a>
            </div>
            {% endfor %}
        </div>
    </main>

    <script>
        function verDetallesEspacio(espacioId) {
            alert(`Mostrando detalles del espacio ID: ${espacioId}`);
            // En una implementaci√≥n real, esto abrir√≠a un modal o redirigir√≠a a una p√°gina de detalles
        }

        // Agregar funcionalidad de b√∫squeda si es necesario
        document.addEventListener('DOMContentLoaded', function() {
            console.log('P√°gina de espacios cargada correctamente');
        });
    </script>
</body>
</html>
============================================================


===== gestion_espacios.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Espacios - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f9fafb;
            color: #111827;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: #2563eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav-menu {
            display: flex;
            gap: 32px;
        }

        .nav-item {
            color: #6b7280;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background: #2563eb;
            color: white;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            padding: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 24px;
            font-size: 14px;
            color: #6b7280;
        }

        .breadcrumb a {
            color: #2563eb;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .breadcrumb-separator {
            color: #9ca3af;
        }

        /* Page Header */
        .page-header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 14px;
        }

        .btn-primary {
            background: #10b981;
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        /* Filters */
        .filters-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .filter-select, .filter-input {
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: #2563eb;
        }

        /* Table */
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #f9fafb;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
        }

        .table td {
            padding: 16px;
            border-bottom: 1px solid #f3f4f6;
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .table tr:hover {
            background: #f9fafb;
        }

        /* Status Badges */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-available {
            background: #d1fae5;
            color: #065f46;
        }

        .status-maintenance {
            background: #fef3c7;
            color: #92400e;
        }

        .status-out-of-service {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            padding: 8px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-edit {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .btn-edit:hover {
            background: #bfdbfe;
        }

        .btn-delete {
            background: #fee2e2;
            color: #dc2626;
        }

        .btn-delete:hover {
            background: #fecaca;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }

        .empty-state-text {
            margin-bottom: 24px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                align-items: flex-start;
            }

            .header-actions {
                width: 100%;
                justify-content: flex-end;
            }

            .table-container {
                overflow-x: auto;
            }

            .table {
                min-width: 800px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo">SR</div>
            <div style="font-weight: 600; color: #111827;">Sistema de Reservas</div>
        </div>
        
        <nav class="nav-menu">
            <a href="{% url 'admin_dashboard' %}" class="nav-item">Dashboard</a>
            <a href="{% url 'solicitudes_pendientes' %}" class="nav-item">Solicitudes</a>
            <a href="{% url 'gestion_espacios' %}" class="nav-item active">Espacios</a>
            <a href="{% url 'gestion_usuarios' %}" class="nav-item">Usuarios</a>
            <a href="{% url 'reportes' %}" class="nav-item">Reportes</a>
        </nav>
        
        <div class="user-menu">
            <div class="user-avatar">
                {% if user.first_name and user.last_name %}
                    {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                {% else %}
                    {{ user.username|first|upper }}
                {% endif %}
            </div>
            <span>
                {% if user.first_name %}
                    {{ user.first_name }} {{ user.last_name }}
                {% else %}
                    {{ user.username }}
                {% endif %}
            </span>
            <a href="{% url 'logout' %}" style="margin-left: 10px; color: #666; text-decoration: none;">üö™</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="{% url 'admin_dashboard' %}">Dashboard</a>
            <span class="breadcrumb-separator">‚Ä∫</span>
            <span>Gesti√≥n de Espacios</span>
        </nav>

        <!-- Page Header -->
        <div class="page-header">
            <div class="header-content">
                <h1 class="page-title">üè¢ Gesti√≥n de Espacios</h1>
                <div class="header-actions">
                    <a href="{% url 'crear_espacio' %}" class="btn btn-primary">
                        <span>‚ûï</span>
                        Nuevo Espacio
                    </a>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-section">
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">Estado</label>
                    <select class="filter-select" id="statusFilter">
                        <option value="">Todos los estados</option>
                        <option value="Disponible">Disponible</option>
                        <option value="Mantenimiento">Mantenimiento</option>
                        <option value="Fuera de Servicio">Fuera de Servicio</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Tipo</label>
                    <select class="filter-select" id="typeFilter">
                        <option value="">Todos los tipos</option>
                        <option value="Sala de Reuniones">Sala de Reuniones</option>
                        <option value="Auditorio">Auditorio</option>
                        <option value="Laboratorio">Laboratorio</option>
                        <option value="Oficina">Oficina</option>
                        <option value="Aula">Aula</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">Edificio</label>
                    <input type="text" class="filter-input" id="buildingFilter" placeholder="Filtrar por edificio">
                </div>

                <div class="filter-group">
                    <label class="filter-label">B√∫squeda</label>
                    <input type="text" class="filter-input" id="searchFilter" placeholder="Buscar espacios...">
                </div>
            </div>
        </div>

        <!-- Table -->
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Tipo</th>
                        <th>Edificio</th>
                        <th>Piso</th>
                        <th>Capacidad</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="spacesTableBody">
                    {% for espacio in espacios %}
                    <tr>
                        <td>
                            <div style="font-weight: 600; color: #111827;">{{ espacio.nombre }}</div>
                            {% if espacio.descripcion %}
                            <div style="font-size: 12px; color: #6b7280; margin-top: 4px;">{{ espacio.descripcion|truncatewords:10 }}</div>
                            {% endif %}
                        </td>
                        <td>{{ espacio.tipo }}</td>
                        <td>{{ espacio.edificio|default:"-" }}</td>
                        <td>{{ espacio.piso|default:"-" }}</td>
                        <td>{{ espacio.capacidad }} personas</td>
                        <td>
                            {% if espacio.estado == 'Disponible' %}
                                <span class="status-badge status-available">Disponible</span>
                            {% elif espacio.estado == 'Mantenimiento' %}
                                <span class="status-badge status-maintenance">Mantenimiento</span>
                            {% elif espacio.estado == 'Fuera de Servicio' %}
                                <span class="status-badge status-out-of-service">Fuera de Servicio</span>
                            {% else %}
                                <span class="status-badge">{{ espacio.estado }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="action-buttons">
                                <a href="{% url 'editar_espacio' %}?id={{ espacio.id }}" class="btn-icon btn-edit" title="Editar">
                                    ‚úèÔ∏è
                                </a>
                                <button class="btn-icon btn-delete" onclick="eliminarEspacio({{ espacio.id }})" title="Eliminar">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <div class="empty-state-icon">üè¢</div>
                                <h3 class="empty-state-title">No hay espacios registrados</h3>
                                <p class="empty-state-text">
                                    Comienza agregando el primer espacio al sistema.
                                </p>
                                <a href="{% url 'crear_espacio' %}" class="btn btn-primary">
                                    <span>‚ûï</span>
                                    Crear Primer Espacio
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>

    <script>
        // Filtros de tabla
        document.addEventListener('DOMContentLoaded', function() {
            const statusFilter = document.getElementById('statusFilter');
            const typeFilter = document.getElementById('typeFilter');
            const buildingFilter = document.getElementById('buildingFilter');
            const searchFilter = document.getElementById('searchFilter');
            const tableBody = document.getElementById('spacesTableBody');
            const rows = tableBody.getElementsByTagName('tr');

            function applyFilters() {
                const statusValue = statusFilter.value.toLowerCase();
                const typeValue = typeFilter.value.toLowerCase();
                const buildingValue = buildingFilter.value.toLowerCase();
                const searchValue = searchFilter.value.toLowerCase();

                for (let row of rows) {
                    if (row.cells.length < 7) continue; // Skip empty state row
                    
                    const status = row.cells[5].textContent.toLowerCase();
                    const type = row.cells[1].textContent.toLowerCase();
                    const building = row.cells[2].textContent.toLowerCase();
                    const name = row.cells[0].textContent.toLowerCase();
                    const description = row.cells[0].querySelector('div:nth-child(2)')?.textContent.toLowerCase() || '';

                    const statusMatch = !statusValue || status.includes(statusValue);
                    const typeMatch = !typeValue || type.includes(typeValue);
                    const buildingMatch = !buildingValue || building.includes(buildingValue);
                    const searchMatch = !searchValue || 
                                       name.includes(searchValue) || 
                                       description.includes(searchValue);

                    row.style.display = statusMatch && typeMatch && buildingMatch && searchMatch ? '' : 'none';
                }
            }

            statusFilter.addEventListener('change', applyFilters);
            typeFilter.addEventListener('change', applyFilters);
            buildingFilter.addEventListener('input', applyFilters);
            searchFilter.addEventListener('input', applyFilters);
        });

        // Funci√≥n para eliminar espacio
        async function eliminarEspacio(espacioId) {
            if (!confirm('¬øEst√°s seguro de que deseas eliminar este espacio? Esta acci√≥n no se puede deshacer.')) {
                return;
            }

            try {
                const response = await fetch(`/api/espacios/${espacioId}/eliminar/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    }
                });

                const data = await response.json();

                if (data.success) {
                    alert('Espacio eliminado exitosamente');
                    location.reload(); // Recargar la p√°gina para actualizar la lista
                } else {
                    alert('Error al eliminar el espacio: ' + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error de conexi√≥n al eliminar el espacio');
            }
        }

        // Funci√≥n para obtener token CSRF
        function getCSRFToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>
============================================================


===== gestion_usuarios.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Usuarios - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #F9FAFB;
            color: #111827;
            line-height: 1.6;
        }
        
        .header {
            background: white;
            border-bottom: 1px solid #E5E7EB;
            padding: 16px 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 20px;
            font-weight: 700;
            color: #111827;
        }
        
        .nav-menu {
            display: flex;
            gap: 32px;
        }
        
        .nav-item {
            color: #6B7280;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .nav-item:hover, .nav-item.active {
            color: #2563EB;
            background: #EFF6FF;
        }
        
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .page-subtitle {
            color: #6B7280;
            margin-bottom: 32px;
        }
        
        .users-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .table-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            padding: 16px 24px;
            background: #F9FAFB;
            border-bottom: 1px solid #E5E7EB;
            font-weight: 600;
            color: #374151;
        }
        
        .user-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            padding: 16px 24px;
            border-bottom: 1px solid #F3F4F6;
            align-items: center;
        }
        
        .user-row:hover {
            background: #F9FAFB;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            background: #3B82F6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-name {
            font-weight: 500;
        }
        
        .user-email {
            color: #6B7280;
            font-size: 14px;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-active {
            background: #D1FAE5;
            color: #065F46;
        }
        
        .status-inactive {
            background: #FEF3C7;
            color: #92400E;
        }
        
        .role-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            background: #E0E7FF;
            color: #3730A3;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            margin-right: 8px;
            transition: all 0.2s;
        }
        
        .btn-edit {
            background: #DBEAFE;
            color: #1E40AF;
        }
        
        .btn-edit:hover {
            background: #BFDBFE;
        }
        
        .btn-deactivate {
            background: #FEE2E2;
            color: #DC2626;
        }
        
        .btn-deactivate:hover {
            background: #FECACA;
        }
        
        .btn-activate {
            background: #D1FAE5;
            color: #065F46;
        }
        
        .btn-activate:hover {
            background: #A7F3D0;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6B7280;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6B7280;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .btn-primary {
            background: #3B82F6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-secondary {
            background: #6B7280;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">üè¢ Panel Administrativo</div>
            <nav class="nav-menu">
                <a href="{% url 'admin_dashboard' %}" class="nav-item">Dashboard</a>
                <a href="{% url 'solicitudes_pendientes' %}" class="nav-item">Solicitudes</a>
                <a href="{% url 'gestion_espacios' %}" class="nav-item">Espacios</a>
                <a href="{% url 'gestion_usuarios' %}" class="nav-item active">Usuarios</a>
                <a href="{% url 'reportes' %}" class="nav-item">Reportes</a>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="page-title">üë• Gesti√≥n de Usuarios</div>
        <div class="page-subtitle">Administra los usuarios del sistema de reservas</div>

        <div class="users-table">
            <div class="table-header">
                <div>Usuario</div>
                <div>Email</div>
                <div>Rol</div>
                <div>Estado</div>
                <div>Acciones</div>
            </div>
            
            {% for usuario in usuarios %}
            <div class="user-row">
                <div class="user-info">
                    <div class="user-avatar">
                        {{ usuario.first_name|first|upper }}{{ usuario.last_name|first|upper }}
                    </div>
                    <div>
                        <div class="user-name">{{ usuario.first_name }} {{ usuario.last_name }}</div>
                        <div class="user-username">@{{ usuario.username }}</div>
                    </div>
                </div>
                <div class="user-email">{{ usuario.email }}</div>
                <div>
                    <span class="role-badge">
                        {% if usuario.perfilusuario.rol %}
                            {{ usuario.perfilusuario.rol }}
                        {% else %}
                            Usuario
                        {% endif %}
                    </span>
                </div>
                <div>
                    <span class="status-badge {% if usuario.is_active %}status-active{% else %}status-inactive{% endif %}">
                        {% if usuario.is_active %}Activo{% else %}Inactivo{% endif %}
                    </span>
                </div>
                <div>
                    <button class="action-btn btn-edit" onclick="editarUsuario({{ usuario.id }})">Editar</button>
                    {% if usuario.is_active %}
                    <button class="action-btn btn-deactivate" onclick="cambiarEstadoUsuario({{ usuario.id }}, false)">
                        Desactivar
                    </button>
                    {% else %}
                    <button class="action-btn btn-activate" onclick="cambiarEstadoUsuario({{ usuario.id }}, true)">
                        Activar
                    </button>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <div class="empty-icon">üë•</div>
                <h3>No hay usuarios registrados</h3>
                <p>No se encontraron usuarios en el sistema</p>
            </div>
            {% endfor %}
        </div>
    </main>

    <!-- Modal para editar usuario -->
    <div id="editUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">‚úèÔ∏è Editar Usuario</h3>
                <button class="close-modal" onclick="cerrarModal()">&times;</button>
            </div>
            <form id="editUserForm">
                <input type="hidden" id="editUserId">
                
                <div class="form-group">
                    <label class="form-label">Nombre</label>
                    <input type="text" id="editFirstName" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Apellido</label>
                    <input type="text" id="editLastName" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="editEmail" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Rol</label>
                    <select id="editRol" class="form-select">
                        <option value="Usuario">Usuario</option>
                        <option value="Docente">Docente</option>
                        <option value="Investigacion">Investigaci√≥n</option>
                        <option value="Administrativo">Administrativo</option>
                        <option value="Aprobador">Aprobador</option>
                    </select>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="cerrarModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function getCSRFToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Funci√≥n para abrir modal de edici√≥n
        async function editarUsuario(userId) {
            try {
                // Obtener datos del usuario
                const response = await fetch(`/api/usuarios/${userId}/`);
                const userData = await response.json();
                
                // Llenar el formulario
                document.getElementById('editUserId').value = userData.id;
                document.getElementById('editFirstName').value = userData.first_name || '';
                document.getElementById('editLastName').value = userData.last_name || '';
                document.getElementById('editEmail').value = userData.email || '';
                
                // Obtener el rol del perfil
                const perfilResponse = await fetch(`/api/perfiles/?user_id=${userId}`);
                const perfilData = await perfilResponse.json();
                
                if (perfilData.length > 0) {
                    document.getElementById('editRol').value = perfilData[0].rol || 'Usuario';
                }
                
                // Mostrar modal
                document.getElementById('editUserModal').style.display = 'flex';
                
            } catch (error) {
                alert('Error al cargar datos del usuario: ' + error);
            }
        }

        // Funci√≥n para cambiar estado del usuario
        async function cambiarEstadoUsuario(userId, activar) {
            const accion = activar ? 'activar' : 'desactivar';
            const confirmacion = confirm(`¬øEst√°s seguro de que deseas ${accion} este usuario?`);
            
            if (confirmacion) {
                try {
                    const response = await fetch(`/api/usuarios/${userId}/cambiar-estado/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken()
                        },
                        body: JSON.stringify({
                            activo: activar
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        alert(`Usuario ${activar ? 'activado' : 'desactivado'} exitosamente`);
                        location.reload();
                    } else {
                        alert('Error: ' + data.error);
                    }
                } catch (error) {
                    alert('Error de conexi√≥n: ' + error);
                }
            }
        }

        // Funci√≥n para cerrar modal
        function cerrarModal() {
            document.getElementById('editUserModal').style.display = 'none';
        }

        // Manejar env√≠o del formulario de edici√≥n
        document.getElementById('editUserForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const userId = document.getElementById('editUserId').value;
            const formData = {
                first_name: document.getElementById('editFirstName').value,
                last_name: document.getElementById('editLastName').value,
                email: document.getElementById('editEmail').value,
                rol: document.getElementById('editRol').value
            };
            
            try {
                const response = await fetch(`/api/usuarios/${userId}/actualizar/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Usuario actualizado exitosamente');
                    cerrarModal();
                    location.reload();
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Error de conexi√≥n: ' + error);
            }
        });

        // Cerrar modal al hacer clic fuera
        document.getElementById('editUserModal').addEventListener('click', function(e) {
            if (e.target === this) {
                cerrarModal();
            }
        });
    </script>
</body>
</html>
============================================================


===== login.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INACAP - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 450px;
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            gap: 12px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: #dc2626;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .logo-text {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }

        .welcome-text {
            font-size: 24px;
            color: #333;
            margin-bottom: 30px;
            font-weight: 300;
        }

        .tab-container {
            margin-bottom: 30px;
        }

        .tabs {
            display: flex;
            background: #f3f4f6;
            border-radius: 12px;
            padding: 6px;
            margin-bottom: 20px;
            gap: 4px;
        }

        .tab {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: transparent;
            color: #666;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
        }

        .tab.active {
            background: white;
            color: #2563eb;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .user-type-selector {
            display: flex;
            background: #f3f4f6;
            border-radius: 12px;
            padding: 6px;
            margin-bottom: 30px;
            gap: 4px;
        }

        .user-type-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            background: transparent;
            color: #666;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
        }

        .user-type-btn.active {
            background: white;
            color: #2563eb;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .user-type-info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 12px;
            color: #0369a1;
            text-align: left;
        }

        .form-container {
            display: none;
        }

        .form-container.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            background: #f9fafb;
        }

        .form-input:focus {
            outline: none;
            border-color: #2563eb;
            background: white;
        }

        .name-fields {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .password-container {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
        }

        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .remember-me {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #666;
            cursor: pointer;
        }

        .remember-checkbox {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: 2px solid #ddd;
            cursor: pointer;
        }

        .forgot-password {
            color: #2563eb;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }

        .forgot-password:hover {
            text-decoration: underline;
        }

        .action-button {
            width: 100%;
            padding: 15px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-button:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
        }

        .action-button.loading {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .action-button.register {
            background: #10b981;
        }

        .action-button.register:hover {
            background: #059669;
        }

        .action-button.admin {
            background: #dc2626;
        }

        .action-button.admin:hover {
            background: #b91c1c;
        }

        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .success-message {
            background: #d1fae5;
            color: #065f46;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .demo-credentials {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 12px;
            color: #0369a1;
        }

        .demo-title {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .demo-item {
            margin-bottom: 4px;
        }

        .switch-form {
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }

        .switch-form a {
            color: #2563eb;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        .switch-form a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="logo">
            <div class="logo-icon">IN</div>
            <div class="logo-text">INACAP</div>
        </div>
        
        <h1 class="welcome-text">Sistema de Reservas</h1>

        <div class="tab-container">
            <div class="tabs">
                <button class="tab active" data-tab="login">üîê Iniciar Sesi√≥n</button>
                <button class="tab" data-tab="register">üë§ Crear Cuenta</button>
            </div>
        </div>

        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>
        
        <!-- FORMULARIO DE LOGIN -->
        <div class="form-container active" id="loginFormContainer">
            <div class="user-type-selector">
                <button class="user-type-btn active" data-type="usuario">üë§ Usuario</button>
                <button class="user-type-btn" data-type="administrador">üîß Administrador</button>
            </div>
            
            <div class="user-type-info">
                <strong>üîí Informaci√≥n importante:</strong> Los roles de <strong>Investigaci√≥n</strong> y <strong>Administrativo</strong> tienen acceso al panel de administraci√≥n
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">üìß Correo Electr√≥nico</label>
                    <input 
                        type="email" 
                        id="loginEmail" 
                        class="form-input" 
                        placeholder="tu.email@ejemplo.com"
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label class="form-label">üîí Contrase√±a</label>
                    <div class="password-container">
                        <input 
                            type="password" 
                            id="loginPassword" 
                            class="form-input" 
                            placeholder="Tu contrase√±a"
                            required
                        >
                        <button type="button" class="toggle-password" onclick="togglePassword('loginPassword')">üëÅÔ∏è</button>
                    </div>
                </div>
                
                <div class="form-options">
                    <label class="remember-me">
                        <input type="checkbox" class="remember-checkbox" id="rememberMe">
                        Recordar sesi√≥n
                    </label>
                    <a href="#" class="forgot-password">¬øOlvidaste tu contrase√±a?</a>
                </div>
                
                <button type="submit" class="action-button" id="loginBtn">
                    Iniciar Sesi√≥n
                </button>
            </form>

            <div class="demo-credentials">
                <div class="demo-title">Credenciales de Prueba:</div>
                <div class="demo-item"><strong>Usuario Normal:</strong> test@gmail.com / 123456</div>
                <div class="demo-item"><strong>Administrador:</strong> admin@inacapmail.cl / admin123</div>
            </div>
        </div>

        <!-- FORMULARIO DE REGISTRO -->
        <div class="form-container" id="registerFormContainer">
            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label">üë§ Nombre Completo</label>
                    <div class="name-fields">
                        <input 
                            type="text" 
                            id="firstName" 
                            class="form-input" 
                            placeholder="Nombre"
                            required
                        >
                        <input 
                            type="text" 
                            id="lastName" 
                            class="form-input" 
                            placeholder="Apellido"
                            required
                        >
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üìß Correo Electr√≥nico</label>
                    <input 
                        type="email" 
                        id="registerEmail" 
                        class="form-input" 
                        placeholder="tu.email@ejemplo.com"
                        required
                    >
                </div>
                
                <div class="form-group">
                    <label class="form-label">üîí Contrase√±a</label>
                    <div class="password-container">
                        <input 
                            type="password" 
                            id="registerPassword" 
                            class="form-input" 
                            placeholder="Crea una contrase√±a segura"
                            required
                            minlength="6"
                        >
                        <button type="button" class="toggle-password" onclick="togglePassword('registerPassword')">üëÅÔ∏è</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üîí Confirmar Contrase√±a</label>
                    <div class="password-container">
                        <input 
                            type="password" 
                            id="confirmPassword" 
                            class="form-input" 
                            placeholder="Repite tu contrase√±a"
                            required
                        >
                        <button type="button" class="toggle-password" onclick="togglePassword('confirmPassword')">üëÅÔ∏è</button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üè¢ Departamento/√Årea</label>
                    <select id="department" class="form-input" required>
                        <option value="">Selecciona tu departamento</option>
                        <option value="Estudiante">Estudiante</option>
                        <option value="Docente">Docente</option>
                        <option value="Administrativo">Administrativo</option>
                        <option value="Investigaci√≥n">Investigaci√≥n</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">üéØ Tipo de Usuario</label>
                    <select id="rol" class="form-input" required>
                        <option value="Usuario">Usuario Normal</option>
                        <option value="Docente">Docente</option>
                        <option value="Investigacion">Investigaci√≥n</option>
                        <option value="Administrativo">Personal Administrativo</option>
                    </select>
                    <div class="user-type-info" style="margin-top: 8px;">
                        <strong>üîí Nota:</strong> Los roles de <strong>Investigaci√≥n</strong> y <strong>Administrativo</strong> tendr√°n acceso al panel de administraci√≥n
                    </div>
                </div>
                
                <button type="submit" class="action-button register" id="registerBtn">
                    üë§ Crear Mi Cuenta
                </button>
            </form>

            <div class="switch-form">
                ¬øYa tienes cuenta? <a onclick="showTab('login')">Inicia sesi√≥n aqu√≠</a>
            </div>
        </div>
    </div>

    <script>
        let currentUserType = 'usuario';
        let currentTab = 'login';

        // Sistema de pesta√±as
        function showTab(tabName) {
            currentTab = tabName;
            
            // Actualizar pesta√±as
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            
            // Actualizar formularios
            document.querySelectorAll('.form-container').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(`${tabName}FormContainer`).classList.add('active');
            
            // Limpiar mensajes
            hideMessages();
        }

        // Selector de tipo de usuario
        function selectUserType(type) {
            currentUserType = type;
            
            document.querySelectorAll('.user-type-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            const loginBtn = document.getElementById('loginBtn');
            if (type === 'administrador') {
                loginBtn.textContent = 'Iniciar Sesi√≥n como Administrador';
                loginBtn.className = 'action-button admin';
            } else {
                loginBtn.textContent = 'Iniciar Sesi√≥n';
                loginBtn.className = 'action-button';
            }
        }

        function togglePassword(fieldId) {
            const passwordInput = document.getElementById(fieldId);
            const toggleButton = passwordInput.parentNode.querySelector('.toggle-password');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleButton.textContent = 'üîí';
            } else {
                passwordInput.type = 'password';
                toggleButton.textContent = 'üëÅÔ∏è';
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
        }

        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }

        // Event listeners para pesta√±as
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                showTab(this.dataset.tab);
            });
        });

        // Event listeners para tipo de usuario
        document.querySelectorAll('.user-type-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                selectUserType(this.dataset.type);
            });
        });

        // FUNCI√ìN MEJORADA DE LOGIN
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Limpiar mensajes anteriores
            hideMessages();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const userType = currentUserType;
            
            console.log('üîÑ Iniciando proceso de login...');
            console.log('üìß Email:', email);
            console.log('üîë Password:', '*'.repeat(password.length));
            console.log('üë§ Tipo de usuario:', userType);
            
            if (!email || !password) {
                showError('Por favor completa todos los campos');
                return;
            }

            // Mostrar loading
            const loginBtn = document.getElementById('loginBtn');
            const originalText = loginBtn.innerHTML;
            loginBtn.innerHTML = '‚è≥ Conectando...';
            loginBtn.disabled = true;

            try {
                console.log('üì§ Enviando solicitud al servidor...');
                
                const response = await fetch('/login/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password,
                        user_type: userType
                    })
                });

                console.log('üì• Respuesta recibida. Status:', response.status);
                
                const data = await response.json();
                console.log('üìä Datos de respuesta:', data);
                
                if (data.success) {
                    console.log('‚úÖ Login exitoso, redirigiendo...');
                    showSuccess('¬°Login exitoso! Redirigiendo...');
                    
                    // Redirigir despu√©s de breve delay
                    setTimeout(() => {
                        window.location.href = data.redirect_url || '/dashboard/';
                    }, 1000);
                    
                } else {
                    console.log('‚ùå Login fallido:', data.message);
                    showError(data.message || 'Credenciales incorrectas');
                }
                
            } catch (error) {
                console.error('üí• Error completo:', error);
                
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    showError('Error de conexi√≥n. Verifica que el servidor est√© ejecut√°ndose en http://localhost:8000');
                } else {
                    showError('Error de conexi√≥n con el servidor');
                }
            } finally {
                console.log('üèÅ Finalizando proceso de login');
                loginBtn.innerHTML = originalText;
                loginBtn.disabled = false;
            }
        });

        // Manejar registro de usuario
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const department = document.getElementById('department').value;
            const rol = document.getElementById('rol').value;

            // Validaciones
            if (!firstName || !lastName) {
                showError('Por favor ingresa tu nombre completo');
                return;
            }

            if (password !== confirmPassword) {
                showError('Las contrase√±as no coinciden');
                return;
            }

            if (password.length < 6) {
                showError('La contrase√±a debe tener al menos 6 caracteres');
                return;
            }

            if (!department) {
                showError('Por favor selecciona tu departamento');
                return;
            }

            // Mostrar loading
            const registerBtn = document.getElementById('registerBtn');
            registerBtn.textContent = 'Creando cuenta...';
            registerBtn.disabled = true;

            try {
                const response = await fetch('/api/registro/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCSRFToken()
                    },
                    body: JSON.stringify({
                        first_name: firstName,
                        last_name: lastName,
                        email: email,
                        password: password,
                        department: department,
                        rol: rol
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess('¬°Cuenta creada exitosamente! Ahora puedes iniciar sesi√≥n.');
                    document.getElementById('registerForm').reset();
                    
                    // Cambiar a pesta√±a de login despu√©s de 2 segundos
                    setTimeout(() => {
                        showTab('login');
                        document.getElementById('loginEmail').value = email;
                    }, 2000);
                } else {
                    showError(data.message || 'Error al crear la cuenta');
                }

            } catch (error) {
                showError('Error de conexi√≥n. Intenta nuevamente.');
            } finally {
                registerBtn.textContent = 'üë§ Crear Mi Cuenta';
                registerBtn.disabled = false;
            }
        });

        // FUNCI√ìN PARA OBTENER CSRF TOKEN
        function getCSRFToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            
            console.log('üç™ CSRF Token:', cookieValue ? 'Encontrado' : 'No encontrado');
            return cookieValue;
        }

        // Probar conexi√≥n cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ P√°gina de login cargada');
            
            // Inicializar eventos
            document.querySelectorAll('.user-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    selectUserType(this.dataset.type);
                });
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    showTab(this.dataset.tab);
                });
            });
        });
    </script>
</body>
</html>
============================================================


===== login_admin.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INACAP - Login Administrador</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        .logo { 
            font-size: 32px; 
            font-weight: bold; 
            color: #333; 
            margin-bottom: 10px;
        }
        .subtitle { 
            color: #666; 
            margin-bottom: 30px;
        }
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-label { 
            display: block; 
            font-weight: 600; 
            color: #333; 
            margin-bottom: 8px; 
        }
        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .form-input:focus {
            outline: none;
            border-color: #dc2626;
        }
        .login-button {
            width: 100%;
            padding: 15px;
            background: #dc2626;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        .login-button:hover {
            background: #b91c1c;
        }
        .user-link {
            display: block;
            margin-top: 20px;
            color: #dc2626;
            text-decoration: none;
        }
        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        .warning {
            background: #fef3c7;
            color: #92400e;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="logo">inacap</div>
        <div class="subtitle">Panel de Administraci√≥n</div>
        
        <div class="warning">
            ‚ö†Ô∏è Acceso exclusivo para administradores
        </div>
        
        {% if messages %}
            {% for message in messages %}
                <div class="error-message">{{ message }}</div>
            {% endfor %}
        {% endif %}
        
        <form method="POST">
            {% csrf_token %}
            
            <div class="form-group">
                <label class="form-label">Usuario Administrador</label>
                <input type="text" name="username" class="form-input" placeholder="Usuario admin" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Contrase√±a</label>
                <input type="password" name="password" class="form-input" placeholder="Contrase√±a admin" required>
            </div>
            
            <button type="submit" class="login-button">Acceder al Panel Admin</button>
        </form>
        
        <a href="{% url 'login_usuario' %}" class="user-link">‚Üê Volver al login de usuarios</a>
    </div>
</body>
</html>
============================================================


===== login_usuario.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INACAP - Login Usuario</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        .logo { 
            font-size: 32px; 
            font-weight: bold; 
            color: #333; 
            margin-bottom: 10px;
        }
        .subtitle { 
            color: #666; 
            margin-bottom: 30px;
        }
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-label { 
            display: block; 
            font-weight: 600; 
            color: #333; 
            margin-bottom: 8px; 
        }
        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .login-button {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        .login-button:hover {
            background: #5a6fd8;
        }
        .admin-link {
            display: block;
            margin-top: 20px;
            color: #667eea;
            text-decoration: none;
        }
        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="logo">inacap</div>
        <div class="subtitle">Sistema de Reservas - Usuarios</div>
        
        {% if messages %}
            {% for message in messages %}
                <div class="error-message">{{ message }}</div>
            {% endfor %}
        {% endif %}
        
        <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="user_type" value="usuario">
            
            <div class="form-group">
                <label class="form-label">Usuario</label>
                <input type="text" name="username" class="form-input" placeholder="Ingresa tu usuario" required>
            </div>
            
            <div class="form-group">
                <label class="form-label">Contrase√±a</label>
                <input type="password" name="password" class="form-input" placeholder="Ingresa tu contrase√±a" required>
            </div>
            
            <button type="submit" class="login-button">Iniciar Sesi√≥n como Usuario</button>
        </form>
        
        <a href="{% url 'login_admin' %}" class="admin-link">¬øEres administrador? Accede aqu√≠</a>
    </div>
</body>
</html>
============================================================


===== notificaciones.html =====
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notificaciones</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 0;
      display: flex;
    }

    .container {
      width: 70%;
      padding: 20px;
    }

    h2 {
      margin-bottom: 15px;
    }

    .filters {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .filters button {
      padding: 8px 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background: #e6e6e6;
      transition: background 0.3s;
    }

    .filters button:hover {
      background: #d4d4d4;
    }

    .filters button.active {
      background: #0056d2;
      color: white;
    }

    .notification {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 12px;
      border-left: 6px solid;
      display: block;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .pendiente { border-color: #ffc107; }
    .aprobada { border-color: #28a745; }
    .rechazada { border-color: #dc3545; }

    .notification.unread {
      background: #f8f9fa;
      border-left-width: 8px;
    }

    .notification small {
      color: gray;
      display: block;
      margin-top: 6px;
    }

    .actions {
      margin-top: 10px;
    }

    .actions button {
      padding: 6px 12px;
      margin-right: 8px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: opacity 0.3s;
    }

    .actions button:hover {
      opacity: 0.9;
    }

    .btn-primary { background: #0056d2; color: white; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-success { background: #28a745; color: white; }
    .btn-warning { background: #ffc107; color: black; }
    .btn-secondary { background: #6c757d; color: white; }

    .sidebar {
      width: 30%;
      background: white;
      padding: 20px;
      border-left: 1px solid #ddd;
      min-height: 100vh;
    }

    .sidebar h3 {
      margin-bottom: 15px;
    }

    .preference {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      align-items: center;
    }

    .toggle {
      width: 40px;
      height: 20px;
      background: #ddd;
      border-radius: 15px;
      position: relative;
      cursor: pointer;
      transition: background 0.3s;
    }

    .toggle::after {
      content: "";
      width: 18px;
      height: 18px;
      background: white;
      border-radius: 50%;
      position: absolute;
      top: 1px;
      left: 1px;
      transition: 0.3s;
    }

    .toggle.active {
      background: #28a745;
    }

    .toggle.active::after {
      left: 21px;
    }

    .frecuencia {
      margin-top: 20px;
    }

    .frecuencia label {
      display: block;
      margin: 6px 0;
      cursor: pointer;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #6c757d;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #6c757d;
    }

    .error-state {
      text-align: center;
      padding: 20px;
      color: #dc3545;
      background: #f8d7da;
      border-radius: 8px;
      margin: 10px 0;
    }

    .refresh-btn {
      background: #0056d2;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
    }

    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
      margin-left: 8px;
    }

    .badge-pending { background: #fff3cd; color: #856404; }
    .badge-approved { background: #d4edda; color: #155724; }
    .badge-rejected { background: #f8d7da; color: #721c24; }

    .debug-panel {
      background: #e9ecef;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      font-size: 14px;
    }

    .data-source {
      margin-top: 10px;
      padding: 8px;
      background: #d1ecf1;
      border-radius: 4px;
      font-size: 12px;
    }
  </style>
</head>
<body> 
  <div class="container">
    <h2>üîî Notificaciones (<span id="notification-count">0</span>)</h2>

    <div class="filters">
      <button class="active" data-filter="all">Todas</button>
      <button data-filter="pending">Pendientes</button>
      <button data-filter="approved">Aprobadas</button>
      <button data-filter="rejected">Rechazadas</button>
    </div>
    

    <div class="debug-panel">
      <strong>Estado del Sistema:</strong>
      <div id="system-status">Conectando al servidor...</div>
      <div class="data-source" id="data-source-info">
        Fuente de datos: <span id="data-source">Cargando...</span>
      </div>
      <button onclick="probarConexion()" style="margin-top: 10px; padding: 5px 10px; background: #0056d2; color: white; border: none; border-radius: 3px; cursor: pointer;">
        Probar Conexi√≥n API
      </button>
    </div>

    <div id="notifications-container">
      <div class="loading">Cargando notificaciones desde la base de datos...</div>
    </div>
  </div>

  <div class="sidebar">
    <h3>‚öôÔ∏è Preferencias</h3>

    <div class="preference">
      <span>Notificaciones de reservas</span>
      <div class="toggle active" data-pref="reservas"></div>
    </div>

    <div class="preference">
      <span>Recordatorios</span>
      <div class="toggle active" data-pref="recordatorios"></div>
    </div>

    <div class="frecuencia">
      <h4>üìÖ Frecuencia</h4>
      <label><input type="radio" name="frecuencia" value="immediate" checked> Inmediata</label>
      <label><input type="radio" name="frecuencia" value="daily"> Resumen diario</label>
      <label><input type="radio" name="frecuencia" value="weekly"> Resumen semanal</label>
    </div>
  </div>

  <script>
    // Configuraci√≥n - USA LA MISMA URL QUE FUNCIONA
    const API_BASE_URL = 'http://127.0.0.1:8000/api';
    let allNotifications = [];
    let currentFilter = 'all';

    // Funci√≥n para probar conexi√≥n y mostrar datos REALES
    async function probarConexion() {
      const statusElement = document.getElementById('system-status');
      const dataSourceElement = document.getElementById('data-source');
      
      statusElement.innerHTML = 'üîÑ Conectando a la API...';
      
      try {
        const response = await fetch(`${API_BASE_URL}/reservas/`, {
          credentials: 'include'
        });
        
        if (response.ok) {
          const data = await response.json();
          statusElement.innerHTML = `‚úÖ Conexi√≥n exitosa! Se encontraron ${data.length} reservas REALES en la BD`;
          dataSourceElement.innerHTML = `Base de datos PostgreSQL (${data.length} reservas)`;
          
          console.log('üìä DATOS REALES DE LA BASE DE DATOS:', data);
          
          // Mostrar informaci√≥n detallada de las reservas
          if (data.length > 0) {
            let info = '<br><strong>Reservas encontradas:</strong><br>';
            data.forEach((reserva, index) => {
              info += `${index + 1}. ${reserva.espacio_nombre} - ${reserva.fecha_reserva} ${reserva.hora_inicio}-${reserva.hora_fin} (${reserva.estado})<br>`;
            });
            statusElement.innerHTML += info;
          }
          
          return data;
        } else {
          throw new Error(`Error ${response.status}: ${response.statusText}`);
        }
      } catch (error) {
        statusElement.innerHTML = `‚ùå Error de conexi√≥n: ${error.message}`;
        dataSourceElement.innerHTML = 'Datos de ejemplo (fallback)';
        throw error;
      }
    }

    // Funci√≥n para cargar datos REALES de la API
    async function loadRealData() {
      const statusElement = document.getElementById('system-status');
      const dataSourceElement = document.getElementById('data-source');
      
      try {
        console.log('üîÑ Conectando a la API para datos REALES...');
        const response = await fetch(`${API_BASE_URL}/reservas/`, {
          credentials: 'include'
        });
        
        if (response.ok) {
          const reservas = await response.json();
          console.log('‚úÖ DATOS REALES CARGADOS:', reservas);
          
          statusElement.innerHTML = `‚úÖ Conectado a la BD - ${reservas.length} reservas REALES`;
          dataSourceElement.innerHTML = 'Base de datos PostgreSQL';
          
          return reservas;
        } else {
          throw new Error(`API responded with status: ${response.status}`);
        }
      } catch (error) {
        console.error('‚ùå Error cargando datos reales:', error);
        statusElement.innerHTML = `‚ùå Error: ${error.message}`;
        dataSourceElement.innerHTML = 'Error al cargar datos reales';
        
        // NO usar datos de ejemplo - mejor mostrar error
        throw new Error('No se pudieron cargar los datos reales de la base de datos');
      }
    }

    // Funciones de formato
    function formatFecha(fecha) {
      if (!fecha) return 'Fecha no especificada';
      const partes = fecha.split('-');
      if (partes.length === 3) {
        return `${partes[2]}/${partes[1]}/${partes[0]}`;
      }
      return fecha;
    }

    function formatHora(hora) {
      if (!hora) return 'Hora no especificada';
      // Convertir "14:00:00" a "14:00"
      return hora.substring(0, 5);
    }

    function formatRelativeTime(dateString) {
      try {
        const date = new Date(dateString);
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMs / 3600000);
        const diffDays = Math.floor(diffMs / 86400000);

        if (diffMins < 1) return `Hace unos segundos`;
        if (diffMins < 60) return `Hace ${diffMins} minutos`;
        if (diffHours < 24) return `Hace ${diffHours} horas`;
        if (diffDays === 1) return `Ayer`;
        return `Hace ${diffDays} d√≠as`;
      } catch (error) {
        return 'Fecha no disponible';
      }
    }

    // Generar notificaciones desde datos REALES
    function generateNotificationsFromRealData(reservas) {
      console.log('üîÑ Generando notificaciones desde datos REALES:', reservas);
      
      return reservas.map(reserva => {
        // Usar los datos REALES de la base de datos
        const espacioNombre = reserva.espacio_nombre || 'Espacio no especificado';
        const fechaFormateada = formatFecha(reserva.fecha_reserva);
        const horaInicio = formatHora(reserva.hora_inicio);
        const horaFin = formatHora(reserva.hora_fin);
        const estado = reserva.estado || 'Pendiente';
        
        let mensaje = '';
        let clase = '';
        
        switch(estado) {
          case 'Pendiente':
            mensaje = `Tu solicitud para <strong>${espacioNombre}</strong> el <strong>${fechaFormateada}</strong> de <strong>${horaInicio} - ${horaFin}</strong> est√° en revisi√≥n.`;
            clase = 'pendiente';
            break;
          case 'Aprobada':
            mensaje = `¬°Tu reserva para <strong>${espacioNombre}</strong> el <strong>${fechaFormateada}</strong> de <strong>${horaInicio} - ${horaFin}</strong> ha sido aprobada!`;
            clase = 'aprobada';
            break;
          case 'Rechazada':
            mensaje = `Tu reserva para <strong>${espacioNombre}</strong> el <strong>${fechaFormateada}</strong> ha sido rechazada.`;
            clase = 'rechazada';
            break;
        }
        
        return {
          id: reserva.id,
          type: estado.toLowerCase(),
          class: clase,
          title: `üìã ${estado === 'Pendiente' ? 'Solicitud de Reserva' : 'Reserva'} <span class="badge badge-${estado.toLowerCase()}">${estado}</span>`,
          message: mensaje,
          timestamp: reserva.fecha_solicitud,
          read: false,
          actions: [
            { text: 'Ver detalles', class: 'btn-primary', action: 'view' },
            ...(estado === 'Pendiente' ? [{ text: 'Cancelar reserva', class: 'btn-danger', action: 'cancel' }] : [])
          ],
          reservaData: reserva
        };
      });
    }

    // Renderizar notificaciones
    function renderNotifications(notifications, filter = 'all') {
      const container = document.getElementById('notifications-container');
      const countElement = document.getElementById('notification-count');
      
      let filteredNotifications = notifications;
      
      switch(filter) {
        case 'pending':
          filteredNotifications = notifications.filter(n => n.type === 'pendiente');
          break;
        case 'approved':
          filteredNotifications = notifications.filter(n => n.type === 'aprobada');
          break;
        case 'rejected':
          filteredNotifications = notifications.filter(n => n.type === 'rechazada');
          break;
      }
      
      countElement.textContent = filteredNotifications.length;
      
      if (filteredNotifications.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <p>No hay notificaciones ${filter !== 'all' ? 'de ' + filter : ''}</p>
            <p><small>Los datos se cargan directamente desde la base de datos PostgreSQL</small></p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = filteredNotifications.map(notif => `
        <div class="notification ${notif.class} ${!notif.read ? 'unread' : ''}">
          <b>${notif.title}</b>
          <p>${notif.message}</p>
          <small>${formatRelativeTime(notif.timestamp)} - <em>Datos reales de la BD</em></small>
          <div class="actions">
            ${notif.actions.map(action => 
              `<button class="${action.class}" data-action="${action.action}" data-reserva-id="${notif.id}">
                ${action.text}
              </button>`
            ).join('')}
          </div>
        </div>
      `).join('');
    }

    // Inicializar la aplicaci√≥n con datos REALES
    document.addEventListener('DOMContentLoaded', async function() {
      try {
        // Cargar datos REALES de la base de datos
        const reservasReales = await loadRealData();
        allNotifications = generateNotificationsFromRealData(reservasReales);
        renderNotifications(allNotifications);
        
        if (reservasReales.length === 0) {
          document.getElementById('notifications-container').innerHTML = `
            <div class="empty-state">
              <p>No tienes reservas en el sistema</p>
              <p><small>Cuando crees una reserva, aparecer√° aqu√≠ con los datos reales de PostgreSQL</small></p>
            </div>
          `;
        }
        
      } catch (error) {
        console.error('Error inicializando:', error);
        document.getElementById('notifications-container').innerHTML = `
          <div class="error-state">
            <strong>No se pudieron cargar los datos reales</strong><br>
            ${error.message}<br>
            <small>Verifica que el servidor Django est√© corriendo y tengas reservas creadas</small>
            <button class="refresh-btn" onclick="location.reload()">Reintentar</button>
          </div>
        `;
        return;
      }

      // Filtros
      document.querySelectorAll('.filters button').forEach(button => {
        button.addEventListener('click', function() {
          document.querySelectorAll('.filters button').forEach(btn => {
            btn.classList.remove('active');
          });
          this.classList.add('active');
          currentFilter = this.getAttribute('data-filter');
          renderNotifications(allNotifications, currentFilter);
        });
      });

      // Acciones
      document.addEventListener('click', function(e) {
        const button = e.target.closest('.actions button');
        if (button) {
          const action = button.getAttribute('data-action');
          const reservaId = button.getAttribute('data-reserva-id');
          const notificacion = allNotifications.find(n => n.id == reservaId);
          
          if (notificacion) {
            const reserva = notificacion.reservaData;
            const fechaFormateada = formatFecha(reserva.fecha_reserva);
            const horaInicio = formatHora(reserva.hora_inicio);
            const horaFin = formatHora(reserva.hora_fin);
            
            switch(action) {
              case 'view':
                alert(`üìã Detalles de la reserva (DESDE BASE DE DATOS):\n\n
ID: ${reserva.id}\n
Espacio: ${reserva.espacio_nombre}\n
Fecha: ${fechaFormateada}\n
Horario: ${horaInicio} - ${horaFin}\n
Estado: ${reserva.estado}\n
Prop√≥sito: ${reserva.proposito || 'No especificado'}\n
N√∫mero de asistentes: ${reserva.num_asistentes || 'No especificado'}\n
Fecha de solicitud: ${formatRelativeTime(reserva.fecha_solicitud)}`);
                break;
              case 'cancel':
                if (confirm('¬øEst√°s seguro de que quieres cancelar esta reserva?')) {
                  alert('Funci√≥n de cancelaci√≥n (conectada a la API real)');
                }
                break;
            }
          }
        }
      });
    });

    // Toggles
    document.querySelectorAll('.toggle').forEach(toggle => {
      toggle.addEventListener('click', function() {
        this.classList.toggle('active');
      });
    });
  </script>
</body>
</html>
============================================================


===== notificaciones_admin.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notificaciones Admin - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f9fafb;
            color: #111827;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: #2563eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav-menu {
            display: flex;
            gap: 32px;
        }

        .nav-item {
            color: #6b7280;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background: #2563eb;
            color: white;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            padding: 24px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
        }

        .notification-count {
            background: #dc2626;
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .header-btn {
            padding: 10px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .header-btn:hover {
            border-color: #2563eb;
            color: #2563eb;
        }

        .header-btn.primary {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .header-btn.primary:hover {
            background: #1d4ed8;
        }

        /* Filters */
        .filters-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .filter-select {
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus {
            outline: none;
            border-color: #2563eb;
        }

        /* Notifications List */
        .notifications-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .notifications-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .notifications-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
        }

        .notifications-list {
            max-height: 600px;
            overflow-y: auto;
        }

        /* Priority Styles */
        .priority-urgente { border-left: 4px solid #dc2626; background: #fef2f2; }
        .priority-alta { border-left: 4px solid #f59e0b; background: #fffbeb; }
        .priority-media { border-left: 4px solid #2563eb; background: #eff6ff; }
        .priority-baja { border-left: 4px solid #10b981; background: #f0fdf4; }

        .notification-item {
            padding: 16px 24px;
            border-bottom: 1px solid #f3f4f6;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .notification-item:hover {
            background: #f9fafb;
        }

        .notification-item.unread {
            background: #fffbeb;
        }

        .notification-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 8px;
        }

        .notification-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }

        .notification-title {
            font-weight: 600;
            color: #111827;
            flex: 1;
        }

        .notification-time {
            font-size: 12px;
            color: #6b7280;
            white-space: nowrap;
        }

        .notification-message {
            color: #6b7280;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .notification-meta {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: #9ca3af;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        /* Real-time indicator */
        .real-time-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 8px;
            margin: 16px 24px;
            font-size: 14px;
            color: #166534;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo">SR</div>
            <div style="font-weight: 600; color: #111827;">Panel Administrativo</div>
        </div>
        
        <nav class="nav-menu">
            <a href="{% url 'admin_dashboard' %}" class="nav-item">Dashboard</a>
            <a href="{% url 'solicitudes_pendientes' %}" class="nav-item">Solicitudes</a>
            <a href="{% url 'gestion_espacios' %}" class="nav-item">Espacios</a>
            <a href="{% url 'gestion_usuarios' %}" class="nav-item">Usuarios</a>
            <a href="{% url 'notificaciones_admin' %}" class="nav-item active">Notificaciones</a>
        </nav>
        
        <div class="user-menu">
            <div class="user-avatar">
                {% if user.first_name and user.last_name %}
                    {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                {% else %}
                    {{ user.username|first|upper }}
                {% endif %}
            </div>
            <span>
                {% if user.first_name %}
                    {{ user.first_name }} {{ user.last_name }}
                {% else %}
                    {{ user.username }}
                {% endif %}
            </span>
            <a href="{% url 'logout' %}" style="margin-left: 10px; color: #666; text-decoration: none;">üö™</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <div class="header-left">
                <h1 class="page-title">üîî Notificaciones del Sistema</h1>
                <span class="notification-count" id="unreadCount">0</span>
            </div>
            <div class="header-actions">
                <button class="header-btn" id="refreshBtn">
                    üîÑ Actualizar
                </button>
                <button class="header-btn" id="markAllRead">
                    ‚úì Marcar todas como le√≠das
                </button>
                <button class="header-btn primary" id="clearRead">
                    üóëÔ∏è Limpiar le√≠das
                </button>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-section">
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">üìä Tipo de Evento</label>
                    <select class="filter-select" id="typeFilter">
                        <option value="">Todos los tipos</option>
                        <option value="reserva_creada">Nueva Reserva</option>
                        <option value="reserva_aprobada">Reserva Aprobada</option>
                        <option value="reserva_rechazada">Reserva Rechazada</option>
                        <option value="usuario_registrado">Usuario Registrado</option>
                        <option value="espacio_creado">Espacio Creado</option>
                        <option value="sesion_iniciada">Sesi√≥n Admin</option>
                        <option value="sistema">Sistema</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">‚ö†Ô∏è Prioridad</label>
                    <select class="filter-select" id="priorityFilter">
                        <option value="">Todas las prioridades</option>
                        <option value="urgente">Urgente</option>
                        <option value="alta">Alta</option>
                        <option value="media">Media</option>
                        <option value="baja">Baja</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">üë§ Usuario</label>
                    <select class="filter-select" id="userFilter">
                        <option value="">Todos los usuarios</option>
                        <!-- Se llenar√° din√°micamente -->
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">üìÖ Per√≠odo</label>
                    <select class="filter-select" id="periodFilter">
                        <option value="today">Hoy</option>
                        <option value="yesterday">Ayer</option>
                        <option value="week">Esta semana</option>
                        <option value="month">Este mes</option>
                        <option value="all">Todo el tiempo</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Notifications Container -->
        <div class="notifications-container">
            <div class="notifications-header">
                <div class="notifications-title">
                    Actividad del Sistema en Tiempo Real
                </div>
                <div class="notification-time" id="lastUpdate">
                    Actualizado: <span id="updateTime">--:--:--</span>
                </div>
            </div>

            <!-- Real-time Indicator -->
            <div class="real-time-indicator" id="realTimeIndicator">
                <div class="pulse-dot"></div>
                <span>Conectado - Actualizando en tiempo real</span>
            </div>

            <!-- Notifications List -->
            <div class="notifications-list" id="notificationsList">
                <div class="empty-state">
                    <div class="empty-state-icon">üîî</div>
                    <div class="empty-state-title">No hay notificaciones</div>
                    <div class="empty-state-text">Las actividades del sistema aparecer√°n aqu√≠</div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Estado global
        let notifications = [];
        let filters = {
            type: '',
            priority: '',
            user: '',
            period: 'today'
        };

        // Elementos DOM
        const notificationsList = document.getElementById('notificationsList');
        const unreadCount = document.getElementById('unreadCount');
        const lastUpdate = document.getElementById('updateTime');
        const realTimeIndicator = document.getElementById('realTimeIndicator');

        // Iconos por tipo de notificaci√≥n
        const typeIcons = {
            'reserva_creada': 'üìã',
            'reserva_aprobada': '‚úÖ',
            'reserva_rechazada': '‚ùå',
            'reserva_cancelada': 'üìù',
            'usuario_registrado': 'üë§',
            'espacio_creado': 'üè¢',
            'espacio_editado': '‚úèÔ∏è',
            'espacio_eliminado': 'üóëÔ∏è',
            'sesion_iniciada': 'üîê',
            'sesion_cerrada': 'üö™',
            'reporte_generado': 'üìä',
            'sistema': '‚öôÔ∏è',
            'incidencia_reportada': 'üö®'
        };

        // Colores por prioridad
        const priorityColors = {
            'urgente': 'priority-urgente',
            'alta': 'priority-alta',
            'media': 'priority-media',
            'baja': 'priority-baja'
        };

        // Formatear tiempo relativo
        function formatRelativeTime(timestamp) {
            const now = new Date();
            const date = new Date(timestamp * 1000);
            const diffMs = now - date;
            const diffSecs = Math.floor(diffMs / 1000);
            const diffMins = Math.floor(diffSecs / 60);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);

            if (diffSecs < 60) {
                return `hace ${diffSecs} segundos`;
            } else if (diffMins < 60) {
                return `hace ${diffMins} minutos`;
            } else if (diffHours < 24) {
                return `hace ${diffHours} horas`;
            } else if (diffDays === 1) {
                return 'ayer';
            } else {
                return `hace ${diffDays} d√≠as`;
            }
        }

        // Cargar notificaciones
        async function loadNotifications() {
            try {
                const response = await fetch('/api/notificaciones-admin/');
                const data = await response.json();

                if (data.success) {
                    notifications = data.notificaciones;
                    renderNotifications();
                    updateUnreadCount();
                    updateLastUpdateTime();
                }
            } catch (error) {
                console.error('Error cargando notificaciones:', error);
            }
        }

        // Renderizar notificaciones
        function renderNotifications() {
            const filteredNotifications = filterNotifications(notifications);
            
            if (filteredNotifications.length === 0) {
                notificationsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <div class="empty-state-title">No hay notificaciones que coincidan</div>
                        <div class="empty-state-text">Intenta con otros filtros</div>
                    </div>
                `;
                return;
            }

            notificationsList.innerHTML = filteredNotifications.map(notif => `
                <div class="notification-item ${notif.leida ? '' : 'unread'} ${priorityColors[notif.prioridad]}" 
                     onclick="markAsRead(${notif.id})">
                    <div class="notification-header">
                        <div class="notification-icon">
                            ${typeIcons[notif.tipo] || 'üì¢'}
                        </div>
                        <div class="notification-title">
                            ${notif.titulo}
                        </div>
                        <div class="notification-time">
                            ${formatRelativeTime(notif.fecha_creacion_timestamp)}
                        </div>
                    </div>
                    <div class="notification-message">
                        ${notif.mensaje}
                    </div>
                    <div class="notification-meta">
                        ${notif.usuario_relacionado ? `
                            <div class="meta-item">
                                üë§ ${notif.usuario_relacionado.nombre_completo || notif.usuario_relacionado.username}
                            </div>
                        ` : ''}
                        ${notif.reserva_info ? `
                            <div class="meta-item">
                                üìÖ ${notif.reserva_info.espacio_nombre} - ${notif.reserva_info.fecha}
                            </div>
                        ` : ''}
                        ${notif.espacio_info ? `
                            <div class="meta-item">
                                üè¢ ${notif.espacio_info.nombre}
                            </div>
                        ` : ''}
                        <div class="meta-item">
                            ‚ö†Ô∏è ${notif.prioridad.toUpperCase()}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Filtrar notificaciones
        function filterNotifications(notifications) {
            return notifications.filter(notif => {
                // Filtro por tipo
                if (filters.type && notif.tipo !== filters.type) {
                    return false;
                }
                
                // Filtro por prioridad
                if (filters.priority && notif.prioridad !== filters.priority) {
                    return false;
                }
                
                // Filtro por usuario
                if (filters.user && (!notif.usuario_relacionado || notif.usuario_relacionado.username !== filters.user)) {
                    return false;
                }
                
                // Filtro por per√≠odo (implementaci√≥n b√°sica)
                // En una implementaci√≥n real, esto ser√≠a m√°s sofisticado
                
                return true;
            });
        }

        // Actualizar contador de no le√≠das
        function updateUnreadCount() {
            const unread = notifications.filter(n => !n.leida).length;
            unreadCount.textContent = unread;
        }

        // Actualizar hora de √∫ltima actualizaci√≥n
        function updateLastUpdateTime() {
            const now = new Date();
            lastUpdate.textContent = now.toLocaleTimeString('es-ES');
        }

        // Marcar como le√≠da
        async function markAsRead(notificationId) {
            try {
                const response = await fetch(`/api/notificaciones-admin/${notificationId}/marcar-leida/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCSRFToken()
                    }
                });

                if (response.ok) {
                    // Actualizar localmente
                    const notif = notifications.find(n => n.id === notificationId);
                    if (notif) {
                        notif.leida = true;
                    }
                    updateUnreadCount();
                }
            } catch (error) {
                console.error('Error marcando como le√≠da:', error);
            }
        }

        // Marcar todas como le√≠das
        async function markAllAsRead() {
            try {
                const response = await fetch('/api/notificaciones-admin/marcar-todas-leidas/', {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCSRFToken()
                    }
                });

                if (response.ok) {
                    notifications.forEach(notif => notif.leida = true);
                    renderNotifications();
                    updateUnreadCount();
                }
            } catch (error) {
                console.error('Error marcando todas como le√≠das:', error);
            }
        }

        // Obtener token CSRF
        function getCSRFToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Event Listeners
        document.getElementById('refreshBtn').addEventListener('click', loadNotifications);
        document.getElementById('markAllRead').addEventListener('click', markAllAsRead);
        
        document.getElementById('clearRead').addEventListener('click', async function() {
            if (confirm('¬øEliminar todas las notificaciones le√≠das?')) {
                // Implementar limpieza de notificaciones le√≠das
                await loadNotifications();
            }
        });

        // Filtros
        document.getElementById('typeFilter').addEventListener('change', function() {
            filters.type = this.value;
            renderNotifications();
        });

        document.getElementById('priorityFilter').addEventListener('change', function() {
            filters.priority = this.value;
            renderNotifications();
        });

        document.getElementById('periodFilter').addEventListener('change', function() {
            filters.period = this.value;
            renderNotifications();
        });

        // Actualizaci√≥n en tiempo real (cada 10 segundos)
        setInterval(loadNotifications, 10000);

        // Carga inicial
        loadNotifications();

        // Simular actividad en tiempo real (para demo)
        setInterval(() => {
            const now = new Date();
            lastUpdate.textContent = now.toLocaleTimeString('es-ES');
        }, 1000);
    </script>
</body>
</html>
============================================================


===== reportes.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #F9FAFB;
            color: #111827;
            line-height: 1.6;
        }
        
        .header {
            background: white;
            border-bottom: 1px solid #E5E7EB;
            padding: 16px 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 20px;
            font-weight: 700;
            color: #111827;
        }
        
        .nav-menu {
            display: flex;
            gap: 32px;
        }
        
        .nav-item {
            color: #6B7280;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .nav-item:hover, .nav-item.active {
            color: #2563EB;
            background: #EFF6FF;
        }
        
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .page-subtitle {
            color: #6B7280;
            margin-bottom: 32px;
        }
        
        .filters-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-label {
            font-weight: 500;
            color: #374151;
        }
        
        .filter-select, .filter-input {
            padding: 10px 12px;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .btn-generate {
            background: #10B981;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            align-self: end;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #6B7280;
            font-size: 14px;
        }
        
        .reports-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .report-card {
            border: 1px solid #E5E7EB;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.2s;
        }
        
        .report-card:hover {
            border-color: #3B82F6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
        }
        
        .report-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }
        
        .report-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .report-description {
            color: #6B7280;
            font-size: 14px;
            margin-bottom: 16px;
        }
        
        .btn-download {
            background: #3B82F6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">üè¢ Panel Administrativo</div>
            <nav class="nav-menu">
                <a href="{% url 'admin_dashboard' %}" class="nav-item">Dashboard</a>
                <a href="{% url 'solicitudes_pendientes' %}" class="nav-item">Solicitudes</a>
                <a href="{% url 'gestion_espacios' %}" class="nav-item">Espacios</a>
                <a href="{% url 'gestion_usuarios' %}" class="nav-item">Usuarios</a>
                <a href="{% url 'reportes' %}" class="nav-item active">Reportes</a>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="page-title">üìä Reportes del Sistema</div>
        <div class="page-subtitle">Genera reportes y estad√≠sticas del sistema de reservas</div>

        <!-- Filtros -->
        <div class="filters-section">
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">Tipo de Reporte</label>
                    <select class="filter-select" id="reportType">
                        <option value="uso_espacios">Uso de Espacios</option>
                        <option value="reservas_usuario">Reservas por Usuario</option>
                        <option value="estadisticas_generales">Estad√≠sticas Generales</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Fecha Inicio</label>
                    <input type="date" class="filter-input" id="startDate">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">Fecha Fin</label>
                    <input type="date" class="filter-input" id="endDate">
                </div>
                
                <div class="filter-group">
                    <label class="filter-label">&nbsp;</label>
                    <button class="btn-generate" onclick="generarReporte()">Generar Reporte</button>
                </div>
            </div>
        </div>

        <!-- Estad√≠sticas R√°pidas -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ total_reservas }}</div>
                <div class="stat-label">Total Reservas</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-value">{{ usuarios_activos }}</div>
                <div class="stat-label">Usuarios Activos</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-value">{{ total_espacios }}</div>
                <div class="stat-label">Espacios</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-value">{{ tasa_aprobacion }}%</div>
                <div class="stat-label">Tasa de Aprobaci√≥n</div>
            </div>
        </div>

        <!-- Reportes Disponibles -->
        <div class="reports-section">
            <h3 style="margin-bottom: 20px; color: #111827;">Reportes Disponibles</h3>
            
            <div class="reports-grid">
                <div class="report-card">
                    <div class="report-icon">üìà</div>
                    <div class="report-title">Reporte de Uso de Espacios</div>
                    <div class="report-description">
                        An√°lisis detallado del uso y ocupaci√≥n de cada espacio durante el per√≠odo seleccionado.
                    </div>
                    <button class="btn-download" onclick="descargarReporte('uso_espacios')">
                        Descargar PDF
                    </button>
                </div>
                
                <div class="report-card">
                    <div class="report-icon">üë•</div>
                    <div class="report-title">Reporte de Usuarios</div>
                    <div class="report-description">
                        Estad√≠sticas de actividad de usuarios, frecuencia de reservas y patrones de uso.
                    </div>
                    <button class="btn-download" onclick="descargarReporte('usuarios')">
                        Descargar PDF
                    </button>
                </div>
                
                <div class="report-card">
                    <div class="report-icon">üìÖ</div>
                    <div class="report-title">Reporte Mensual</div>
                    <div class="report-description">
                        Resumen mensual de todas las actividades del sistema de reservas.
                    </div>
                    <button class="btn-download" onclick="descargarReporte('mensual')">
                        Descargar PDF
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        function generarReporte() {
            const reportType = document.getElementById('reportType').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            alert(`Generando reporte: ${reportType}\nDesde: ${startDate}\nHasta: ${endDate}`);
        }
        
        function descargarReporte(tipo) {
            alert(`Descargando reporte: ${tipo}`);
        }
        
        // Establecer fechas por defecto
        document.getElementById('startDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('endDate').value = new Date().toISOString().split('T')[0];
    </script>
</body>
</html>
============================================================


===== reservas.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial de Reservas - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f9fafb;
            color: #111827;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: #2563eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .logo-text {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
        }

        .nav-menu {
            display: flex;
            gap: 32px;
        }

        .nav-item {
            color: #6b7280;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .nav-item:hover, .nav-item.active {
            background: #2563eb;
            color: white;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: background 0.3s ease;
            position: relative;
        }

        .user-menu:hover {
            background: #f3f4f6;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .user-name {
            font-weight: 500;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            min-width: 200px;
            display: none;
            z-index: 1000;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            text-decoration: none;
            color: #374151;
            transition: background 0.3s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
        }

        .dropdown-item:hover {
            background: #f9fafb;
        }

        .dropdown-item.logout {
            color: #dc2626;
            border-top: 1px solid #e5e7eb;
        }

        /* Main Content */
        .main-content {
            padding: 24px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: #6b7280;
            font-size: 16px;
        }

        /* Filters */
        .filters-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .filter-select, .filter-input {
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: border-color 0.3s ease;
        }

        .filter-select:focus, .filter-input:focus {
            outline: none;
            border-color: #2563eb;
        }

        .status-tabs {
            display: flex;
            background: #f3f4f6;
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 16px;
        }

        .status-tab {
            flex: 1;
            padding: 8px 16px;
            border: none;
            background: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .status-tab.active {
            background: white;
            color: #2563eb;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* Reservations List */
        .reservations-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .reservation-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 4px solid;
        }

        .reservation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .reservation-card.approved {
            border-left-color: #10b981;
        }

        .reservation-card.pending {
            border-left-color: #f59e0b;
        }

        .reservation-card.rejected {
            border-left-color: #dc2626;
        }

        .reservation-card.cancelled {
            border-left-color: #6b7280;
        }

        .reservation-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .reservation-info {
            flex: 1;
        }

        .reservation-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
        }

        .reservation-datetime {
            font-size: 16px;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .reservation-user {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #374151;
            font-size: 14px;
        }

        .reservation-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.approved {
            background: #d1fae5;
            color: #065f46;
        }

        .status-badge.pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-badge.rejected {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-badge.cancelled {
            background: #f3f4f6;
            color: #6b7280;
        }

        .reservation-id {
            font-size: 12px;
            color: #9ca3af;
        }

        .reservation-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-icon {
            color: #6b7280;
            font-size: 16px;
        }

        .detail-label {
            font-weight: 500;
            color: #374151;
            font-size: 14px;
        }

        .detail-value {
            color: #6b7280;
            font-size: 14px;
        }

        .reservation-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        .action-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }

        .action-btn:hover {
            border-color: #2563eb;
            color: #2563eb;
        }

        .action-btn.primary {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        .action-btn.primary:hover {
            background: #1d4ed8;
        }

        .action-btn.danger {
            background: #dc2626;
            color: white;
            border-color: #dc2626;
        }

        .action-btn.danger:hover {
            background: #b91c1c;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .action-btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 20px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }

        .empty-state-text {
            color: #6b7280;
            margin-bottom: 24px;
        }

        .empty-state-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: #2563eb;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .empty-state-btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 0 16px;
            }

            .nav-menu {
                display: none;
            }

            .main-content {
                padding: 16px;
            }

            .reservation-header {
                flex-direction: column;
                gap: 12px;
            }

            .reservation-meta {
                align-items: flex-start;
            }

            .reservation-details {
                grid-template-columns: 1fr;
            }

            .reservation-actions {
                justify-content: flex-start;
                flex-wrap: wrap;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo">SR</div>
            <div class="logo-text">Sistema de Reservas</div>
        </div>
        
        <nav class="nav-menu">
            <a href="{% url 'dashboard' %}" class="nav-item">Dashboard</a>
            <a href="{% url 'crear_reserva' %}" class="nav-item">Reservar</a>
            <a href="{% url 'reservas' %}" class="nav-item active">Historial</a>
            <a href="{% url 'calendario' %}" class="nav-item">Calendario</a>
            <a href="{% url 'espacios' %}" class="nav-item">Espacios</a>
            <a href="{% url 'notificaciones' %}" class="nav-item">Notificaciones</a>
        </nav>
        <div class="user-menu">

</div>

        <div class="user-menu" id="userMenu">
            <div class="user-avatar">
                {% if user.first_name and user.last_name %}
                    {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                {% else %}
                    {{ user.username|first|upper }}
                {% endif %}
            </div>
            <span class="user-name">
                {% if user.first_name and user.last_name %}
                    {{ user.first_name }} {{ user.last_name }}
                {% else %}
                    {{ user.username }}
                {% endif %}
            </span>
            
            <!-- Dropdown Menu -->
            <div class="dropdown-menu" id="dropdownMenu">
                <div class="dropdown-item">
                    <span>üë§</span>
                    Mi Perfil
                </div>
                <div class="dropdown-item">
                    <span>‚öôÔ∏è</span>
                    Configuraci√≥n
                </div>
                <a href="{% url 'logout' %}" class="dropdown-item logout">
                    <span>üö™</span>
                    Cerrar Sesi√≥n
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-header">
            <h1 class="page-title">üìã Historial de Reservas</h1>
            <p class="page-subtitle">
                Gestiona y revisa todas tus solicitudes de reserva
            </p>
        </div>

        <!-- Filters -->
        <div class="filters-section">
            <div class="status-tabs">
                <button class="status-tab active" data-status="all">Todas</button>
                <button class="status-tab" data-status="approved">Aprobadas</button>
                <button class="status-tab" data-status="pending">Pendientes</button>
                <button class="status-tab" data-status="rejected">Rechazadas</button>
                <button class="status-tab" data-status="cancelled">Canceladas</button>
            </div>

            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">üìÖ Fecha desde</label>
                    <input type="date" class="filter-input" id="dateFrom">
                </div>

                <div class="filter-group">
                    <label class="filter-label">üìÖ Fecha hasta</label>
                    <input type="date" class="filter-input" id="dateTo">
                </div>

                <div class="filter-group">
                    <label class="filter-label">üè¢ Espacio</label>
                    <select class="filter-select" id="spaceFilter">
                        <option value="">Todos los espacios</option>
                        {% for reserva in reservas %}
                            {% ifchanged reserva.espacio.nombre %}
                                <option value="{{ reserva.espacio.id }}">{{ reserva.espacio.nombre }}</option>
                            {% endifchanged %}
                        {% endfor %}
                    </select>
                </div>

                <div class="filter-group">
                    <label class="filter-label">üîç Buscar</label>
                    <input type="text" class="filter-input" id="searchInput" placeholder="Buscar por ID o prop√≥sito...">
                </div>
            </div>
        </div>

        <!-- Reservations List -->
        <div class="reservations-list" id="reservationsList">
            {% for reserva in reservas %}
            <div class="reservation-card {{ reserva.estado|lower }}" 
                 data-status="{{ reserva.estado|lower }}" 
                 data-space="{{ reserva.espacio.id }}"
                 data-date="{{ reserva.fecha_reserva|date:'Y-m-d' }}"
                 data-id="{{ reserva.id }}"
                 data-purpose="{{ reserva.proposito|lower }}">
                <div class="reservation-header">
                    <div class="reservation-info">
                        <div class="reservation-title">{{ reserva.espacio.nombre }}</div>
                        <div class="reservation-datetime">
                            üìÖ {{ reserva.fecha_reserva|date:"l, d M Y" }} ‚Ä¢ ‚è∞ {{ reserva.hora_inicio|time:"H:i" }} - {{ reserva.hora_fin|time:"H:i" }}
                        </div>
                        <div class="reservation-user">
                            <span>üë§ Solicitante: T√∫</span>
                        </div>
                    </div>
                    <div class="reservation-meta">
                        <span class="status-badge {{ reserva.estado|lower }}">
                            {{ reserva.estado }}
                        </span>
                        <span class="reservation-id">#{{ reserva.id }}</span>
                    </div>
                </div>

                <div class="reservation-details">
                    <div class="detail-item">
                        <span class="detail-icon">üë•</span>
                        <span class="detail-label">Asistentes:</span>
                        <span class="detail-value">{{ reserva.num_asistentes }} personas</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-icon">‚è±Ô∏è</span>
                        <span class="detail-label">Duraci√≥n:</span>
                        <span class="detail-value">
                            {% with inicio=reserva.hora_inicio fin=reserva.hora_fin %}
                                {{ fin.hour|add:fin.minute|divisibleby:60 }} horas
                            {% endwith %}
                        </span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-icon">üìù</span>
                        <span class="detail-label">Solicitado:</span>
                        <span class="detail-value">{{ reserva.fecha_solicitud|date:"d M, H:i" }}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-icon">üéØ</span>
                        <span class="detail-label">Prop√≥sito:</span>
                        <span class="detail-value">{{ reserva.proposito }}</span>
                    </div>
                </div>

                <div class="reservation-actions">
                    <button class="action-btn" onclick="verDetalles({{ reserva.id }})">
                        <span>üëÅÔ∏è</span>
                        Ver Detalles
                    </button>
                    {% if reserva.estado == 'Pendiente' or reserva.estado == 'Aprobada' %}
                    <button class="action-btn danger" onclick="cancelarReserva({{ reserva.id }})">
                        <span>‚ùå</span>
                        Cancelar
                    </button>
                    {% endif %}
                    {% if reserva.estado == 'Aprobada' %}
                    <button class="action-btn primary">
                        <span>üìÖ</span>
                        Agregar al Calendario
                    </button>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <div class="empty-state-icon">üìã</div>
                <h2 class="empty-state-title">No hay reservas encontradas</h2>
                <p class="empty-state-text">
                    A√∫n no has realizado ninguna reserva.
                </p>
                <a href="{% url 'crear_reserva' %}" class="empty-state-btn">
                    <span>‚ûï</span>
                    Crear Nueva Reserva
                </a>
            </div>
            {% endfor %}
        </div>
    </main>

    <script>
        // User menu dropdown functionality
        const userMenu = document.getElementById('userMenu');
        const dropdownMenu = document.getElementById('dropdownMenu');

        if (userMenu && dropdownMenu) {
            userMenu.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdownMenu.classList.toggle('show');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                dropdownMenu.classList.remove('show');
            });
        }

        // Funciones para manejar reservas
        function verDetalles(reservaId) {
            window.location.href = `/detalle-reserva/?id=${reservaId}`;
        }

        function cancelarReserva(reservaId) {
            if (confirm('¬øEst√°s seguro de que deseas cancelar esta reserva?')) {
                fetch(`/api/reservas/${reservaId}/cancelar/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCSRFToken(),
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Reserva cancelada exitosamente');
                        location.reload();
                    } else {
                        alert('Error al cancelar la reserva: ' + data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al cancelar la reserva');
                });
            }
        }

        function getCSRFToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Sistema de filtrado mejorado
        let currentFilters = {
            status: 'all',
            dateFrom: '',
            dateTo: '',
            space: '',
            search: ''
        };

        // Filtros por estado
        document.querySelectorAll('.status-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const status = this.dataset.status;
                currentFilters.status = status;
                
                // Update active tab
                document.querySelectorAll('.status-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                applyFilters();
            });
        });

        // Filtro por fecha desde
        document.getElementById('dateFrom').addEventListener('change', function() {
            currentFilters.dateFrom = this.value;
            applyFilters();
        });

        // Filtro por fecha hasta
        document.getElementById('dateTo').addEventListener('change', function() {
            currentFilters.dateTo = this.value;
            applyFilters();
        });

        // Filtro por espacio
        document.getElementById('spaceFilter').addEventListener('change', function() {
            currentFilters.space = this.value;
            applyFilters();
        });

        // Filtro de b√∫squeda
        document.getElementById('searchInput').addEventListener('input', function(e) {
            currentFilters.search = e.target.value.toLowerCase();
            applyFilters();
        });

        // Funci√≥n principal de filtrado
        function applyFilters() {
            const cards = document.querySelectorAll('.reservation-card');
            let visibleCount = 0;
            
            cards.forEach(card => {
                const cardStatus = card.dataset.status;
                const cardSpace = card.dataset.space;
                const cardDate = card.dataset.date;
                const cardId = card.dataset.id;
                const cardPurpose = card.dataset.purpose;
                
                let show = true;
                
                // Filtro por estado
                if (currentFilters.status !== 'all' && cardStatus !== currentFilters.status) {
                    show = false;
                }
                
                // Filtro por espacio
                if (currentFilters.space && cardSpace !== currentFilters.space) {
                    show = false;
                }
                
                // Filtro por fecha desde
                if (currentFilters.dateFrom && cardDate < currentFilters.dateFrom) {
                    show = false;
                }
                
                // Filtro por fecha hasta
                if (currentFilters.dateTo && cardDate > currentFilters.dateTo) {
                    show = false;
                }
                
                // Filtro de b√∫squeda
                if (currentFilters.search) {
                    const searchTerm = currentFilters.search;
                    const matchesId = cardId.includes(searchTerm);
                    const matchesPurpose = cardPurpose.includes(searchTerm);
                    
                    if (!matchesId && !matchesPurpose) {
                        show = false;
                    }
                }
                
                if (show) {
                    card.style.display = 'block';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });
            
            updateEmptyState(visibleCount);
        }

        // Actualizar estado vac√≠o
        function updateEmptyState(visibleCount) {
            const emptyState = document.querySelector('.empty-state');
            const reservationsList = document.getElementById('reservationsList');
            const existingCards = document.querySelectorAll('.reservation-card').length;
            
            if (visibleCount === 0 && existingCards > 0) {
                // Crear estado vac√≠o si hay reservas pero ninguna coincide con los filtros
                if (!emptyState || !emptyState.classList.contains('filter-empty-state')) {
                    const emptyHtml = `
                        <div class="empty-state filter-empty-state">
                            <div class="empty-state-icon">üîç</div>
                            <h2 class="empty-state-title">No hay reservas encontradas</h2>
                            <p class="empty-state-text">
                                No se encontraron reservas que coincidan con los filtros seleccionados.
                            </p>
                            <button class="empty-state-btn" onclick="resetFilters()">
                                <span>üîÑ</span>
                                Restablecer Filtros
                            </button>
                        </div>
                    `;
                    
                    // Remover estado vac√≠o anterior si existe
                    if (emptyState) {
                        emptyState.remove();
                    }
                    
                    reservationsList.insertAdjacentHTML('beforeend', emptyHtml);
                }
            } else if (emptyState && emptyState.classList.contains('filter-empty-state') && visibleCount > 0) {
                // Remover estado vac√≠o de filtros si ahora hay reservas visibles
                emptyState.remove();
            }
        }

        // Restablecer filtros
        function resetFilters() {
            // Restablecer valores de los filtros
            document.querySelectorAll('.status-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector('.status-tab[data-status="all"]').classList.add('active');
            
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            document.getElementById('spaceFilter').value = '';
            document.getElementById('searchInput').value = '';
            
            // Restablecer filtros actuales
            currentFilters = {
                status: 'all',
                dateFrom: '',
                dateTo: '',
                space: '',
                search: ''
            };
            
            // Aplicar filtros (mostrar todo)
            applyFilters();
        }

        // Inicializar filtros al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            applyFilters();
        });

        // Formatear fechas para inputs date (compatibilidad)
        function formatDateForInput(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toISOString().split('T')[0];
        }

        // Establecer fecha m√°xima como hoy para filtro de fecha hasta
        document.getElementById('dateTo').max = new Date().toISOString().split('T')[0];
    </script>
</body>
</html>
============================================================


===== reserva_exitosa.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirmaci√≥n - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 50%, #f9fafb 100%);
            color: #111827;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 0 24px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: #2563eb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .main-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 24px;
        }

        .confirmation-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 48px 40px;
            max-width: 600px;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .confirmation-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .success-animation {
            width: 120px;
            height: 120px;
            margin: 0 auto 32px;
            position: relative;
            animation: successPulse 2s ease-in-out infinite;
        }

        .success-icon {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
        }

        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .success-rings {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
        }

        .success-ring {
            position: absolute;
            border: 2px solid #10b981;
            border-radius: 50%;
            opacity: 0;
            animation: ringExpand 2s ease-out infinite;
        }

        .success-ring:nth-child(1) {
            animation-delay: 0s;
        }

        .success-ring:nth-child(2) {
            animation-delay: 0.5s;
        }

        .success-ring:nth-child(3) {
            animation-delay: 1s;
        }

        @keyframes ringExpand {
            0% {
                width: 120px;
                height: 120px;
                opacity: 1;
            }
            100% {
                width: 200px;
                height: 200px;
                opacity: 0;
            }
        }

        .success-title {
            font-size: 32px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 16px;
        }

        .success-message {
            font-size: 18px;
            color: #6b7280;
            margin-bottom: 40px;
            line-height: 1.5;
        }

        .reservation-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            text-align: left;
        }

        .reservation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .reservation-number {
            background: #2563eb;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .reservation-status {
            display: flex;
            align-items: center;
            gap: 6px;
            background: #fef3c7;
            color: #92400e;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .reservation-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            border: 1px solid #e5e7eb;
        }

        .detail-content {
            flex: 1;
        }

        .detail-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 16px;
            color: #111827;
            font-weight: 500;
        }

        .info-section {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 32px;
            text-align: left;
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .info-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e40af;
        }

        .info-content {
            color: #1e40af;
            font-size: 14px;
            line-height: 1.5;
        }

        .info-list {
            margin: 12px 0 0 0;
            padding-left: 20px;
        }

        .info-list li {
            margin-bottom: 6px;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .action-btn {
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .action-btn.primary {
            background: #10b981;
            color: white;
        }

        .action-btn.primary:hover {
            background: #059669;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .action-btn.secondary {
            background: #2563eb;
            color: white;
        }

        .action-btn.secondary:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .action-btn.link {
            background: none;
            color: #6b7280;
            border: 1px solid #e5e7eb;
        }

        .action-btn.link:hover {
            background: #f9fafb;
            color: #374151;
        }

        .additional-info {
            background: #f0f9ff;
            border-left: 4px solid #0ea5e9;
            padding: 16px 20px;
            margin-top: 24px;
            border-radius: 0 8px 8px 0;
            text-align: left;
        }

        .additional-info-title {
            font-size: 14px;
            font-weight: 600;
            color: #0c4a6e;
            margin-bottom: 8px;
        }

        .additional-info-text {
            font-size: 14px;
            color: #0c4a6e;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px 16px;
            }

            .confirmation-container {
                padding: 32px 24px;
            }

            .success-title {
                font-size: 28px;
            }

            .success-message {
                font-size: 16px;
            }

            .reservation-details {
                grid-template-columns: 1fr;
            }

            .reservation-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .action-buttons {
                margin-top: 24px;
            }
        }

        @media (max-width: 480px) {
            .success-animation {
                width: 100px;
                height: 100px;
            }

            .success-icon {
                width: 100px;
                height: 100px;
                font-size: 40px;
            }

            .success-rings {
                width: 100px;
                height: 100px;
            }

            .success-title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo">SR</div>
        </div>
        
        <div class="user-menu">
            <div class="user-avatar">
                {% if user.first_name and user.last_name %}
                    {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                {% else %}
                    {{ user.username|first|upper }}
                {% endif %}
            </div>
            <span>
                {% if user.first_name %}
                    {{ user.first_name }} {{ user.last_name }}
                {% else %}
                    {{ user.username }}
                {% endif %}
            </span>
            <a href="{% url 'logout' %}" style="margin-left: 10px; color: #666; text-decoration: none;">üö™</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="confirmation-container">
            <!-- Success Animation -->
            <div class="success-animation">
                <div class="success-icon">‚úì</div>
                <div class="success-rings">
                    <div class="success-ring"></div>
                    <div class="success-ring"></div>
                    <div class="success-ring"></div>
                </div>
            </div>

            <!-- Success Message -->
            <h1 class="success-title">
                {% if reserva %}
                    ¬°Reserva Enviada con √âxito!
                {% else %}
                    ¬°Reserva Procesada!
                {% endif %}
            </h1>
            <p class="success-message">
                {% if reserva %}
                    Tu solicitud de reserva ha sido enviada correctamente y est√° pendiente de aprobaci√≥n.
                    Te notificaremos por correo electr√≥nico cuando sea procesada.
                {% else %}
                    Tu reserva ha sido procesada exitosamente.
                {% endif %}
            </p>

            <!-- Reservation Details Card -->
            {% if reserva %}
            <div class="reservation-card">
                <div class="reservation-header">
                    <div class="reservation-number">
                        #SR-{{ reserva.id|stringformat:"04d" }}
                    </div>
                    <div class="reservation-status">
                        {% if reserva.estado == 'Pendiente' %}
                            ‚è≥ Pendiente de Aprobaci√≥n
                        {% elif reserva.estado == 'Aprobada' %}
                            ‚úÖ Aprobada
                        {% elif reserva.estado == 'Rechazada' %}
                            ‚ùå Rechazada
                        {% else %}
                            üìã {{ reserva.estado }}
                        {% endif %}
                    </div>
                </div>

                <div class="reservation-details">
                    <div class="detail-item">
                        <div class="detail-icon">üèõÔ∏è</div>
                        <div class="detail-content">
                            <div class="detail-label">Espacio</div>
                            <div class="detail-value">{{ reserva.espacio.nombre }}</div>
                        </div>
                    </div>

                    <div class="detail-item">
                        <div class="detail-icon">üìÖ</div>
                        <div class="detail-content">
                            <div class="detail-label">Fecha</div>
                            <div class="detail-value">{{ reserva.fecha_reserva|date:"l, d F Y" }}</div>
                        </div>
                    </div>

                    <div class="detail-item">
                        <div class="detail-icon">‚è∞</div>
                        <div class="detail-content">
                            <div class="detail-label">Horario</div>
                            <div class="detail-value">{{ reserva.hora_inicio|time:"H:i" }} - {{ reserva.hora_fin|time:"H:i" }}</div>
                        </div>
                    </div>

                   <div class="detail-item">
                        <div class="detail-icon">‚è±Ô∏è</div>
                        <div class="detail-content">
                            <div class="detail-label">Duraci√≥n</div>
                            <div class="detail-value">
                                {% if reserva.hora_inicio and reserva.hora_fin %}
                                    {{ reserva.hora_inicio|time:"H:i" }} - {{ reserva.hora_fin|time:"H:i" }}
                                {% else %}
                                    No especificado
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="detail-item">
                        <div class="detail-icon">üë•</div>
                        <div class="detail-content">
                            <div class="detail-label">Asistentes</div>
                            <div class="detail-value">{{ reserva.num_asistentes }} personas</div>
                        </div>
                    </div>

                    <div class="detail-item">
                        <div class="detail-icon">üìù</div>
                        <div class="detail-content">
                            <div class="detail-label">Prop√≥sito</div>
                            <div class="detail-value">{{ reserva.proposito }}</div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Information Section -->
            <div class="info-section">
                <div class="info-header">
                    <span>‚ÑπÔ∏è</span>
                    <h3 class="info-title">Informaci√≥n Importante</h3>
                </div>
                <div class="info-content">
                    <strong>Tiempo estimado de respuesta:</strong> 24-48 horas laborables
                    <ul class="info-list">
                        <li>Recibir√°s una notificaci√≥n por correo electr√≥nico cuando tu solicitud sea revisada</li>
                        <li>Puedes consultar el estado de tu reserva en cualquier momento desde tu historial</li>
                        <li>Si tu solicitud es rechazada, recibir√°s informaci√≥n sobre motivos y alternativas</li>
                    </ul>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <a href="{% url 'reservas' %}" class="action-btn primary">
                    <span>üìã</span>
                    Ver en Historial
                </a>
                <a href="{% url 'crear_reserva' %}" class="action-btn secondary">
                    <span>‚ûï</span>
                    Nueva Reserva
                </a>
                <a href="{% url 'dashboard' %}" class="action-btn link">
                    <span>üè†</span>
                    Volver al Dashboard
                </a>
            </div>

            <!-- Additional Info -->
            <div class="additional-info">
                <h4 class="additional-info-title">üìß Confirmaci√≥n por Email</h4>
                <p class="additional-info-text">
                    Se ha enviado una copia de esta solicitud a tu correo electr√≥nico 
                    <strong>{{ user.email }}</strong> para tus registros.
                </p>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const successIcon = document.querySelector('.success-icon');
                successIcon.style.animation = 'successPulse 2s ease-in-out infinite';
            }, 500);

            const buttons = document.querySelectorAll('.action-btn');
            buttons.forEach(button => {
                button.addEventListener('click', function(e) {
                    this.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 150);
                });
            });

            const reservationNumber = document.querySelector('.reservation-number');
            if (reservationNumber) {
                reservationNumber.addEventListener('click', function() {
                    const text = this.textContent.trim();
                    navigator.clipboard.writeText(text).then(() => {
                        const originalText = this.textContent;
                        this.textContent = '‚úì Copiado!';
                        this.style.background = '#10b981';
                        
                        setTimeout(() => {
                            this.textContent = originalText;
                            this.style.background = '#2563eb';
                        }, 2000);
                    }).catch(() => {
                        console.log('No se pudo copiar al portapapeles');
                    });
                });
            }

            const reservationCard = document.querySelector('.reservation-card');
            if (reservationCard) {
                reservationCard.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.02)';
                    this.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';
                });

                reservationCard.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = '';
                });
            }
        });
    </script>
</body>
</html>
============================================================


===== revisar_solicitud.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revisar Solicitud</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #F9FAFB;
            color: #111827;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }
        
        /* Header */
        .page-header {
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-left h1 {
            font-size: 32px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 8px;
        }
        
        .breadcrumb {
            color: #6B7280;
            font-size: 14px;
        }
        
        .breadcrumb a {
            color: #2563EB;
            text-decoration: none;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .btn-secondary { background: #6B7280; color: white; }
        .btn-primary { background: #2563EB; color: white; }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 32px;
        }
        
        /* Left Panel - Request Details */
        .request-panel {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .card-header {
            padding: 20px;
            border-bottom: 1px solid #E5E7EB;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
        }
        
        .card-content {
            padding: 24px;
        }
        
        /* User Info Card */
        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: 600;
        }
        
        .user-details h3 {
            font-size: 20px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
        }
        
        .user-details p {
            color: #6B7280;
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .user-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 20px;
        }
        
        .stat-item {
            text-align: center;
            padding: 12px;
            background: #F9FAFB;
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #111827;
        }
        
        .stat-label {
            font-size: 12px;
            color: #6B7280;
            margin-top: 4px;
        }
        
        /* Request Details */
        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .detail-section h4 {
            font-size: 16px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 8px 0;
        }
        
        .detail-icon {
            width: 20px;
            height: 20px;
            color: #6B7280;
        }
        
        .detail-label {
            font-weight: 600;
            color: #374151;
            min-width: 100px;
        }
        
        .detail-value {
            color: #111827;
        }
        
        .space-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 200px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
            margin-bottom: 16px;
        }
        
        .space-name {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .space-description {
            color: #6B7280;
            margin-bottom: 16px;
        }
        
        .equipment-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .equipment-tag {
            background: #EFF6FF;
            color: #2563EB;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .purpose-text {
            background: #F9FAFB;
            padding: 16px;
            border-radius: 8px;
            color: #374151;
            line-height: 1.6;
            border-left: 4px solid #2563EB;
        }
        
        /* Right Panel - Decision Tools */
        .decision-panel {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        /* Calendar */
        .mini-calendar {
            background: #F9FAFB;
            border-radius: 8px;
            padding: 16px;
        }
        
        .calendar-header {
            text-align: center;
            font-weight: 600;
            margin-bottom: 16px;
            color: #374151;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            text-align: center;
            font-size: 12px;
        }
        
        .calendar-day {
            padding: 8px 4px;
            border-radius: 4px;
        }
        
        .calendar-day.header {
            font-weight: 600;
            color: #6B7280;
        }
        
        .calendar-day.available {
            background: #D1FAE5;
            color: #065F46;
        }
        
        .calendar-day.occupied {
            background: #FEE2E2;
            color: #991B1B;
        }
        
        .calendar-day.partial {
            background: #FEF3C7;
            color: #92400E;
        }
        
        .calendar-day.today {
            background: #2563EB;
            color: white;
            font-weight: 600;
        }
        
        .calendar-legend {
            margin-top: 12px;
            font-size: 11px;
            color: #6B7280;
            display: flex;
            justify-content: space-between;
        }
        
        /* Conflicts */
        .conflict-alert {
            background: #FEF3C7;
            border: 1px solid #F59E0B;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .alert-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #92400E;
            margin-bottom: 8px;
        }
        
        .conflict-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 4px solid #F59E0B;
        }
        
        .conflict-time {
            font-size: 12px;
            color: #78350F;
        }
        
        .conflict-title {
            font-weight: 500;
            color: #92400E;
        }
        
        /* Existing Reservations */
        .reservation-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #F3F4F6;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .reservation-time {
            font-size: 12px;
            color: #6B7280;
        }
        
        .reservation-title {
            font-weight: 500;
            color: #374151;
        }
        
        .status-badge {
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-confirmed {
            background: #D1FAE5;
            color: #065F46;
        }
        
        /* Verification Tools */
        .verification-tools {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .verify-btn {
            background: #EFF6FF;
            border: 1px solid #2563EB;
            color: #2563EB;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            text-align: center;
            transition: all 0.2s;
        }
        
        .verify-btn:hover {
            background: #2563EB;
            color: white;
        }
        
        /* Decision Form */
        .decision-form {
            background: #F8FAFC;
            border: 2px solid #E2E8F0;
            border-radius: 12px;
            padding: 24px;
        }
        
        .decision-options {
            margin-bottom: 20px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .radio-option:hover {
            border-color: #D1D5DB;
        }
        
        .radio-option.selected {
            border-color: #2563EB;
            background: #EFF6FF;
        }
        
        .radio-option input[type="radio"] {
            width: 16px;
            height: 16px;
        }
        
        .option-info {
            flex: 1;
        }
        
        .option-title {
            font-weight: 600;
            color: #374151;
        }
        
        .option-description {
            font-size: 12px;
            color: #6B7280;
        }
        
        .option-icon {
            font-size: 20px;
        }
        
        .approve { color: #10B981; }
        .approve-conditional { color: #F59E0B; }
        .reject { color: #DC2626; }
        .request-info { color: #2563EB; }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }
        
        .required {
            color: #DC2626;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #E5E7EB;
            border-radius: 8px;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.2s;
            resize: vertical;
            min-height: 80px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #2563EB;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .checkbox-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
        }
        
        .btn-success { background: #10B981; color: white; }
        .btn-outline { background: white; color: #6B7280; border: 2px solid #E5E7EB; }
        
        .btn-outline:hover { background: #F9FAFB; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="page-header">
            <div class="header-left">
                <h1>üìã Revisar Solicitud</h1>
                <div class="breadcrumb">
                    <a href="#">Solicitudes</a> > <a href="#">Pendientes</a> > Revisar #REQ-2025-0234
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary">‚¨ÖÔ∏è Volver a la Lista</button>
                <button class="btn btn-primary">üìß Contactar Usuario</button>
            </div>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Left Panel - Request Details -->
            <div class="request-panel">
                <!-- User Information -->
                <div class="card">
                    <div class="card-header">
                        <span>üë§</span>
                        <h3 class="card-title">Informaci√≥n del Solicitante</h3>
                    </div>
                    <div class="card-content">
                        <div class="user-info">
                            <div class="user-avatar">MR</div>
                            <div class="user-details">
                                <h3>Mar√≠a Rodr√≠guez</h3>
                                <p>üìß maria.rodriguez@empresa.com</p>
                                <p>üìû +56 9 8765 4321</p>
                                <p>üè¢ Tecnolog√≠a - Desarrollo</p>
                                <p>üÜî ID: USR-001</p>
                            </div>
                        </div>
                        
                        <div class="user-stats">
                            <div class="stat-item">
                                <div class="stat-value">45</div>
                                <div class="stat-label">Total Reservas</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">95%</div>
                                <div class="stat-label">Tasa Aprobaci√≥n</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">2</div>
                                <div class="stat-label">Este Mes</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Request Details -->
                <div class="card">
                    <div class="card-header">
                        <span>üìã</span>
                        <h3 class="card-title">Detalles de la Reserva</h3>
                    </div>
                    <div class="card-content">
                        <div class="space-preview">üè¢</div>
                        <div class="space-name">Sala de Conferencias A1</div>
                        <div class="space-description">
                            Sala equipada con proyector 4K, sistema de audio profesional y capacidad para videoconferencias. 
                            Ubicada en Edificio Principal, Piso 2.
                        </div>
                        
                        <div class="equipment-tags">
                            <div class="equipment-tag">üì∫ Proyector 4K</div>
                            <div class="equipment-tag">üé§ Sistema Audio</div>
                            <div class="equipment-tag">üì∂ WiFi</div>
                            <div class="equipment-tag">‚ùÑÔ∏è Aire Acondicionado</div>
                            <div class="equipment-tag">üìπ Videoconferencia</div>
                        </div>
                        
                        <div class="detail-grid">
                            <div class="detail-section">
                                <h4>‚è∞ Informaci√≥n Temporal</h4>
                                <div class="detail-item">
                                    <span class="detail-icon">üìÖ</span>
                                    <span class="detail-label">Fecha:</span>
                                    <span class="detail-value">Viernes, 22 Mar 2025</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-icon">üïê</span>
                                    <span class="detail-label">Hora:</span>
                                    <span class="detail-value">14:00 - 16:00</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-icon">‚è±Ô∏è</span>
                                    <span class="detail-label">Duraci√≥n:</span>
                                    <span class="detail-value">2 horas</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-icon">üìù</span>
                                    <span class="detail-label">Solicitado:</span>
                                    <span class="detail-value">15 Mar, 12:30</span>
                                </div>
                            </div>
                            
                            <div class="detail-section">
                                <h4>üë• Detalles Adicionales</h4>
                                <div class="detail-item">
                                    <span class="detail-icon">üë•</span>
                                    <span class="detail-label">Asistentes:</span>
                                    <span class="detail-value">15 personas</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-icon">üè¢</span>
                                    <span class="detail-label">Capacidad:</span>
                                    <span class="detail-value">20 personas</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-icon">üÜî</span>
                                    <span class="detail-label">ID Solicitud:</span>
                                    <span class="detail-value">REQ-2025-0234</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-icon">‚ö°</span>
                                    <span class="detail-label">Prioridad:</span>
                                    <span class="detail-value" style="color: #DC2626; font-weight: 600;">Alta</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="margin-bottom: 12px;">üéØ Prop√≥sito de la Reuni√≥n</h4>
                            <div class="purpose-text">
                                Presentaci√≥n del nuevo producto Q2 al equipo ejecutivo. Necesitamos el proyector 4K para mostrar demos interactivas y el sistema de audio para videoconferencia con stakeholders remotos. La reuni√≥n incluye una sesi√≥n de Q&A y toma de decisiones estrat√©gicas para el lanzamiento.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Communication History -->
                <div class="card">
                    <div class="card-header">
                        <span>üí¨</span>
                        <h3 class="card-title">Historial de Comunicaci√≥n</h3>
                    </div>
                    <div class="card-content">
                        <div style="color: #6B7280; text-align: center; padding: 20px;">
                            No hay comunicaci√≥n previa para esta solicitud
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Decision Tools -->
            <div class="decision-panel">
                <!-- Calendar -->
                <div class="card">
                    <div class="card-header">
                        <span>üìÖ</span>
                        <h3 class="card-title">Verificaci√≥n de Disponibilidad</h3>
                    </div>
                    <div class="card-content">
                        <div class="mini-calendar">
                            <div class="calendar-header">Marzo 2025</div>
                            <div class="calendar-grid">
                                <div class="calendar-day header">L</div>
                                <div class="calendar-day header">M</div>
                                <div class="calendar-day header">X</div>
                                <div class="calendar-day header">J</div>
                                <div class="calendar-day header">V</div>
                                <div class="calendar-day header">S</div>
                                <div class="calendar-day header">D</div>
                                
                                <div class="calendar-day"></div>
                                <div class="calendar-day"></div>
                                <div class="calendar-day"></div>
                                <div class="calendar-day"></div>
                                <div class="calendar-day"></div>
                                <div class="calendar-day available">1</div>
                                <div class="calendar-day available">2</div>
                                
                                <div class="calendar-day occupied">3</div>
                                <div class="calendar-day available">4</div>
                                <div class="calendar-day partial">5</div>
                                <div class="calendar-day available">6</div>
                                <div class="calendar-day available">7</div>
                                <div class="calendar-day available">8</div>
                                <div class="calendar-day available">9</div>
                                
                                <div class="calendar-day available">10</div>
                                <div class="calendar-day occupied">11</div>
                                <div class="calendar-day available">12</div>
                                <div class="calendar-day partial">13</div>
                                <div class="calendar-day available">14</div>
                                <div class="calendar-day today">15</div>
                                <div class="calendar-day available">16</div>
                                
                                <div class="calendar-day available">17</div>
                                <div class="calendar-day occupied">18</div>
                                <div class="calendar-day available">19</div>
                                <div class="calendar-day available">20</div>
                                <div class="calendar-day available">21</div>
                                <div class="calendar-day available" style="border: 2px solid #DC2626;">22</div>
                                <div class="calendar-day available">23</div>
                            </div>
                            <div class="calendar-legend">
                                <span>üü¢ Disponible</span>
                                <span>üü° Parcial</span>
                                <span>üî¥ Ocupado</span>
                                <span>üîµ Hoy</span>
                            </div>
                        </div>
                        
                        <div class="verification-tools">
                            <button class="verify-btn">üîÑ Verificar Disponibilidad en Tiempo Real</button>
                            <button class="verify-btn">üë§ Ver Perfil Completo del Usuario</button>
                            <button class="verify-btn">üìä Historial de Reservas del Usuario</button>
                        </div>
                    </div>
                </div>

                <!-- Conflicts Alert -->
                <div class="card">
                    <div class="card-header">
                        <span>‚ö†Ô∏è</span>
                        <h3 class="card-title">Verificaci√≥n de Conflictos</h3>
                    </div>
                    <div class="card-content">
                        <div class="conflict-alert">
                            <div class="alert-header">
                                <span>‚ö†Ô∏è</span>
                                <span>Conflictos Detectados</span>
                            </div>
                            <div class="conflict-item">
                                <div class="conflict-time">22 Mar, 15:30 - 16:30</div>
                                <div class="conflict-title">Mantenimiento Programado - Proyector</div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <h4 style="margin-bottom: 12px; color: #374151;">üìã Reservas Existentes del D√≠a</h4>
                            <div class="reservation-item">
                                <div>
                                    <div class="reservation-time">09:00 - 10:30</div>
                                    <div class="reservation-title">Reuni√≥n de Equipo</div>
                                </div>
                                <span class="status-badge status-confirmed">Confirmada</span>
                            </div>
                            <div class="reservation-item">
                                <div>
                                    <div class="reservation-time">11:00 - 12:00</div>
                                    <div class="reservation-title">Entrevistas</div>
                                </div>
                                <span class="status-badge status-confirmed">Confirmada</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Decision Form -->
                <div class="card">
                    <div class="card-header">
                        <span>‚öñÔ∏è</span>
                        <h3 class="card-title">Tomar Decisi√≥n</h3>
                    </div>
                    <div class="card-content">
                        <div class="decision-form">
                            <div class="decision-options">
                                <div class="radio-option" onclick="selectOption(this, 'approve')">
                                    <input type="radio" name="decision" value="approve">
                                    <div class="option-info">
                                        <div class="option-title">Aprobar</div>
                                        <div class="option-description">Autorizar la reserva tal como fue solicitada</div>
                                    </div>
                                    <div class="option-icon approve">‚úÖ</div>
                                </div>
                                
                                <div class="radio-option" onclick="selectOption(this, 'approve-conditional')">
                                    <input type="radio" name="decision" value="approve-conditional">
                                    <div class="option-info">
                                        <div class="option-title">Aprobar con Condiciones</div>
                                        <div class="option-description">Aprobar con modificaciones o restricciones</div>
                                    </div>
                                    <div class="option-icon approve-conditional">‚ö†Ô∏è</div>
                                </div>
                                
                                <div class="radio-option" onclick="selectOption(this, 'reject')">
                                    <input type="radio" name="decision" value="reject">
                                    <div class="option-info">
                                        <div class="option-title">Rechazar</div>
                                        <div class="option-description">Denegar la solicitud de reserva</div>
                                    </div>
                                    <div class="option-icon reject">‚ùå</div>
                                </div>
                                
                                <div class="radio-option" onclick="selectOption(this, 'request-info')">
                                    <input type="radio" name="decision" value="request-info">
                                    <div class="option-info">
                                        <div class="option-title">Solicitar M√°s Informaci√≥n</div>
                                        <div class="option-description">Pedir detalles adicionales antes de decidir</div>
                                    </div>
                                    <div class="option-icon request-info">üí¨</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="comments" class="form-label">
                                    Comentarios <span class="required">*</span>
                                </label>
                                <textarea 
                                    id="comments" 
                                    class="form-control" 
                                    placeholder="Proporciona detalles sobre tu decisi√≥n..."
                                    required
                                ></textarea>
                            </div>
                            
                            <div class="checkbox-option">
                                <input type="checkbox" id="autoNotify" checked>
                                <label for="autoNotify">Enviar notificaci√≥n autom√°tica al usuario</label>
                            </div>
                            
                            <div class="form-actions">
                                <button class="btn btn-success" onclick="processDecision()" disabled id="processBtn">
                                    ‚öñÔ∏è Procesar Solicitud
                                </button>
                                <button class="btn btn-secondary">üíæ Guardar como Borrador</button>
                                <button class="btn btn-outline">‚ùå Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedDecision = null;
        
        function selectOption(element, decision) {
            // Remove previous selection
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Select current option
            element.classList.add('selected');
            element.querySelector('input[type="radio"]').checked = true;
            selectedDecision = decision;
            
            // Enable process button
            document.getElementById('processBtn').disabled = false;
            
            // Update placeholder text based on decision
            const textarea = document.getElementById('comments');
            const placeholders = {
                'approve': 'Solicitud aprobada. Puedes agregar comentarios adicionales...',
                'approve-conditional': 'Especifica las condiciones o modificaciones requeridas...',
                'reject': 'Explica el motivo del rechazo (requerido)...',
                'request-info': 'Especifica qu√© informaci√≥n adicional necesitas...'
            };
            
            textarea.placeholder = placeholders[decision];
            
            // Make comments required for rejection
            if (decision === 'reject') {
                textarea.required = true;
            } else {
                textarea.required = false;
            }
        }
        
        function processDecision() {
            const comments = document.getElementById('comments').value.trim();
            const autoNotify = document.getElementById('autoNotify').checked;
            
            if (!selectedDecision) {
                alert('Por favor, selecciona una decisi√≥n.');
                return;
            }
            
            if (selectedDecision === 'reject' && comments.length < 10) {
                alert('Para rechazar una solicitud, debes proporcionar un motivo detallado (m√≠nimo 10 caracteres).');
                return;
            }
            
            // Show confirmation modal (simulated)
            const decisionNames = {
                'approve': 'aprobada',
                'approve-conditional': 'aprobada con condiciones',
                'reject': 'rechazada',
                'request-info': 'marcada para solicitar m√°s informaci√≥n'
            };
            
            const confirmMessage = `¬øConfirmas que deseas procesar esta solicitud como "${decisionNames[selectedDecision]}"?
            
${autoNotify ? 'Se enviar√° una notificaci√≥n autom√°tica al usuario.' : 'No se enviar√° notificaci√≥n autom√°tica.'}`;
            
            if (confirm(confirmMessage)) {
                // Simulate processing
                document.getElementById('processBtn').innerHTML = '‚è≥ Procesando...';
                document.getElementById('processBtn').disabled = true;
                
                setTimeout(() => {
                    alert(`¬°Solicitud procesada exitosamente! La solicitud ha sido ${decisionNames[selectedDecision]}.`);
                    // In a real app, this would redirect to the requests list
                }, 1500);
            }
        }
        
        // Enable process button when comments are added for rejection
        document.getElementById('comments').addEventListener('input', function() {
            const processBtn = document.getElementById('processBtn');
            if (selectedDecision === 'reject') {
                processBtn.disabled = this.value.trim().length < 10;
            }
        });
    </script>
</body>
</html>
============================================================


===== solicitudes_pendientes.html =====
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitudes Pendientes - Sistema de Reservas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #F9FAFB;
            color: #111827;
            line-height: 1.6;
        }
        
        .header {
            background: white;
            border-bottom: 1px solid #E5E7EB;
            padding: 16px 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 20px;
            font-weight: 700;
            color: #111827;
        }
        
        .nav-menu {
            display: flex;
            gap: 32px;
        }
        
        .nav-item {
            color: #6B7280;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .nav-item:hover, .nav-item.active {
            color: #2563EB;
            background: #EFF6FF;
        }
        
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .page-subtitle {
            color: #6B7280;
            margin-bottom: 32px;
        }
        
        .solicitudes-grid {
            display: grid;
            gap: 20px;
        }
        
        .solicitud-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-left: 4px solid #F59E0B;
        }
        
        .solicitud-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .espacio-nombre {
            font-size: 20px;
            font-weight: 600;
            color: #111827;
        }
        
        .solicitud-fecha {
            color: #6B7280;
            font-size: 14px;
        }
        
        .solicitud-info {
            margin-bottom: 20px;
        }
        
        .info-item {
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .solicitud-actions {
            display: flex;
            gap: 12px;
        }
        
        .btn-approve, .btn-reject, .btn-details {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-approve {
            background: #10B981;
            color: white;
        }
        
        .btn-approve:hover {
            background: #059669;
        }
        
        .btn-reject {
            background: #DC2626;
            color: white;
        }
        
        .btn-reject:hover {
            background: #B91C1C;
        }
        
        .btn-details {
            background: #2563EB;
            color: white;
        }
        
        .btn-details:hover {
            background: #1D4ED8;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6B7280;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">üè¢ Panel Administrativo</div>
            <nav class="nav-menu">
                <a href="{% url 'admin_dashboard' %}" class="nav-item">Dashboard</a>
                <a href="{% url 'solicitudes_pendientes' %}" class="nav-item active">Solicitudes</a>
                <a href="{% url 'gestion_espacios' %}" class="nav-item">Espacios</a>
                <a href="{% url 'gestion_usuarios' %}" class="nav-item">Usuarios</a>
                <a href="{% url 'reportes' %}" class="nav-item">Reportes</a>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="page-title">üìã Solicitudes Pendientes</div>
        <div class="page-subtitle">Gestiona las solicitudes de reserva pendientes de aprobaci√≥n</div>

        <div class="solicitudes-grid">
            {% for solicitud in solicitudes %}
            <div class="solicitud-card">
                <div class="solicitud-header">
                    <h3 class="espacio-nombre">{{ solicitud.espacio.nombre }}</h3>
                    <span class="solicitud-fecha">{{ solicitud.fecha_solicitud|date:"d M Y H:i" }}</span>
                </div>
                
                <div class="solicitud-info">
                    <div class="info-item">
                        <strong>Solicitante:</strong> 
                        {{ solicitud.solicitante.first_name }} {{ solicitud.solicitante.last_name }}
                    </div>
                    <div class="info-item">
                        <strong>Email:</strong> {{ solicitud.solicitante.email }}
                    </div>
                    <div class="info-item">
                        <strong>Fecha Reserva:</strong> {{ solicitud.fecha_reserva }}
                    </div>
                    <div class="info-item">
                        <strong>Horario:</strong> {{ solicitud.hora_inicio|time:"H:i" }} - {{ solicitud.hora_fin|time:"H:i" }}
                    </div>
                    <div class="info-item">
                        <strong>Asistentes:</strong> {{ solicitud.num_asistentes }} personas
                    </div>
                    <div class="info-item">
                        <strong>Prop√≥sito:</strong> {{ solicitud.proposito }}
                    </div>
                </div>

                <div class="solicitud-actions">
                    <button class="btn-approve" onclick="aprobarSolicitud({{ solicitud.id }})">
                        ‚úÖ Aprobar
                    </button>
                    <button class="btn-reject" onclick="rechazarSolicitud({{ solicitud.id }})">
                        ‚ùå Rechazar
                    </button>
                    <a href="{% url 'revisar_solicitud' %}?id={{ solicitud.id }}" class="btn-details">
                        üìã Detalles
                    </a>
                </div>
            </div>
            {% empty %}
            <div class="empty-state">
                <div class="empty-icon">üéâ</div>
                <h3>No hay solicitudes pendientes</h3>
                <p>Todas las solicitudes han sido procesadas</p>
            </div>
            {% endfor %}
        </div>
    </main>

    <script>
        function getCSRFToken() {
            const name = 'csrftoken';
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        async function aprobarSolicitud(solicitudId) {
            if (confirm('¬øEst√°s seguro de que deseas aprobar esta solicitud?')) {
                try {
                    const response = await fetch(`/api/reservas/${solicitudId}/aprobar/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken()
                        },
                        body: JSON.stringify({})
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        alert('Solicitud aprobada exitosamente');
                        location.reload();
                    } else {
                        alert('Error: ' + data.error);
                    }
                } catch (error) {
                    alert('Error de conexi√≥n: ' + error);
                }
            }
        }

        async function rechazarSolicitud(solicitudId) {
            const motivo = prompt('Ingresa el motivo del rechazo:');
            if (motivo) {
                try {
                    const response = await fetch(`/api/reservas/${solicitudId}/rechazar/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCSRFToken()
                        },
                        body: JSON.stringify({
                            motivo: motivo
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        alert('Solicitud rechazada exitosamente');
                        location.reload();
                    } else {
                        alert('Error: ' + data.error);
                    }
                } catch (error) {
                    alert('Error de conexi√≥n: ' + error);
                }
            }
        }
    </script>
</body>
</html>
============================================================
